/*! For license information please see 0.0.9.js.LICENSE.txt */
var ee;(()=>{var e={768:function(e){e.exports=(()=>{"use strict";var e={d:(t,n)=>{for(var i in n)e.o(n,i)&&!e.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:n[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Context:()=>Z,ESArray:()=>U,ESBoolean:()=>$,ESError:()=>Re,ESErrorPrimitive:()=>O,ESFunction:()=>M,ESJSBinding:()=>N,ESNamespace:()=>B,ESNumber:()=>D,ESObject:()=>R,ESPrimitive:()=>C,ESString:()=>j,ESSymbol:()=>L,ESType:()=>A,ESUndefined:()=>I,ExpectedCharError:()=>Me,IS_NODE_INSTANCE:()=>h,IllegalCharError:()=>Be,ImportError:()=>$e,IndexError:()=>je,InvalidOperationError:()=>Le,InvalidRuntimeError:()=>ze,InvalidSyntaxError:()=>Ne,KEYWORDS:()=>p,N_array:()=>ce,N_binOp:()=>ie,N_break:()=>Te,N_class:()=>ge,N_continue:()=>ke,N_emptyObject:()=>he,N_for:()=>le,N_functionCall:()=>de,N_functionDefinition:()=>pe,N_if:()=>se,N_indexed:()=>me,N_namespace:()=>xe,N_number:()=>be,N_objectLiteral:()=>ue,N_primWrapper:()=>Ce,N_return:()=>ve,N_statements:()=>fe,N_string:()=>we,N_unaryOp:()=>re,N_undefined:()=>Se,N_varAssign:()=>oe,N_variable:()=>_e,N_while:()=>ae,N_yield:()=>ye,Node:()=>ne,ReferenceError:()=>Ue,TestFailed:()=>Ge,TypeError:()=>De,colours:()=>V,deepClone:()=>Oe,digits:()=>i,doubleCharTokens:()=>_,global:()=>l,identifierChars:()=>r,importCache:()=>m,indent:()=>Ae,init:()=>He,interpretResult:()=>te,libs:()=>d,multiLineCommentEnd:()=>a,multiLineCommentStart:()=>s,now:()=>v,primitiveMethods:()=>T,refreshPerformanceNow:()=>y,run:()=>Ye,runningInNode:()=>f,setGlobalContext:()=>c,singleCharTokens:()=>w,singleLineComment:()=>o,sleep:()=>Pe,str:()=>Ee,stringSurrounds:()=>u,strip:()=>G,tokenType:()=>g,tokenTypeString:()=>b,tripleCharTokens:()=>S,tt:()=>x,types:()=>k,validURI:()=>Ie,wrap:()=>z});class n{constructor(e,t,n,i="(unknown)"){this.idx=e,this.ln=t,this.col=n,this.file=i}advance(e=""){return this.idx++,this.col++,"\n"===e&&(this.ln++,this.col=0),this}get clone(){return new n(this.idx,this.ln,this.col,this.file)}get str(){return`File ${this.file}, ${this.ln+1}:${this.col+1}`}get isUnknown(){return-2===this.idx}static get unknown(){return new n(-2,-2,-2,"(unknown)")}}const i="0123456789",r="_$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",o="//",s="/*",a="*/";let l;const c=e=>{l=e},u=["'","`",'"'];let h="undefined"==typeof window;const f=()=>{h=!0},d={print:console.log},p=["var","let","global","local","mutable","const","if","else","while","for","in","continue","break","func","return","yield","class","extends","namespace","export"];let v=()=>0;function y(e){return t=this,void 0,i=function*(){v=e?()=>Date.now():()=>{try{return null===performance||void 0===performance?void 0:performance.now()}catch(e){return 0}}},new((n=void 0)||(n=Promise))((function(e,r){function o(e){try{a(i.next(e))}catch(e){r(e)}}function s(e){try{a(i.throw(e))}catch(e){r(e)}}function a(t){var i;t.done?e(t.value):(i=t.value,i instanceof n?i:new n((function(e){e(i)}))).then(o,s)}a((i=i.apply(t,[])).next())}));var t,n,i}y(h);const m={};var g;!function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.ENDSTATEMENT=2]="ENDSTATEMENT",e[e.IDENTIFIER=3]="IDENTIFIER",e[e.KEYWORD=4]="KEYWORD",e[e.COMMA=5]="COMMA",e[e.ASSIGN=6]="ASSIGN",e[e.ADD=7]="ADD",e[e.SUB=8]="SUB",e[e.MUL=9]="MUL",e[e.DIV=10]="DIV",e[e.POW=11]="POW",e[e.OPAREN=12]="OPAREN",e[e.CPAREN=13]="CPAREN",e[e.OBRACES=14]="OBRACES",e[e.CBRACES=15]="CBRACES",e[e.OSQUARE=16]="OSQUARE",e[e.CSQUARE=17]="CSQUARE",e[e.EQUALS=18]="EQUALS",e[e.NOTEQUALS=19]="NOTEQUALS",e[e.NOT=20]="NOT",e[e.GT=21]="GT",e[e.LT=22]="LT",e[e.GTE=23]="GTE",e[e.LTE=24]="LTE",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.COLON=27]="COLON",e[e.DOT=28]="DOT",e[e.EOF=29]="EOF",e[e.BITWISE_OR=30]="BITWISE_OR",e[e.BITWISE_AND=31]="BITWISE_AND",e[e.BITWISE_NOT=32]="BITWISE_NOT"}(g||(g={}));let x=g;const b={[x.NUMBER]:"Number",[x.STRING]:"String",[x.ENDSTATEMENT]:";",[x.IDENTIFIER]:"Identifier",[x.KEYWORD]:"Keyword",[x.COMMA]:",",[x.OBRACES]:"{",[x.CBRACES]:"}",[x.OPAREN]:"(",[x.CPAREN]:")",[x.OSQUARE]:"[",[x.CSQUARE]:"]",[x.ASSIGN]:"=",[x.ADD]:"+",[x.SUB]:"-",[x.MUL]:"*",[x.DIV]:"/",[x.POW]:"^",[x.EQUALS]:"==",[x.NOTEQUALS]:"!=",[x.NOT]:"!",[x.GT]:">",[x.LT]:"<",[x.GTE]:">=",[x.LTE]:"<=",[x.AND]:"&&",[x.OR]:"||",[x.COLON]:":",[x.DOT]:".",[x.EOF]:"End of File",[x.BITWISE_AND]:"&",[x.BITWISE_OR]:"|",[x.BITWISE_NOT]:"~"},w={"*":x.MUL,"/":x.DIV,"+":x.ADD,"-":x.SUB,"(":x.OPAREN,")":x.CPAREN,"^":x.POW,"{":x.OBRACES,"}":x.CBRACES,",":x.COMMA,"[":x.OSQUARE,"]":x.CSQUARE,";":x.ENDSTATEMENT,":":x.COLON,".":x.DOT,"=":x.ASSIGN,">":x.GT,"<":x.LT,"!":x.NOT,"|":x.BITWISE_OR,"&":x.BITWISE_AND,"~":x.BITWISE_NOT},_={"==":x.EQUALS,"!=":x.NOTEQUALS,">=":x.GTE,"<=":x.LTE,"+=":x.ASSIGN,"-=":x.ASSIGN,"*=":x.ASSIGN,"/=":x.ASSIGN,"&&":x.AND,"||":x.OR},S={},T=["__add__","__subtract__","__multiply__","__divide__","__pow__","__eq__","__gt__","__lt__","__and__","__or__","__bool__","__setProperty__","__getProperty__","__call__"],k={};class C{constructor(e,t=k.any){this.self=this,this.isa=(e,t)=>new $(t===this.__type__),this.is=(e,t)=>new $(t===this),this.valueOf=()=>this.__value__,this.typeName=()=>this.__type__.__name__,this.hasProperty=(e,t)=>new $(this.hasOwnProperty(Ee(t))),this.describe=(e,t)=>{this.info.isBuiltIn||(this.info.description=Ee(t))},this.detail=(e,t)=>{if(this.info.isBuiltIn)return;const i=G(t,e);if("object"!=typeof i)return new De(n.unknown,"object",this.typeName(),Ee(this));this.info=Object.assign(Object.assign({},this.info),i),this.info.isBuiltIn=!1},this.__type__=t||this,this.__value__=e,this.info={}}__add__(e,t){return new Le("",this)}__subtract__(e,t){return new Le("",this)}__multiply__(e,t){return new Le("",this)}__divide__(e,t){return new Le("",this)}__pow__(e,t){return new Le("__pow__",this)}__eq__(e,t){return new Le("__eq__",this)}__gt__(e,t){return new Le("__gt__",this)}__lt__(e,t){return new Le("__lt__",this)}__and__(e,t){return new Le("__and__",this)}__or__(e,t){return new Le("__or__",this)}__bool__(e){return new Le("__bool__",this)}__setProperty__(e,t,n){return new Le("__setProperty__",this,`[${Ee(t)}] = ${Ee(n)}`)}__call__(e,...t){return new Le("__call__",this)}}class O extends C{constructor(e=new Re(n.unknown,"Unknown","Error not specified")){super(e,k.error),this.__getProperty__=(e,t)=>{if(this.self.hasOwnProperty(Ee(t))){const e=this.self[Ee(t)];return"function"==typeof e?new M(e):z(e)}return new je(n.unknown,t.valueOf(),this)},this.cast=({})=>new Re(n.unknown,"TypeError","Cannot cast type 'error'"),this.str=()=>new j(`<Error: ${this.valueOf().str}>`),this.__eq__=(e,t)=>new $(t instanceof O&&this.valueOf().constructor===t.valueOf().constructor),this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.clone=()=>new O(this.valueOf())}}function E(e,t,i,r,o){if(!(t instanceof A))return new De(n.unknown,"Type",typeof t,t);const s=new M((({context:e},...n)=>{const s=new Z;if(s.parent=e,t.__extends__){let e=E(s,t.__extends__,i,r,o);if(e instanceof Re)return e}const a=null==t?void 0:t.__init__;if(!a)return;a.this_=r,a.__closure__=s;const l=a.__call__({context:s},...n);return l instanceof Re?l:void 0}),void 0,"super",r);let a=e.setOwn("super",s);if(a instanceof Re)return a;const l=P(t,{context:e},[],!1,i);return l instanceof Re?l:void 0}function P(e,{context:t},n,i=!0,r={}){var o;if(e.__isPrimitive__){if(n.length<1)return new I;switch(e.__name__){case"Undefined":case"Type":return n.length<1?new A:new j(n[0].__type__.__name__);case"String":return new j(n[0].str().valueOf());case"Array":return new U(n);case"Number":return new D(n[0].valueOf());case"Function":return new M(n[0].valueOf());case"Boolean":return new $(n[0].bool().valueOf());default:return z(n[0])}}const s=new Z;s.parent=null===(o=e.__init__)||void 0===o?void 0:o.__closure__;const a=new R;if(e.__extends__){let n=E(s,e.__extends__,r,a,t);if(n instanceof Re)return n}a.__value__=r;for(let t of e.__methods__){const e=t.clone();e.this_=a,r[t.name]=e,-1!==T.indexOf(t.name)&&(a[t.name]=e.__call__)}if(i&&e.__init__){e.__init__.this_=a,e.__init__.__closure__=s;const t=e.__init__.__call__({context:s},...n);if(t instanceof Re)return t}return a.__type__=e,e.__instances__.push(a),a}class A extends C{constructor(e=!1,t="(anon)",i=[],r,o){super(void 0,null==k?void 0:k.type),this.__instances__=[],this.clone=()=>new A(this.__isPrimitive__,this.__name__,this.__methods__,this.__extends__,this.__init__),this.isa=({},e)=>new $(e===k.type),this.cast=({},e)=>new Le("cast",this),this.includesType=(e,t)=>{var n,i,r,o,s,a;return this.equals(e,k.any).bool().valueOf()||t.equals(e,k.any).bool().valueOf()||!0===(null===(n=this.__extends__)||void 0===n?void 0:n.equals(e,t).valueOf())||!0===(null===(i=this.__extends__)||void 0===i?void 0:i.equals(e,k.any).valueOf())||!0===(null===(r=this.__extends__)||void 0===r?void 0:r.includesType(e,t).valueOf())||!0===(null===(o=t.__extends__)||void 0===o?void 0:o.equals(e,this).valueOf())||!0===(null===(s=t.__extends__)||void 0===s?void 0:s.equals(e,k.any).valueOf())||!0===(null===(a=t.__extends__)||void 0===a?void 0:a.includesType(e,this).valueOf())?new $(!0):this.equals(e,t)},this.equals=({},e)=>new $(e.__name__===this.__name__&&e.__isPrimitive__===this.__isPrimitive__&&Object.is(this.valueOf(),e.valueOf())),this.__call__=({context:e},...t)=>P(this,{context:e},t||[]),this.str=()=>new j(`<Type: ${this.__name__}>`),this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}return new je(n.unknown,e.valueOf(),this)},this.__isPrimitive__=e,this.__name__=t,this.info.name=t,this.__extends__=r,this.__methods__=i,o&&(o.name=t,this.__init__=o),k.type||(this.__type__=this)}}class I extends C{constructor(){super(void 0,k.undefined),this.cast=({context:e},t)=>{switch(t){case k.number:return new D;case k.string:return new j;case k.array:return new U;case k.undefined:return new I;case k.type:return new A;case k.error:return new O;case k.object:case k.any:return new R;case k.function:return new M((()=>{}));case k.boolean:return new $;default:return t instanceof A?t.__call__({context:e}):new Re(n.unknown,"TypeError",`Cannot cast to type '${Ee(t.typeName())}'`)}},this.str=()=>new j("<Undefined>"),this.__eq__=({},e)=>new $(e instanceof I||void 0===e||void 0===e.valueOf()),this.__bool__=()=>new $,this.bool=this.__bool__,this.clone=()=>new I,this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}return new je(n.unknown,e.valueOf(),this)},this.info={name:"undefined",description:"Not defined, not a value.",file:"built-in",isBuiltIn:!0}}}class R extends C{constructor(e={}){super(e,k.object),this.isa=(e,t)=>t===k.object?new $(!0):t instanceof A?this.__type__.includesType(e,t):new De(n.unknown,"TypeError","type",Ee(t.typeName()),Ee(t)),this.cast=({},e)=>e===k.number?new D(this.valueOf()?1:0):new Re(n.unknown,"TypeError",`Cannot cast boolean to type '${Ee(e.typeName())}'`),this.str=()=>{let e=Ee(this.valueOf());return"\n"===e[e.length-1]&&(e=e.substr(0,e.length-1)),new j(`<ESObject ${e}>`)},this.__eq__=({context:e},t)=>{if(!(t instanceof R))return new $;if(t.keys.length!==this.keys.length)return new $;for(let n of this.keys){const i=n.valueOf(),r=this.valueOf()[i],o=t.valueOf()[i];if(!r){if(o)return new $;continue}if(!r.__eq__)return new $;const s=r.__eq__({context:e},o);if(s instanceof Re)return s;if(!s.valueOf())return new $}return new $(!0)},this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.__add__=({context:e},t)=>{if(!(t instanceof R))return new De(n.unknown,"object",t.typeName().valueOf(),t);let i={};for(let t of this.keys){const n=t.valueOf(),r=this.__getProperty__({context:e},t);if(r instanceof Re)return r;i[n]=r}for(let n of t.keys){const r=n.valueOf();if(i.hasOwnProperty(r))continue;const o=t.__getProperty__({context:e},n);if(o instanceof Re)return o;i[r]=o}return new R(i)},this.__subtract__=(e,t)=>{let i=[];if(t instanceof j)i=[Ee(t)];else{if(!(t instanceof U))return new De(n.unknown,"array | string",t.typeName().valueOf(),t);i=G(t,e)}if(!Array.isArray(i))return new De(n.unknown,"array | string",t.typeName().valueOf(),t);let r={};for(let t of this.keys){const n=t.valueOf();if(-1===i.indexOf(n)){let i=this.__getProperty__(e,t);if(i instanceof Re)return i;r[n]=i}}return new R(r)},this.__getProperty__=({},e)=>{if(!(e instanceof j))return new De(n.unknown,"string",e.typeName(),Ee(e));const t=e.valueOf();if(this.valueOf().hasOwnProperty(t))return this.valueOf()[t];if(this.self.hasOwnProperty(t)){const e=this.self[t];return"function"==typeof e?new M(e):z(e)}return new I},this.__setProperty__=({},e,t)=>{if(!(e instanceof j))return new De(n.unknown,"string",e.typeName(),Ee(e));this.__value__[e.valueOf()]=t},this.hasProperty=(e,t)=>{const n=Ee(t);return this.valueOf().hasOwnProperty(Ee(n))?new $(!0):new $(this.hasOwnProperty(n))},this.clone=()=>{const e=new R;let t={},n=this.valueOf();for(let e of Object.keys(n))t[e]=n[e];return e.__value__=t,e}}get keys(){return Object.keys(this.valueOf()).map((e=>new j(e)))}set keys(e){}}class B extends C{constructor(e,t,i=!1){super(t,k.object),this.cast=({})=>new Re(n.unknown,"TypeError","Cannot cast type 'namespace'"),this.clone=()=>{let e={},t=this.valueOf();for(let n of Object.keys(t))e[n]=t[n];return new B(this.name,e)},this.str=()=>{const e=Object.keys(this.valueOf());return new j(`<Namespace ${Ee(this.name)}${e.length>0?": ":""}${e.slice(0,5)}${e.length>=5?"...":""}>`)},this.__eq__=({},e)=>new $(this===e),this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.__getProperty__=({},e)=>{if(e instanceof j&&this.valueOf().hasOwnProperty(e.valueOf())){const t=this.valueOf()[e.valueOf()];if(t.isAccessible)return t.value}if(!(e instanceof j))return new De(n.unknown,"string",e.typeName());if(this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}return new je(n.unknown,e.valueOf(),this.self)},this.info.name=Ee(e),this.mutable=i}get name(){return new j(this.info.name)}set name(e){this.info.name=e.valueOf()}__setProperty__({},e,t){if(!(e instanceof j))return new De(n.unknown,"string",e.typeName().valueOf(),Ee(e));let i=Ee(e);if(!this.mutable)return new De(n.unknown,"mutable","immutable",`${Ee(this.name)}`);t instanceof C||(t=z(t));const r=this.__value__[i];return r?r.isConstant?new De(n.unknown,"mutable","immutable",`${Ee(this.name)}.${i}`):r.isAccessible?void(r.value=t):new De(n.unknown,"accessible","inaccessible",`${Ee(this.name)}.${i}`):new Re(n.unknown,"SymbolError",`Symbol ${i} is not declared in namespace ${Ee(this.name)}.`)}}class N extends C{constructor(e,t="<AnonNative>",i=!1){super(e,k.object),this.cast=({})=>new Re(n.unknown,"TypeError","Cannot cast native object"),this.clone=()=>new N(this.__value__),this.str=()=>{try{return new j(JSON.stringify(this.__value__))}catch(e){return new j(`${this.__value__}`)}},this.__eq__=({},e)=>new $(this===e),this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.__getProperty__=(e,t)=>{const i=Ee(t),r=this.valueOf(),o=r[i];if(void 0===o){if(this.self.hasOwnProperty(i)){const e=this.self[Ee(i)];return"function"==typeof e?new M(e):z(e)}return new je(n.unknown,i,this)}return o instanceof C?o:"function"==typeof o?new M((({context:t},...n)=>r[i](...n.map((t=>G(t,e)))))):new N(o)},this.__call__=(e,...t)=>{if("function"!=typeof this.__value__)return new De(n.unknown,"function",typeof this.__value__,Ee(this));let i;try{i=new this.__value__(...t.map((t=>G(t,e))))}catch(n){i=this.__value__(...t.map((t=>G(t,e))))}return i instanceof C?i:new N(i)},this.hasProperty=(e,t)=>new $(!(this.__getProperty__(e,t)instanceof Re)),this.info.name=Ee(t)}}k.type=new A(!0,"Type"),k.undefined=new A(!0,"Undefined"),k.string=new A(!0,"String"),k.array=new A(!0,"Array"),k.number=new A(!0,"Number"),k.any=new A(!0,"Any"),k.function=new A(!0,"Function"),k.bool=new A(!0,"Boolean"),k.object=new A(!0,"Object"),k.error=new A(!0,"Error"),k.any.info={name:"any",description:"Matches any other type",file:"built-in",isBuiltIn:!0},k.number.info={name:"any",description:"The ES Number type. Is a a double-precision 64-bit binary format IEEE 754 value, like double in Java and C#",file:"built-in",isBuiltIn:!0},k.string.info={name:"string",description:"The ES String type. Holds an array of characters, and can be defined with any of ', \" and `. Can be indexed like an array.",file:"built-in",isBuiltIn:!0},k.bool.info={name:"bool",description:"The ES Bool type. Exactly two instances exist, true and false.",file:"built-in",isBuiltIn:!0},k.function.info={name:"function",description:"The ES Function type. Is a block of code which executes when called and takes in 0+ parameters.",file:"built-in",isBuiltIn:!0},k.array.info={name:"array",description:"The ES Array type. Defines a set of items of any type which can be accessed by an index with [].",file:"built-in",isBuiltIn:!0},k.object.info={name:"object",description:"The ES Object type. Similar to JS objects or python dictionaries.",file:"built-in",isBuiltIn:!0},k.error.info={name:"error",description:"The ES Error type. Call to throw an error.",file:"built-in",isBuiltIn:!0},k.type.info={name:"type",description:"The ES Type type. Call to get the type of a value at a string.",file:"built-in",isBuiltIn:!0};class M extends C{constructor(e=(()=>{}),t=[],i="(anon)",r=new R,o=k.any,s=l){super(e,k.function),this.cast=({},e)=>new Re(n.unknown,"TypeError","Cannot cast type 'function'"),this.clone=()=>new M(this.__value__,this.arguments_,this.name,this.this_,this.returnType,this.__closure__),this.valueOf=()=>this,this.str=()=>new j(`<Func: ${this.name}>`),this.__eq__=({},e)=>new $(e instanceof M&&this.__value__===e.__value__),this.__bool__=()=>new $(!0),this.bool=this.__bool__,this.__call__=({context:e},...t)=>(this.__closure__.path=e.path,function(e,t,i){var r;let o=e;(e=t.__closure__).path=o.path;const s=t.__value__,a=function(e,t,i){const r=new Z;r.parent=i;let o=Math.max(e.length,t.arguments_.length);for(let s=0;s<o;s++){let o=new I,a=k.any;if(!t.arguments_[s])continue;const l=t.arguments_[s];if(!(l.type instanceof A))return new De(n.unknown,"Type",typeof l.type,l.type);if(e[s]instanceof C&&(a=e[s].__type__,o=e[s]),!l.type.includesType({context:i},a).bool().valueOf())return new De(n.unknown,l.type.__name__,a.__name__,Ee(o));r.setOwn(l.name,o,{forceThroughConst:!0})}let s=r.setOwn("args",new U(e),{forceThroughConst:!0});return s instanceof Re?s:r}(i,t,e);if(a instanceof Re)return a;let l=null!==(r=t.this_)&&void 0!==r?r:new R;if(!(l instanceof R))return new De(n.unknown,"object",typeof l,l,"'this' must be an object");let c=a.setOwn("this",l);return c instanceof Re?c:s instanceof ne?function(e,t,i,r){var o,s,a,l;const c=r.interpret(t);return c.error?c.error:(void 0!==c.funcReturn&&(c.val=c.funcReturn,c.funcReturn=void 0),!1===e.returnType.includesType({context:t},null!==(s=null===(o=c.val)||void 0===o?void 0:o.__type__)&&void 0!==s?s:k.any).valueOf()?new De(n.unknown,e.returnType.__name__,(null===(a=c.val)||void 0===a?void 0:a.typeName().valueOf())||"undefined",null===(l=c.val)||void 0===l?void 0:l.str().valueOf(),"(from function return)"):c.val?c.val:new I)}(t,a,0,s):"function"==typeof s?function(e,t,n,i){for(let e=n.length;e<i.length;e++)n.push(new I);const r=i({context:t},...n);return r instanceof Re||r instanceof C?r:new I}(0,a,i,s):new De(n.unknown,"function",typeof s)}(this.__closure__,this,t)),this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}return new je(n.unknown,e.valueOf(),this)},this.arguments_=t,this.info.name=i,this.this_=r,this.returnType=o,this.__closure__=s,this.info.returnType=Ee(o),this.info.args=t.map((e=>({name:e.name,defaultValue:Ee(e.defaultValue),type:e.type.info.name,required:!0})))}get name(){var e;return null!==(e=this.info.name)&&void 0!==e?e:"(anonymous)"}set name(e){this.info.name=e}}class D extends C{constructor(e=0){super(e,k.number),this.cast=({},e)=>{switch(e){case k.number:return this;case k.string:return this.str();case k.array:return new U(new Array(this.valueOf()));default:return new Re(n.unknown,"TypeError",`Cannot cast to type '${Ee(e.typeName())}'`)}},this.str=()=>new j(this.valueOf().toString()),this.__add__=({},e)=>e instanceof D?new D(this.valueOf()+e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__subtract__=({},e)=>e instanceof D?new D(this.valueOf()-e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__multiply__=({},e)=>e instanceof D?new D(this.valueOf()*e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__divide__=({},e)=>e instanceof D?new D(this.valueOf()/e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__pow__=({},e)=>e instanceof D?new D(Math.pow(this.valueOf(),e.valueOf())):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__eq__=({},e)=>new $(e instanceof D&&this.valueOf()===e.valueOf()),this.__gt__=({},e)=>e instanceof D?new $(this.valueOf()>e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__lt__=({},e)=>e instanceof D?new $(this.valueOf()<e.valueOf()):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__bool__=()=>new $(this.valueOf()>0),this.bool=this.__bool__,this.clone=()=>new D(this.valueOf()),this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}return new je(n.unknown,e.valueOf(),this)}}}class $ extends C{constructor(e=!1){super(Boolean(e),k.bool),this.__getProperty__=(e,t)=>{if(this.self.hasOwnProperty(Ee(t))){const e=this.self[Ee(t)];return"function"==typeof e?new M(e):z(e)}return new je(n.unknown,t.valueOf(),this)},this.cast=(e,t)=>t===k.number?new D(this.valueOf()?1:0):new Re(n.unknown,"TypeError",`Cannot cast boolean to type '${Ee(t.typeName())}'`),this.__eq__=(e,t)=>t instanceof $?new $(this.valueOf()===t.valueOf()):new De(n.unknown,"Boolean",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>this,this.__and__=(e,t)=>new $(this.valueOf()&&t.bool().valueOf()),this.__or__=(e,t)=>new $(this.valueOf()||t.bool().valueOf()),this.str=()=>new j(this.valueOf()?"true":"false"),this.clone=()=>new $(this.valueOf()),this.bool=()=>this,this.info={name:Ee(e),description:`Boolean global constant which evaluates to ${Ee(e)}, the opposite of ${Ee(!e)}`,file:"built-in",isBuiltIn:!0,helpLink:"https://en.wikipedia.org/wiki/Boolean_expression"}}}class U extends C{constructor(e=[]){super(e,k.array),this.cast=({},e)=>{switch(e){case k.number:return new D(this.len);case k.boolean:return this.bool();default:return new Re(n.unknown,"TypeError",`Cannot cast boolean to type '${Ee(e.typeName())}'`)}},this.str=()=>new j(Ee(this.valueOf())),this.__eq__=({context:e},t)=>{if(!(t instanceof U))return new $;if(t.len!==this.len)return new $;for(let n=0;n<this.len;n++){const i=this.valueOf()[n],r=t.valueOf()[n];if(!i){if(r)return new $;continue}if(!i.__eq__)return new $;const o=i.__eq__({context:e},r);if(o instanceof Re)return o;if(!o.valueOf())return new $}return new $(!0)},this.__add__=({context:e},t)=>t instanceof U?new U([...this.valueOf(),...t.valueOf()]):new De(n.unknown,"array",t.typeName().valueOf(),t),this.__bool__=()=>new $(this.valueOf().length>0),this.bool=this.__bool__,this.__getProperty__=({},e)=>{if(e instanceof j&&this.self.hasOwnProperty(Ee(e))){const t=this.self[Ee(e)];return"function"==typeof t?new M(t):z(t)}if(!(e instanceof D))return new I;let t=e.valueOf();for(;t<0;)t=this.valueOf().length+t;return t<this.valueOf().length?this.valueOf()[t]:new I},this.add=({},e,t=new D(this.len-1))=>{if(!(e instanceof C))throw"adding non-primitive to array: "+Ee(e);return this.len++,this.__value__.splice(t.valueOf(),0,e),new D(this.len)},this.contains=({},e)=>{for(let t of this.__value__)if(e.valueOf()==t.valueOf())return!0;return!1},this.clone=()=>{const e=[];for(let t of this.valueOf())e.push(t);return new U(e)},this.len=e.length}__setProperty__({},e,t){if(!(e instanceof D))return;t instanceof C||(t=z(t));let n=e.valueOf();for(;n<0;)n=this.valueOf().length+n;this.__value__[n]=t}}class j extends C{constructor(e=""){super(e,k.string),this.str=()=>this,this.cast=({},e)=>{switch(e){case k.number:const t=parseFloat(this.valueOf());return isNaN(t)?new Re(n.unknown,"TypeError","This string is not a valid number"):new D(t);case k.string:return this;case k.array:return new U(this.valueOf().split("").map((e=>new j(e))));default:return new Re(n.unknown,"TypeError",`Cannot cast to type '${Ee(e.typeName())}'`)}},this.__add__=({},e)=>e instanceof j?new j(this.valueOf()+e.valueOf()):new De(n.unknown,"String",e.typeName().valueOf(),e.valueOf()),this.__multiply__=({},e)=>e instanceof D?new j(this.valueOf().repeat(e.valueOf())):new De(n.unknown,"Number",e.typeName().valueOf(),e.valueOf()),this.__eq__=({},e)=>new $(e instanceof j&&this.valueOf()===e.valueOf()),this.__gt__=({},e)=>e instanceof j?new $(this.valueOf().length>e.valueOf().length):new De(n.unknown,"String",e.typeName().valueOf(),e.valueOf()),this.__lt__=({},e)=>e instanceof j?new $(this.valueOf().length<e.valueOf().length):new De(n.unknown,"String",e.typeName().valueOf(),e.valueOf()),this.__bool__=()=>new $(this.valueOf().length>0),this.bool=this.__bool__,this.len=()=>new D(this.valueOf().length),this.clone=()=>new j(this.valueOf()),this.__getProperty__=(e,t)=>{if(t instanceof j&&this.self.hasOwnProperty(Ee(t))){const e=this.self[Ee(t)];return"function"==typeof e?new M(e):z(e)}if(!(t instanceof D))return new j;let n=t.valueOf();for(;n<0;)n=this.valueOf().length+n;return n<this.valueOf().length?new j(this.valueOf()[n]):new j}}__setProperty__({},e,t){if(!(e instanceof D))return;t instanceof j||(t=new j(Ee(t)));let n=e.valueOf();for(;n<0;)n=this.valueOf().length+n;const i=t.str().valueOf();let r=this.__value__.substr(0,n),o=this.__value__.substr(n+i.length);this.__value__=r+i+o}}class L{constructor(e,t,n={}){var i,r;this.clone=()=>new L(this.value.clone(),this.identifier,{isConstant:this.isConstant,isAccessible:this.isAccessible}),this.str=()=>new j(`<Symbol: ${this.identifier}>`),this.value=e,this.identifier=t,this.isConstant=null!==(i=n.isConstant)&&void 0!==i&&i,this.isAccessible=null===(r=n.isAccessible)||void 0===r||r}}function z(e,t=!1){return e instanceof C?e:null==e?new I:e instanceof Re?new O(e):e instanceof L?e.value:"number"==typeof e?new D(e):"string"==typeof e?new j(e):"boolean"==typeof e?new $(e):"bigint"==typeof e?new D(Number(e)):"symbol"==typeof e?new j(String(e)):new N(e,void 0,t)}function G(e,t){if(null!=e){if(!(e instanceof C))return e;if(e instanceof U)return e.valueOf().map((e=>G(e,t)),t);if(e instanceof R){let n={};for(let i in e.valueOf())n[i]=G(e.valueOf()[i],t);return n}if(!(e instanceof I))return e instanceof M?(...n)=>{const i=e.__call__(t,...n.map((e=>z(e))));return i instanceof Re?i:G(i,t)}:e instanceof A?e:e.valueOf()}}const F={red:31,yellow:33,green:32,cyan:36,blue:34,grey:2},W={};for(let e of Object.keys(F))W[e]=t=>(t||(t=""),h?`[${F[e]}m`+t+"[0m":`<span style="color: ${e}">${t}</span>`);const V=W,q={range:[({context:e},t)=>{if(!(t instanceof D))return new De(n.unknown,"Number",t.typeName().valueOf(),t.valueOf());const i=t.valueOf();try{return new U([...Array(i).keys()].map((e=>new D(e))))}catch(e){return new Re(n.unknown,"RangeError",`Cannot make range of length '${Ee(t)}'`)}},{args:[{name:"N",type:"Number"}],description:"Generates an array of integers given N. Starts at 0 and goes to N-1. Can be used like for i in range(10) ..., similarly to python.",returns:"array of numbers from 0 to N-1",returnType:"number[] | RangeError"}],log:[({context:e},...t)=>{console.log(...t.map((e=>Ee(e))))},{args:[{name:"...values",type:"any[]"}],description:"Uses console.log to log all values",returnType:"void"}],parseNum:[({context:e},t)=>{try{const e=parseFloat(Ee(t));return isNaN(e)?new Re(n.unknown,"TypeError",`Cannot convert '${Ee(t)}' to a number.`):new D(e)}catch(e){return new Re(n.unknown,"TypeError",`Cannot convert '${Ee(t)}' to a number.`)}},{args:[{name:"num",type:"any"}],description:"Converts a string of digits into a number. Works with decimals and integers. Calls .str() on value before using native JS 'parseFloat' function. Returns TypeError if the string can't be converted into a number.",returnType:"number | TypeError"}],help:[({context:e},...t)=>{if(!t.length)return new j("Visit https://entropygames.io/entropy-script for help with Entropy Script!\nTry 'help(<anything>)' for help about a particular object.");let n="";for(const e of t){if(!(e instanceof C))return void console.log("Invalid arg not primitive: "+Ee(e));const t=e.info;if(n+=`${V.yellow(`Help on '${t.name||"(anonymous)"}'`)}:\n    \n    ${V.yellow("Value")}: ${Ae(Ae(Ee(e)))}\n    ${V.yellow("Type")}: '${Ee(e.typeName())}'\n    ${V.yellow("Location")}: ${t.file||V.yellow("(unknown)")}\n    \n        ${V.green(t.description)||"No description."}\n        \n    ${t.helpLink?V.cyan(t.helpLink+"\n\n"):""}\n`,t.args&&e instanceof M){const e=t.args.length,i=t.args.filter((e=>e.required)).length;n+=e==i?V.yellow(`    Arguments (${e}): \n`):V.yellow(`    Arguments (${i}-${e}): \n`);for(const[e,i]of t.args.entries())n+="object"!=typeof i?`        ${e+1}. INVALID ARG INFO`:`        ${e+1}. ${i.name}${!1===i.required?V.yellow(" (optional) "):" "}{${i.type}} ${i.description||""}\n`;n+="\n\n",t.returns&&(n+=`    Returns: ${t.returns}\n\n`),t.returnType&&(n+=`    Return Type: ${t.returnType}\n\n`)}if(t.contents&&(e instanceof R||e instanceof B)){n+="    Properties: \n      ";for(let e of t.contents)n+=e.name+"\n      "}}return console.log(n),t.length>1?new U(t):t?t[0]:void 0},{args:[{name:"value",type:"any"}],description:"logs info on value",returns:"value passed in"}],delete:[({context:e},t)=>{const i=Ee(t);if(!e.has(i))return new Re(n.unknown,"DeleteError",`Identifier '${i}' not found in the current context`);e.set(i,new I)},{name:"delete",args:[{name:"identifier",type:"string"}],description:"Deletes a variable from the current context"}],__path:[({context:e})=>new j(e.path),{name:"__path",args:[],description:"Returns the current path"}],__symbols:[({context:e})=>z(e.keys),{name:"__allSymbols",args:[],description:"Returns an array of the names of all symbols in the current context"}],using:[({context:e},t,i)=>{if(!(t instanceof B||t instanceof N))return new De(n.unknown,"Namespace",Ee(t.typeName()));let r=!0;i&&(i.bool().valueOf()||(r=!1));const o=t.valueOf();r?e=e.root:e.parent&&(e=e.parent);for(const t of Object.keys(o))e.setOwn(t,o[t].value,{isConstant:o[t].isConstant,isAccessible:o[t].isAccessible,forceThroughConst:!0})},{name:"using",args:[{name:"module",type:"namespace"},{name:"global",type:"bool"}],description:"Adds contents of a namespace to the global context"}],sleep:[({context:e},t,i)=>t instanceof D?i instanceof M?void Pe(t.valueOf()).then((()=>{const t=i.__call__({context:e});t instanceof Re&&console.log(t.str)})):new De(n.unknown,"function",Ee(i.typeName()),Ee(i)):new De(n.unknown,"number",Ee(t.typeName()),Ee(t)),{name:"sleep",args:[{name:"n",type:"number"},{name:"callback",type:"function"}],description:"Waits n milliseconds and then executes the callback"}]},H={ascii:{asciiToChar:(e,t)=>t instanceof D?new j(String.fromCharCode(t.valueOf())):new De(n.unknown,"number",Ee(t.typeName()),Ee(t)),charToAscii:(e,t)=>t instanceof j?new D(Ee(t).charCodeAt(0)):new De(n.unknown,"string",Ee(t.typeName()),Ee(t))},json:{parse:(e,t)=>new R(JSON.parse(Ee(t))),stringify:(e,t)=>t instanceof R?new j(JSON.stringify(G(t,e))):new De(n.unknown,"object",Ee(t.typeName()),Ee(t))}},Y={};function Q(e,t){const n={},i=e.valueOf();for(const e of Object.keys(i))n[e]=new L(i[e],e);return new N(n,t)}function K(e){return e in H||e in Y}function J(e){if(e in Y)return Y[e];if(e in H){const t=Q(new N(H[e]),e);return Y[e]=t,t}}function X(e,t,i){q.import=[({context:i},r,o)=>{if(h)return new Re(n.unknown,"ImportError","Is running in node instance but trying to run browser import function");const s=r.str();if(K(Ee(s)))return J(Ee(s));try{fetch(Ee(s)).then((e=>e.text())).then((r=>{return a=this,void 0,c=function*(){const a=new Z;a.parent=e;const l=yield Ye(r);l.error?t(new $e(n.unknown,Ee(s),l.error.str).str):o instanceof M&&o.__call__({context:i},new B(s,a.getSymbolTableAsDict()))},new((l=void 0)||(l=Promise))((function(e,t){function n(e){try{r(c.next(e))}catch(e){t(e)}}function i(e){try{r(c.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof l?r:new l((function(e){e(r)}))).then(n,i)}r((c=c.apply(a,[])).next())}));var a,l,c}))}catch(e){return new Re(n.unknown,"ImportError",e.toString())}},{}],q.print=[({context:e},...n)=>{let i="";for(let e of n)i+=Ee(e);t(i)},{}],q.input=[({context:e},t,n)=>{i(t.valueOf(),(t=>{let i=null==n?void 0:n.valueOf();if(i instanceof M){let n=i.__call__({context:e},new j(t));n instanceof Re&&console.log(n.str)}else"function"==typeof i&&i(t);return new j("'input()' does not return anything. Pass in a function as the second argument, which will take the user input as an argument.")}))},{}];for(let t in q){const n=new M(q[t][0],[],t,void 0,void 0,e);n.info=q[t][1],n.info.name=t,n.info.isBuiltIn=!0,n.info.file="built-in",e.set(t,n,{global:!0,isConstant:!0})}!function(e){const t={false:new $(!1),true:new $(!0),nil:new I,any:k.any,number:k.number,string:k.string,bool:k.bool,function:k.function,array:k.array,object:k.object,type:k.type,error:k.error,undefined:k.undefined};for(let n in t){const i=t[n];e.set(n,i,{global:!0,isConstant:!0})}}(e);const r=function(){if(Y.math=new N(Math),!h){const e=(()=>{if(h)return new ze;const e=window;return void 0!==e&&"$"in e?{$:new N(e.$,"jquery"),window:new N(e,"window"),document:new N(e.document,"document")}:new Ue(n.unknown,"$ must be property of window to use dom library")})();if(e instanceof Re)return e;H.dom=e}}();if(r)return r;e.initialisedAsGlobal=!0}class Z{constructor(){this.symbolTable={},this.initialisedAsGlobal=!1,this.deleted=!1,this.path_=""}get path(){return this.path_||!this.parent?this.path_:this.parent.path}set path(e){this.path_=e}get parent(){return this.parent_}set parent(e){e!=this?this.parent_=e:console.error(V.red("Setting context parent to self"))}has(e){return void 0!==this.get(e)}hasOwn(e){return this.symbolTable[e]instanceof L}get(e){let t=this.getSymbol(e);return t instanceof Re||null==t?t:t.value}getRawSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t].value;return e}getSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t];return e}getSymbol(e){let t=this.symbolTable[e];if(void 0!==t&&!t.isAccessible)return new De(n.unknown,"assessable","inaccessible",t.identifier);if(void 0===t&&this.parent){let i=this.parent.getSymbol(e);if(i instanceof Re)return i;if(!i)return new Ue(n.unknown,e);t=i}return t}set(e,t,n={}){let i=this;if(n.global)i=this.root;else{for(;!i.hasOwn(e)&&void 0!==i.parent;)i=i.parent;i.hasOwn(e)||(i=this)}return i.setOwn(e,t,n)}setOwn(e,t,i={}){if(t instanceof C||(t=z(t)),i.global&&!this.initialisedAsGlobal&&(i.global=!1),!i.forceThroughConst){let t=this.symbolTable[e];if(null==t?void 0:t.isConstant)return new De(n.unknown,"dynamic","constant",e)}this.symbolTable[e]=new L(t,e,i)}remove(e){delete this.symbolTable[e]}clear(){for(let e in this.symbolTable)this.remove(e);this.parent=void 0,this.deleted=!0}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get keys(){return Object.keys(this.symbolTable)}resetAsGlobal(){var e,t;if(!this.initialisedAsGlobal)return;const n=this.root.get("print"),i=this.root.get("input");n instanceof C&&i instanceof C?(this.symbolTable={},this.initialisedAsGlobal=!1,X(this,(null===(e=n.valueOf())||void 0===e?void 0:e.func)||console.log,(null===(t=i.valueOf())||void 0===t?void 0:t.func)||(()=>{}))):console.error("Error with print and input functions.")}clone(){const e=new Z;return e.parent=this.parent,e.deleted=this.deleted,e.initialisedAsGlobal=this.initialisedAsGlobal,e.symbolTable=Object.assign(Object.assign({},e.symbolTable),this.symbolTable),e}deepClone(){var e;let t=this.clone();return t.parent=null===(e=t.parent)||void 0===e?void 0:e.deepClone(),t}log(){console.log("---- CONTEXT ----");for(let e in this.symbolTable){const t=this.symbolTable[e];let n=e;t.isConstant&&(n+=" (CONST)"),t.isAccessible||(n+=" (INACCESSIBLE)"),n+=": ",n+=Ee(this.symbolTable[e].value),console.log(n)}console.log("-----------------")}}function ee(e,t){var i;let r;const o=e.type.interpret(t);if(o.error)return o.error;if(!(o.val instanceof A))return new De(n.unknown,"Type",typeof o.val,o.val,"Argument can't be undefined");let s;if(r=o.val,e.defaultValue){let n=null===(i=e.defaultValue)||void 0===i?void 0:i.interpret(t);if(n.error)return n.error;n.val instanceof C&&(s=n.val)}return{name:e.name,type:r,defaultValue:s}}class te{constructor(){this.val=new I,this.shouldBreak=!1,this.shouldContinue=!1}}class ne{constructor(e,t=!1){this.pos=e,this.isTerminal=t}interpret(e){var t;const i=v(),r=new te,o=this.interpret_(e);o instanceof Re?r.error=o:o instanceof te?(r.val=o.val,r.error=o.error,r.funcReturn=o.funcReturn,r.shouldBreak=o.shouldBreak,r.shouldContinue=o.shouldContinue):r.val=o,r.error&&r.error.pos.isUnknown&&(r.error.pos=this.pos),r.val instanceof C||(r.error=new De(n.unknown,"Primitive","Native JS value",Ee(r.val)),r.val=new I),(t=r.val.info).file||(t.file=this.pos.file),ne.interprets++;let s=v()-i;return ne.totalTime+=s,s>ne.maxTime&&(ne.maxTime=s),r}}ne.interprets=0,ne.totalTime=0,ne.maxTime=0;class ie extends ne{constructor(e,t,n,i){super(e),this.left=t,this.opTok=n,this.right=i}interpret_(e){const t=this.left.interpret(e);if(t.error)return t.error;const n=this.right.interpret(e);if(n.error)return n.error;const i=t.val,r=n.val;if(void 0===i)return new De(this.opTok.pos,"~undefined","undefined",i,"N_binOp.interpret_");if(void 0===r)return new De(this.opTok.pos,"~undefined","undefined",r,"N_binOp.interpret_");switch(this.opTok.type){case x.LTE:{const t=i.__lt__({context:e},r),n=i.__eq__({context:e},r);return t instanceof Re?t:n instanceof Re?n:t.__or__({context:e},n)}case x.GTE:{const t=i.__gt__({context:e},r),n=i.__eq__({context:e},r);return t instanceof Re?t:n instanceof Re?n:t.__or__({context:e},n)}case x.NOTEQUALS:{const t=i.__eq__({context:e},r);return t instanceof Re?t:new $(!t.bool().valueOf())}case x.ADD:return i.__add__({context:e},r);case x.SUB:return i.__subtract__({context:e},r);case x.MUL:return i.__multiply__({context:e},r);case x.DIV:return i.__divide__({context:e},r);case x.POW:return i.__pow__({context:e},r);case x.EQUALS:return i.__eq__({context:e},r);case x.LT:return i.__lt__({context:e},r);case x.GT:return i.__gt__({context:e},r);case x.AND:return i.__and__({context:e},r);case x.OR:return i.__or__({context:e},r);default:return new Ne(this.opTok.pos,`Invalid binary operator: ${b[this.opTok.type]}`)}}}class re extends ne{constructor(e,t,n){super(e),this.a=t,this.opTok=n}interpret_(e){var t,n,i;const r=this.a.interpret(e);if(r.error)return r.error;switch(this.opTok.type){case x.SUB:case x.ADD:if(!(r.val instanceof D))return new De(this.pos,"Number",(null===(t=r.val)||void 0===t?void 0:t.typeName().toString())||"undefined_",null===(n=r.val)||void 0===n?void 0:n.valueOf());const e=r.val.valueOf();return new D(this.opTok.type===x.SUB?-e:Math.abs(e));case x.NOT:return new $(!(null===(i=null==r?void 0:r.val)||void 0===i?void 0:i.bool().valueOf()));default:return new Ne(this.opTok.pos,`Invalid unary operator: ${b[this.opTok.type]}`)}}}class oe extends ne{constructor(e,t,n,i="=",r=!1,o=!1,s=!1,a=!1,l=k.any){super(e),this.value=n,this.varNameTok=t,this.isGlobal=r,this.assignType=i,this.isConstant=s,this.isDeclaration=a,this.isLocal=o,this.type=l instanceof A?new Ce(l):l}interpret_(e){var t,n,i,r;if(this.isDeclaration&&e.hasOwn(this.varNameTok.value))return new Ne(this.pos,`Symbol '${this.varNameTok.value}' already exists, and cannot be redeclared`);const o=this.value.interpret(e),s=this.type.interpret(e);if(o.error)return o.error;if(s.error)return s.error;if(!(s.val&&s.val instanceof A))return new De(this.varNameTok.pos,"Type",null!==(n=null===(t=s.val)||void 0===t?void 0:t.typeName().valueOf())&&void 0!==n?n:"undefined",null===(i=s.val)||void 0===i?void 0:i.str(),"@ !typeRes.val || !(typeRes.val instanceof ESType)");if(!o.val)return new De(this.varNameTok.pos,"~undefined","undefined","N_varAssign.interpret_");if(!s.val.includesType({context:e},o.val.__type__).bool().valueOf())return new De(this.varNameTok.pos,Ee(s.val),Ee(null===(r=o.val)||void 0===r?void 0:r.typeName()),Ee(o.val));if(this.isDeclaration)return"="!==this.assignType?new Ne(this.pos,`Cannot declare variable with operator '${this.assignType}'`):(e.setOwn(this.varNameTok.value,o.val,{global:!1,isConstant:this.isConstant}),o.val);if("="===this.assignType){let t=o.val;void 0===t&&(t=new I);const n=e.set(this.varNameTok.value,t,{global:this.isGlobal,isConstant:this.isConstant});if(n instanceof Re)return n}else{if(this.isDeclaration)return new Ne(this.pos,`Cannot declare variable with operator '${this.assignType}'`);const t=e.get(this.varNameTok.value);if(t instanceof Re)return t;if(null==t)return new Ne(this.pos,`Cannot declare variable with operator '${this.assignType}'`);let n,i=o.val;switch(this.assignType[0]){case"*":n=t.__multiply__({context:e},i);break;case"/":n=t.__divide__({context:e},i);break;case"+":n=t.__add__({context:e},i);break;case"-":n=t.__subtract__({context:e},i);break;default:return new Re(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(n instanceof Re)return n;let r=e.set(this.varNameTok.value,n,{global:this.isGlobal,isConstant:this.isConstant});if(r instanceof Re)return r;o.val=n}return"(anonymous)"!==o.val.info.name&&o.val.info.name||(o.val.info.name=this.varNameTok.value),o}}class se extends ne{constructor(e,t,n,i){super(e),this.comparison=t,this.ifFalse=i,this.ifTrue=n}interpret_(e){var t;let n=new Z;n.parent=e;let i=new te,r=this.comparison.interpret(e);if(r.error)return r;if(null===(t=r.val)||void 0===t?void 0:t.bool().valueOf()){if(i=this.ifTrue.interpret(n),i.val=new I,i.error)return i}else if(this.ifFalse&&(i=this.ifFalse.interpret(n),i.val=new I,i.error))return i;return i}}class ae extends ne{constructor(e,t,n){super(e),this.comparison=t,this.loop=n}interpret_(e){var t,n;let i=new Z;for(i.parent=e;;){let r=this.comparison.interpret(e);if(r.error)return r;if(!(null===(n=null===(t=r.val)||void 0===t?void 0:t.bool())||void 0===n?void 0:n.valueOf()))break;let o=this.loop.interpret(i);if(o.error)return o;if(o.shouldBreak)break}return new I}}class le extends ne{constructor(e,t,n,i,r,o){super(e),this.body=t,this.array=n,this.identifier=i,this.isGlobalId=r,this.isConstId=o}interpret_(e){var t,n,i,r,o,s,a,l;let c=new Z;c.parent=e;const u=this.array.interpret(e);if(u.error)return u;if(-1===["Array","Number","Object","String","Any"].indexOf((null===(t=u.val)||void 0===t?void 0:t.typeName().valueOf())||""))return new De(this.identifier.pos,"Array | Number | Object | String",typeof u.val+" | "+(null===(n=u.val)||void 0===n?void 0:n.typeName()));function h(e,t,n,i,r){c.set(t,n,{global:i,isConstant:r});const o=e.interpret(c);return o.error||void 0!==o.funcReturn?o:o.shouldBreak?(o.shouldBreak=!1,"break"):void(o.shouldContinue&&(o.shouldContinue=!1))}if(u.val instanceof D||"number"==typeof(null===(i=u.val)||void 0===i?void 0:i.valueOf()))for(let e=0;e<u.val.valueOf();e++){const t=h(this.body,this.identifier.value,new D(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else if(u.val instanceof R||"number"==typeof(null===(r=u.val)||void 0===r?void 0:r.valueOf())&&!Array.isArray(null===(o=u.val)||void 0===o?void 0:o.valueOf()))for(let e in null===(s=u.val)||void 0===s?void 0:s.valueOf()){const t=h(this.body,this.identifier.value,new j(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else{if(!(u.val instanceof U||Array.isArray(null===(a=u.val)||void 0===a?void 0:a.valueOf())))return new De(this.identifier.pos,"Array | Number | Object | String",typeof u.val);for(let e of null===(l=u.val)||void 0===l?void 0:l.valueOf()){const t=h(this.body,this.identifier.value,e,this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}}return new I}}class ce extends ne{constructor(e,t,n=!1){super(e),this.items=t,this.shouldClone=n}interpret_(e){let t=new te,n=[];for(let t of this.items){const i=t.interpret(e);if(i.error||void 0!==i.funcReturn)return i;if(!i.val)continue;let r=i.val;this.shouldClone&&(r=r.clone()),n.push(r)}return t.val=new U(n),t}}class ue extends ne{constructor(e,t){super(e),this.properties=t}interpret_(e){let t={};for(const[n,i]of this.properties){const r=i.interpret(e);if(r.error)return r.error;const o=n.interpret(e);if(o.error)return o.error;o.val&&r.val&&(t[o.val.valueOf()]=r.val)}return new R(t)}}class he extends ne{constructor(e){super(e)}interpret_(e){return new R({})}}class fe extends ne{constructor(e,t){super(e),this.items=t}interpret_(e){let t;for(let n of this.items){const i=n.interpret(e);if(i.error||void 0!==i.funcReturn||i.shouldBreak||i.shouldContinue)return i;t=i.val}return t||new I}}class de extends ne{constructor(e,t,n){super(e),this.arguments=n,this.to=t}interpret_(e){let{val:t,error:n}=this.to.interpret(e);if(n)return n;if(!t)return new De(this.pos,"any","undefined",void 0,"On function call");let i=[];for(let t of this.arguments){const n=t.interpret(e);if(n.error)return n.error;n.val&&i.push(n.val)}const r=t.__call__({context:e},...i);return r instanceof Re&&r.traceback.push({position:this.pos,line:`${t.info.name||"<AnonFunction>"}(${i.map(Ee).join(", ")})`}),r}}class pe extends ne{constructor(e,t,n,i,r="(anon)",o=new R,s=""){super(e),this.arguments=n,this.body=t,this.name=r,this.this_=o,this.returnType=i,this.description=s}interpret_(e){var t,n,i;let r=[];for(let t of this.arguments){const n=ee(t,e);if(n instanceof Re)return n;r.push(n)}const o=this.returnType.interpret(e);return o.error?o.error:o.val instanceof A?new M(this.body,r,this.name,this.this_,o.val,e):new De(this.returnType.pos,"Type",null!==(n=null===(t=o.val)||void 0===t?void 0:t.typeName().valueOf())&&void 0!==n?n:"<Undefined>",null===(i=o.val)||void 0===i?void 0:i.str().valueOf(),`On func '${this.name}' return type`)}}class ve extends ne{constructor(e,t){super(e),this.value=t}interpret_(e){const t=new te;if(void 0===this.value)return t.funcReturn=new I,t;let n=this.value.interpret(e);return n.error?n.error:(t.funcReturn=n.val,t)}}class ye extends ne{constructor(e,t){super(e),this.value=t}interpret_(e){var t;const n=new te;if(void 0===this.value)return n.funcReturn=new I,n;let i=this.value.interpret(e);return i.error?i.error:((null===(t=i.val)||void 0===t?void 0:t.bool().valueOf())&&(n.funcReturn=i.val),n)}}class me extends ne{constructor(e,t,n){super(e),this.base=t,this.index=n}interpret_(e){var t;let n=this.base.interpret(e);if(n.error)return n;let i=this.index.interpret(e);if(i.error)return i;const r=i.val,o=n.val;if(!o||!r)return new I;if(void 0!==this.value){let n=this.value.interpret(e);if(n.error)return n;const i=z(o.__getProperty__({context:e},r));let s,a=n.val;if(null!==(t=this.assignType)&&void 0!==t||(this.assignType="="),!a)return new De(this.pos,"~undefined","undefined","undefined","N_indexed.interpret_");switch(this.assignType[0]){case"*":s=i.__multiply__({context:e},a);break;case"/":s=i.__divide__({context:e},a);break;case"+":s=i.__add__({context:e},a);break;case"-":s=i.__subtract__({context:e},a);break;case"=":s=a;break;default:return new Re(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(s instanceof Re)return s;if(!o.__setProperty__)return new De(this.pos,"mutable","immutable",o.valueOf());const l=o.__setProperty__({context:e},r,null!=s?s:new I);if(l instanceof Re)return l}return o.__getProperty__({context:e},r)}}class ge extends ne{constructor(e,t,n,i,r="<anon class>"){super(e),this.init=i,this.methods=t,this.name=r,this.extends_=n,this.instances=[]}interpret_(e){var t,n,i;const r=[];for(let n of this.methods){const i=n.interpret(e);if(i.error)return i.error;if(!(i.val instanceof M))return new De(this.pos,"Function",(null===(t=i.val)||void 0===t?void 0:t.typeName().valueOf())||"undefined","method on "+this.name);r.push(i.val)}let o,s;if(this.extends_){const t=this.extends_.interpret(e);if(t.error)return t.error;if(!(t.val instanceof A))return new De(this.pos,"Function",(null===(n=t.val)||void 0===n?void 0:n.typeName().valueOf())||"undefined","method on "+this.name);o=t.val}if(this.init){const t=this.init.interpret(e);if(t.error)return t.error;if(!(t.val instanceof M))return new De(this.pos,"Function",(null===(i=t.val)||void 0===i?void 0:i.typeName().valueOf())||"undefined","method on "+this.name);s=t.val}return new A(!1,this.name,r,o,s)}}class xe extends ne{constructor(e,t,n="(anon)",i=!1){super(e),this.name=n,this.statements=t,this.mutable=i}interpret_(e){const t=new Z;t.parent=e;const n=this.statements.interpret(t);return n.error?n:new B(new j(this.name),t.getSymbolTableAsDict(),this.mutable)}}class be extends ne{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;if("number"!=typeof t)return new De(this.pos,"number",typeof t);const n=new te;return n.val=new D(t),n}}class we extends ne{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;if("string"!=typeof t)return new De(this.pos,"string",typeof t);const n=new te;return n.val=new j(t),n}}class _e extends ne{constructor(e){super(e.pos,!0),this.a=e}interpret_(e){if(!e.has(this.a.value))return new Ue(this.a.pos,this.a.value);let t=new te,n=e.getSymbol(this.a.value);return n?n instanceof Re?n:(t.val=n.value,t):new I}}class Se extends ne{constructor(e=n.unknown){super(e,!0)}interpret_(e){const t=new te;return t.val=new I,t}}class Te extends ne{constructor(e){super(e,!0)}interpret_(e){const t=new te;return t.shouldBreak=!0,t}}class ke extends ne{constructor(e){super(e,!0)}interpret_(e){const t=new te;return t.shouldContinue=!0,t}}class Ce extends ne{constructor(e,t=n.unknown){super(t,!0),this.value=e}interpret_(e){return this.value}}function Oe(e,t=new WeakMap){let n;if(Object(e)!==e||e instanceof Function)return e;if(t.has(e))return t.get(e);try{n=new e.constructor}catch(t){n=Object.create(Object.getPrototypeOf(e))}return e instanceof Map?Array.from(e,(([e,i])=>n.set(Oe(e,t),Oe(i,t)))):e instanceof Set&&Array.from(e,(e=>n.add(Oe(e,t)))),t.set(e,n),Object.assign(n,...Object.keys(e).map((n=>({[n]:Oe(e[n],t)}))))}function Ee(e,t=0){if("string"==typeof e)return t>0?`'${e}'`:e;if(t>20)return"...";let n="";if(void 0===e)return"undefined";if(e instanceof C)return e.str().valueOf();if(e instanceof ne)return`<RunTimeNode: ${e.constructor.name}>`;switch(typeof e){case"object":if(Array.isArray(e)){n+="[";for(let i of e)try{n+=Ee(i,t+1)+", "}catch(e){n+="<large property>, "}e.length&&(n=n.substring(0,n.length-2)),n+="]"}else{try{n+=e.constructor.name}catch(e){n+="UNKNOWN_CONSTRUCTOR"}n+=": {\n";let i=0;for(let r in e)i++,e.hasOwnProperty&&e.hasOwnProperty(r)&&(n+=`  ${r}: ${Ee(e[r],t+1)||""}, \n`);i>0&&(n=n.substring(0,n.length-3)),n+="\n}\n"}break;case"string":n=`'${e}'`;break;case"bigint":case"number":case"boolean":n=`${e}`;break;case"undefined":n="<NativeUndefined>";break;case"function":n=`<NativeFunction ${e.name}>`}for(let e=0;e<t;e++)n=Ae(n);return n}const Pe=e=>new Promise((t=>setTimeout((()=>t()),e)));function Ae(e){return e.replace(/\n/g,"\n    ")}const Ie=e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e);class Re{constructor(e,t,n){this.traceback=[],this.pos=e,this.name=t,this.details=n}get colouredStr(){let e="";if(this.traceback.length){e=V.yellow("Error Traceback (most recent call last):\n");for(let t of[...this.traceback].reverse())e+=`    ${V.cyan(t.position.str)}:\n        ${t.line}\n`}return e+=`${V.red(this.name)}: ${this.details} \n at ${V.cyan(this.pos.str)}`,e}get str(){return`${this.name}: ${this.details} \n at ${this.pos.str}`}}class Be extends Re{constructor(e,t){super(e,"IllegalCharError",`'${t}'`)}}class Ne extends Re{constructor(e,t){super(e,"InvalidSyntaxError",t)}}class Me extends Re{constructor(e,t){super(e,"ExpectedCharError",`'${t}'`)}}class De extends Re{constructor(e,t,n,i="",r=""){super(e,"TypeError",`Expected type '${t}', got type '${n}' ${void 0===i?"":` on value '${Ee(i)}'`} ${r||""}`)}}class $e extends Re{constructor(e,t,n=""){super(e,"ImportError",`Could not import ${t}: ${n}`)}}class Ue extends Re{constructor(e,t){super(e,"ReferenceError",`${t} is not defined`)}}class je extends Re{constructor(e,t,n){var i;super(e,"IndexError",`'${t}' is not a property of '${(null===(i=null==n?void 0:n.info)||void 0===i?void 0:i.name)||Ee(n)}'`)}}class Le extends Re{constructor(e,t,i="",r=n.unknown){var o;super(r,"TypeError",`Cannot perform '${e}' on value ${(null===(o=null==t?void 0:t.info)||void 0===o?void 0:o.name)||Ee(t)}: ${i}`)}}class ze extends Re{constructor(){super(n.unknown,"InvalidRuntimeError","Required runtime of "+(h?"browser":"node"))}}class Ge extends Re{constructor(e){super(n.unknown,"TestFailed",e)}}class Fe{constructor(e,t,n){this.type=t,this.value=n,this.pos=e}matches(e,t){return this.type===e&&this.value===t}}class We{constructor(e,t){this.text=e,this.position=new n(-1,0,-1,t),this.advance()}advance(){this.position.advance(this.currentChar),this.currentChar=this.text[this.position.idx]}generate(){if(!this.text)return[new Fe(this.position,x.EOF)];const e=[];for(;void 0!==this.currentChar;)if(" \t\n".includes(this.currentChar))this.advance();else if(i.includes(this.currentChar))e.push(this.makeNumber());else if(this.currentChar===o[0]&&this.text[this.position.idx+1]===o[1])this.singleLineComment();else if(this.currentChar===s[0]&&this.text[this.position.idx+1]===s[1])this.multiLineComment();else if(r.includes(this.currentChar))e.push(this.makeIdentifier());else if(-1!==u.indexOf(this.currentChar))e.push(this.makeString());else{const t=this.currentChar;let n=this.unknownChar();if(!n){let e=this.position.clone,t=this.currentChar;return this.advance(),new Be(e,t)}n.type===x.ASSIGN&&(n.value=t),e.push(n)}return e.push(new Fe(this.position,x.EOF)),e}makeNumber(){const e=this.position.clone;let t="",n=0;for(;void 0!==this.currentChar&&(i+"._").includes(this.currentChar);){if("."===this.currentChar){if(1===n)break;n++,t+="."}else"_"!==this.currentChar&&(t+=this.currentChar);this.advance()}return new Fe(e,x.NUMBER,parseFloat(t))}makeString(){const e=this.position.clone;let t="",n=this.currentChar;for(this.advance();this.currentChar!==n&&void 0!==this.currentChar;)"\\"!==this.currentChar||(this.advance(),"n"!==this.currentChar)?(t+=this.currentChar,this.advance()):(t+="\n",this.advance());return this.advance(),new Fe(e,x.STRING,t)}makeIdentifier(){let e="";const t=this.position.clone;for(;void 0!==this.currentChar&&(r+i).includes(this.currentChar);)e+=this.currentChar,this.advance();let n=x.IDENTIFIER;return-1!==p.indexOf(e)&&(n=x.KEYWORD),new Fe(t,n,e)}unknownChar(){if(void 0!==this.currentChar){for(let e in S)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]&&e[2]===this.text[this.position.idx+2]){const t=this.position.clone;return this.advance(),this.advance(),this.advance(),new Fe(t,S[e])}for(let e in _)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]){const t=this.position.clone;return this.advance(),this.advance(),new Fe(t,_[e])}if(w.hasOwnProperty(this.currentChar)){let e=this.position.clone,t=w[this.currentChar];return this.advance(),new Fe(e,t)}}}singleLineComment(){for(this.advance();"\n"!==this.currentChar&&void 0!==this.currentChar;)this.advance();this.advance()}multiLineComment(){for(this.advance();this.currentChar!==a[0]||this.text[this.position.idx+1]!==a[1];)this.advance();this.advance(),this.advance()}}class Ve{constructor(){this.advanceCount=0,this.lastRegisteredAdvanceCount=0,this.reverseCount=0}registerAdvance(){this.advanceCount=1,this.lastRegisteredAdvanceCount++}register(e){return this.lastRegisteredAdvanceCount=e.advanceCount,this.advanceCount+=e.advanceCount,e.error&&(this.error=e.error),e.node?e.node:new Se}tryRegister(e){if(!e.error)return this.register(e);this.reverseCount+=e.advanceCount}success(e){return this.node=e,this}failure(e){return this.error=e,this}}class qe{constructor(e){this.tokens=e,this.tokenIdx=-1,this.currentToken=e[0],this.advance()}parse(){var e;if(!this.currentToken||!this.tokens||1===this.tokens.length&&this.tokens[0].type===x.EOF)return new Ve;const t=this.statements(!0);return t.error||this.currentToken.type===g.EOF?t:t.failure(new Ne(null===(e=this.currentToken)||void 0===e?void 0:e.pos,`Expected 'End of File', got token of type'${b[this.currentToken.type]}' of value ${this.currentToken.value}`))}advance(e){return e&&e.registerAdvance(),this.tokenIdx++,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}reverse(e=1){return this.tokenIdx-=e,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}consume(e,t,n){if(this.currentToken.type!==t)return e.failure(new Ne(this.currentToken.pos,null!=n?n:`Expected '${b[t]}' but got '${b[this.currentToken.type]}'`));this.advance(e)}clearEndStatements(e){for(;this.currentToken.type===x.ENDSTATEMENT;)this.advance(e)}statements(e=!1){const t=new Ve,n=this.currentToken.pos;let i=[];this.clearEndStatements(t);const r=t.register(this.statement());if(!r)return t;if(i.push(r),t.error)return t;let o=!0;for(;;){let e=0;for(;this.currentToken.type===x.ENDSTATEMENT;)this.advance(t),e++;if(0===e&&(o=!1),!o)break;const n=t.tryRegister(this.statement());n?i.push(n):this.reverse(t.reverseCount)}this.clearEndStatements(t);let s=new fe(n,i);return e&&(s=new ce(n,i,!0)),t.success(s)}statement(){const e=new Ve,t=this.currentToken.pos;if(this.currentToken.matches(x.KEYWORD,"return")){this.advance(e);let n=new Se(this.currentToken.pos);if(this.currentToken.type!==x.ENDSTATEMENT){let t=e.register(this.expr());if(!t)return e.failure(new Ne(this.currentToken.pos,"Expected end of statement"));n=t}return e.success(new ve(t,n))}if(this.currentToken.matches(x.KEYWORD,"yield")){this.advance(e);let n=new Se(this.currentToken.pos);if(this.currentToken.type!==x.ENDSTATEMENT){let t=e.register(this.expr());if(!t)return e.failure(new Ne(this.currentToken.pos,"Expected end of statement"));n=t}return e.success(new ye(t,n))}if(this.currentToken.matches(x.KEYWORD,"break"))return this.advance(e),e.success(new Te(t));if(this.currentToken.matches(x.KEYWORD,"continue"))return this.advance(e),e.success(new ke(t));const n=e.register(this.expr());return e.error?e:n?e.success(n):e.failure(new Ne(t,"No empty statements"))}atom(){const e=new Ve,t=this.currentToken,n=this.currentToken.pos;switch(t.type){case x.NUMBER:return this.advance(e),e.success(new be(n,t));case x.STRING:return this.advance(e),e.success(new we(n,t));case x.IDENTIFIER:return this.atomIdentifier(e,n,t);case x.OPAREN:this.advance(e);const i=e.register(this.expr());return e.error?e:this.currentToken.type==x.CPAREN?(this.advance(e),e.success(i)):e.failure(new Ne(this.currentToken.pos,"Expected ')'"));case x.OSQUARE:let r=e.register(this.array());return e.error?e:e.success(r);case x.OBRACES:let o=e.register(this.object());return e.error?e:e.success(o);case x.KEYWORD:if("if"===t.value){const t=e.register(this.ifExpr());return e.error?e:e.success(t)}return e.failure(new Ne(this.currentToken.pos,`Invalid Identifier ${t.value}`));default:return e.failure(new Ne(this.currentToken.pos,"Expected number, identifier, '(', '+' or '-'"))}}atomIdentifier(e,t,n){this.advance(e);let i=new _e(n),r=new Se(t),o=!1;for(;-1!==[x.OPAREN,x.OSQUARE,x.DOT].indexOf(this.currentToken.type);)switch(this.currentToken.type){case x.OPAREN:o=!0;const t=i;if(i=e.register(this.makeFunctionCall(i,r)),r=t,e.error)return e;break;case x.OSQUARE:if(r=i,i=e.register(this.makeIndex(i)),e.error)return e;break;case x.DOT:if(this.advance(e),this.currentToken.type!==x.IDENTIFIER)return e.failure(new Ne(this.currentToken.pos,"Expected identifier after '.'"));r=i,i=new me(this.currentToken.pos,i,new we(this.currentToken.pos,this.currentToken)),this.advance(e)}if(this.currentToken.type===x.ASSIGN){let n=this.currentToken.value;if(o)return e.failure(new Ne(t,"Cannot assign to return value of function"));this.advance(e);const r=e.register(this.expr());if(i instanceof _e)i=new oe(t,i.a,r,n,!1);else{if(!(i instanceof me))return e.failure(new Ne(t,`Cannot have node of type ${this.currentToken.constructor.name}.\n                            Expected either index or variable node.`));i.value=r,i.assignType=n}if(e.error)return e}return e.success(i)}power(){return this.binOp((()=>this.atom()),[g.POW],(()=>this.factor()))}factor(){const e=new Ve,t=this.currentToken;switch(t.type){case x.SUB:case x.ADD:this.advance(e);const n=e.register(this.factor());return e.error?e:e.success(new re(t.pos,n,t));default:return this.power()}}term(){return this.binOp((()=>this.factor()),[x.MUL,x.DIV])}arithmeticExpr(){return this.binOp((()=>this.term()),[x.ADD,x.SUB])}comparisonExpr(){const e=new Ve;if(this.currentToken.type===x.NOT){const t=this.currentToken;this.advance(e);let n=e.register(this.expr());return e.error?e:e.success(new re(t.pos,n,t))}let t=e.register(this.binOp((()=>this.arithmeticExpr()),[x.EQUALS,x.NOTEQUALS,x.GT,x.GTE,x.LTE,x.LT]));return e.error?e:e.success(t)}expr(){const e=new Ve;if(this.clearEndStatements(e),this.currentToken.type===x.KEYWORD&&-1!==["var","let","global","mutable","const","local"].indexOf(this.currentToken.value))return this.initiateVar(e);if(this.currentToken.matches(g.KEYWORD,"if"))return this.ifExpr();if(this.currentToken.matches(g.KEYWORD,"while"))return this.whileExpr();if(this.currentToken.matches(g.KEYWORD,"for"))return this.forExpr();if(this.currentToken.matches(g.KEYWORD,"func"))return this.funcExpr();if(this.currentToken.matches(g.KEYWORD,"class"))return this.classExpr();if(this.currentToken.matches(g.KEYWORD,"namespace"))return this.namespace();let t=e.register(this.binOp((()=>this.comparisonExpr()),[x.AND,x.OR]));return e.error?e:e.success(t)}binOp(e,t,n=e){const i=new Ve;let r=i.register(e());if(i.error)return i;for(;-1!==t.indexOf(this.currentToken.type)||-1!==t.indexOf([this.currentToken.type,this.currentToken.value]);){const e=this.currentToken;this.advance(i);const t=i.register(n());if(i.error)return i;r=new ie(r.pos,r,e,t)}return i.success(r)}typeExpr(){const e=new Ve;if(this.currentToken.type!==x.IDENTIFIER)return e.failure(new Ne(this.currentToken.pos.clone,"Expected an identifier"));let t=this.currentToken;return this.advance(e),e.success(new _e(t))}makeFunctionCall(e,t=new Se){const n=new Ve;let i=[];const r=this.currentToken.pos;if(this.currentToken.type!==x.OPAREN)return n.failure(new Ne(r,"Expected '['"));if(this.advance(n),this.currentToken.type===x.CPAREN)return this.advance(n),n.success(new de(r,e,[]));if(i.push(n.register(this.expr())),n.error)return n.failure(new Ne(this.currentToken.pos,"Invalid argument"));for(;this.currentToken.type===x.COMMA;)if(this.advance(n),i.push(n.register(this.expr())),n.error)return n;return this.currentToken.type!==x.CPAREN?n.failure(new Ne(this.currentToken.pos,"Expected ',' or ')'")):(this.advance(n),n.success(new de(r,e,i)))}makeIndex(e){const t=new Ve,n=this.currentToken.pos,i=e;if(this.currentToken.type!==x.OSQUARE)return t.failure(new Ne(n,"Expected '["));if(this.advance(t),this.currentToken.type===x.CSQUARE)return t.failure(new Ne(n,"Cannot index without expression"));let r=t.register(this.expr());return t.error?t.failure(new Ne(this.currentToken.pos,"Invalid index")):this.currentToken.type!==x.CSQUARE?t.failure(new Ne(this.currentToken.pos,"Expected ']'")):(this.advance(t),t.success(new me(n,i,r)))}initiateVar(e){let t=this.currentToken.pos,n=!1,i=!1,r=!1,o=!1;if(this.currentToken.type===x.KEYWORD&&-1!==["var","let"].indexOf(this.currentToken.value)&&(o=!0,i=!0,this.advance(e),e.error))return e;if(this.currentToken.type===x.KEYWORD&&-1!==["global","local"].indexOf(this.currentToken.value)&&(o=!0,"global"===this.currentToken.value?r=!0:i=!0,this.advance(e),e.error))return e;if(this.currentToken.type===x.KEYWORD&&-1!==["const","mutable"].indexOf(this.currentToken.value)&&(o=!0,"const"===this.currentToken.value&&(n=!0),this.advance(e),e.error))return e;if(this.currentToken.type===x.KEYWORD)return e.failure(new Ne(this.currentToken.pos,`Expected Identifier 'var', 'let', 'const', 'mutable', 'local', or 'global', not ${this.currentToken.value}`));if(this.currentToken.type!==g.IDENTIFIER)return e.failure(new Ne(this.currentToken.pos,"Expected Identifier or Keyword"));const s=this.currentToken;this.advance(e);let a=k.any;if(this.currentToken.type===x.COLON&&(o=!0,this.consume(e,x.COLON),a=e.register(this.typeExpr())),this.currentToken.type!==x.ASSIGN)return n?e.failure(new Ne(t,"Cannot initialise constant to undefined")):e.success(new oe(t,s,new Se(this.currentToken.pos),"=",r,i,n,o,a));let l=this.currentToken.value;this.advance(e);const c=e.register(this.expr());return e.error?e:((c instanceof ge||c instanceof pe)&&(c.name=s.value),c instanceof xe&&(c.name=s.value,c.mutable=!n),e.success(new oe(t,s,c,l,r,i,n,o,a)))}bracesExp(){const e=new Ve;if(this.consume(e,x.OBRACES),e.error)return e;if(this.clearEndStatements(e),this.currentToken.type===x.CBRACES)return this.advance(e),e.success(new Se(this.currentToken.pos));const t=e.register(this.statements());return e.error?e:(this.consume(e,x.CBRACES),e.error?e:e.success(t))}addEndStatement(e){this.tokens.splice(this.tokenIdx,0,new Fe(this.currentToken.pos,x.ENDSTATEMENT)),this.reverse(),this.advance(e)}ifExpr(){const e=new Ve;let t,n,i;const r=this.currentToken.pos;if(!this.currentToken.matches(x.KEYWORD,"if"))return e.failure(new Ne(this.currentToken.pos,"Expected 'if'"));if(this.advance(e),i=e.register(this.expr()),e.error)return e;if(t=e.register(this.bracesExp()),e.error)return e;if(this.clearEndStatements(e),this.currentToken.matches(x.KEYWORD,"else"))if(this.advance(e),this.currentToken.type==x.OBRACES){if(n=e.register(this.bracesExp()),e.error)return e}else if(n=e.register(this.statement()),e.error)return e;return this.addEndStatement(e),e.success(new se(r,i,t,n))}whileExpr(){const e=new Ve;let t,n;const i=this.currentToken.pos;return this.currentToken.matches(x.KEYWORD,"while")?(this.advance(e),n=e.register(this.expr()),e.error?e:(t=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.success(new ae(i,n,t))))):e.failure(new Ne(this.currentToken.pos,"Expected 'while'"))}parameter(e){let t,n=new Ce(k.any);if(this.currentToken.type!==x.IDENTIFIER)return new Ne(this.currentToken.pos,"Expected identifier");if(t=this.currentToken.value,this.advance(e),this.currentToken.type===x.COLON){if(this.consume(e,x.COLON),e.error)return e.error;if(n=e.register(this.typeExpr()),e.error)return e.error}return{name:t,type:n}}funcCore(){const e=new Ve,t=this.currentToken.pos;let n,i=[],r=new Ce(k.any);if(this.consume(e,x.OPAREN),this.currentToken.type===x.CPAREN)this.advance(e);else{let t=this.parameter(e);if(t instanceof Re)return e.failure(t);for(i.push(t);this.currentToken.type===x.COMMA;){this.advance(e);let t=this.parameter(e);if(t instanceof Re)return e.failure(t);i.push(t)}if(this.currentToken.type!==x.CPAREN)return e.failure(new Ne(this.currentToken.pos,"Expected ',' or ')'"));this.advance(e)}if(this.currentToken.type===x.COLON&&(this.advance(e),r=e.register(this.typeExpr()),e.error))return e;if(this.currentToken.type!==x.OBRACES){if(n=new ve(this.currentToken.pos,e.register(this.expr())),e.error)return e}else{if(this.consume(e,x.OBRACES),e.error)return e;if(n=this.currentToken.type!==x.CBRACES?e.register(this.statements()):new Se(this.currentToken.pos),this.consume(e,x.CBRACES),e.error)return e}return e.success(new pe(t,n,i,r))}funcExpr(){const e=new Ve;if(!this.currentToken.matches(x.KEYWORD,"func"))return e.failure(new Ne(this.currentToken.pos,"Expected 'func'"));this.advance(e);const t=e.register(this.funcCore());return e.error?e:e.success(t)}classExpr(e){const t=new Ve,n=this.currentToken.pos,i=[];let r,o;if(!this.currentToken.matches(x.KEYWORD,"class"))return t.failure(new Ne(this.currentToken.pos,"Expected 'class'"));if(this.advance(t),this.currentToken.matches(x.KEYWORD,"extends")&&(this.advance(t),o=t.register(this.expr()),t.error))return t;if(this.consume(t,x.OBRACES),t.error)return t;if(this.currentToken.type===x.CBRACES)return this.advance(t),t.success(new ge(n,[],void 0,void 0,e));for(;this.currentToken.type===x.IDENTIFIER;){let e=this.currentToken.value;this.advance(t);const n=t.register(this.funcCore());if(t.error)return t;if(!(n instanceof pe))return t.failure(new Re(this.currentToken.pos,"ParseError",`Tried to get function, but got ${n} instead`));n.name=e,"init"===e?r=n:i.push(n)}return this.consume(t,x.CBRACES),t.success(new ge(n,i,o,r,e))}forExpr(){const e=new Ve,t=this.currentToken.pos;let n,i,r,o=!1,s=!1;return this.currentToken.matches(x.KEYWORD,"for")?(this.advance(e),this.currentToken.matches(x.KEYWORD,"global")?(o=!0,this.advance(e)):this.currentToken.matches(x.KEYWORD,"const")?(s=!0,this.advance(e)):(this.currentToken.matches(x.KEYWORD,"var")||this.currentToken.matches(x.KEYWORD,"let"))&&this.advance(e),this.currentToken.type!==x.IDENTIFIER?e.failure(new Ne(this.currentToken.pos,"Expected identifier")):(r=this.currentToken,this.advance(e),this.currentToken.matches(x.KEYWORD,"in")?(this.advance(e),i=e.register(this.expr()),e.error?e:(n=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.success(new le(t,n,i,r,o,s))))):e.failure(new Ne(this.currentToken.pos,"Expected keyword 'in")))):e.failure(new Ne(this.currentToken.pos,"Expected 'for'"))}array(){const e=new Ve;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==x.OSQUARE)return e.failure(new Ne(n,"Expected '["));if(this.advance(e),this.currentToken.type===x.CSQUARE)return this.advance(e),e.success(new ce(n,[]));if(t.push(e.register(this.expr())),e.error)return e.failure(new Ne(this.currentToken.pos,"Expected ']', 'var', 'if', 'for', 'while', number, identifier, '+', '-', '(', '[' or '!' 2"));for(;this.currentToken.type===x.COMMA;)if(this.advance(e),t.push(e.register(this.expr())),e.error)return e;return this.currentToken.type!==x.CSQUARE?e.failure(new Ne(this.currentToken.pos,"Expected ',' or ']'")):(this.advance(e),e.success(new ce(n,t)))}object(){const e=new Ve;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==x.OBRACES)return e.failure(new Ne(n,"Expected '{"));if(this.advance(e),this.currentToken.type===x.CBRACES)return this.advance(e),e.success(new he(n));for(;;){let n,i,r;if(this.currentToken.type===x.IDENTIFIER)n="id",i=new we(this.currentToken.pos,this.currentToken),this.advance(e);else if(this.currentToken.type===x.STRING)n="string",i=new we(this.currentToken.pos,this.currentToken),this.advance(e);else{if(this.currentToken.type!==x.OSQUARE)break;if(n="value",this.advance(e),i=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==x.CSQUARE)return e.failure(new Ne(this.currentToken.pos,`Expected ']', got '${b[this.currentToken.type]}'`));this.advance(e)}if(this.currentToken.type===x.COLON){if(this.advance(e),r=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==x.COMMA&&this.currentToken.type!==x.CBRACES)return e.failure(new Ne(this.currentToken.pos,`Expected ',' or '}', got '${b[this.currentToken.type]}'`));this.currentToken.type===x.COMMA&&this.advance(e)}else{if(this.currentToken.type!==x.COMMA&&this.currentToken.type!==x.CBRACES)return e.failure(new Ne(this.currentToken.pos,`Expected ',' or '}', got '${b[this.currentToken.type]}'`));if("id"!==n)return e.failure(new Ne(this.currentToken.pos,"You must specify a value when initialising an object literal with a key that is not an identifier.\n                        Try using `key: value` syntax."));this.reverse(),r=new _e(this.currentToken),this.advance(e),this.currentToken.type===x.COMMA&&this.advance(e)}if(t.push([i,r]),e.error)return e}return this.currentToken.type!==x.CBRACES?e.failure(new Ne(this.currentToken.pos,"Expected identifier, ',' or '}'")):(this.advance(e),e.success(new ue(n,t)))}namespace(){const e=new Ve,t=this.currentToken.pos;if(this.consume(e,x.KEYWORD),e.error)return e;if(this.consume(e,x.OBRACES),e.error)return e;if(this.currentToken.type===x.CBRACES)return this.advance(e),e.success(new xe(t,new Se));const n=e.register(this.statements());return e.error?e:(this.consume(e,x.CBRACES),e.error?e:e.success(new xe(t,n)))}}function He(e=console.log,t,i=!0,r={print:console.log},o=new Z,s=""){var a,u,h,p;return u=this,void 0,p=function*(){const u=X(o,e,t);if(u instanceof Re)return u;c(o),null!==(a=r.context)&&void 0!==a||(r.context=o),s&&(o.path=s),r.print&&(d.print=r.print),i&&(f(),yield y(!0),function(e,t){const{fs:i,path:r}=e;for(let t in e)e.hasOwnProperty(t)&&(o=t,s=new N(e[t],t),function(e,t){H[e]={},Y[e]=t}(o,Q(z(s),o)));var o,s;t.set("import",new M((({context:e},t)=>{let o=Ee(t);if(K(o))return J(o);if(o=r.join(e.path,o),o in m)return m[o];try{if(!i.existsSync(o)){if(!i.existsSync("./particles/"+o))return new Re(n.unknown,"ImportError",`Can't find file '${o}' to import.`);if(!i.existsSync("particles/"+o+"/main.es"))return new Re(n.unknown,"ImportError",`Module '${o}' has no entry point. Requires 'main.es'.`);o="particles/"+o+"/main.es"}const e=r.dirname(o),t=i.readFileSync(o,"utf-8"),s=new Z;s.parent=l,s.path=e;const a=new B(new j(o),{});m[o]=a;const c=Ye(t,{env:s,measurePerformance:!1,fileName:o,currentDir:e});return a.__value__=s.getSymbolTableAsDict(),c.error?c.error:a}catch(e){return new Re(n.unknown,"ImportError",e.toString())}}),[{name:"path",type:k.string}],"import",void 0,k.object),{forceThroughConst:!0,isConstant:!0}),t.setOwn("open",new M((({context:e},t,r)=>{const o=Ee(t),s=Ee(r)||"utf-8";return i.existsSync(o)?new R({str:new M((({context:e})=>new j(i.readFileSync(e.path+o,s))),[],"str",void 0,k.string),write:new M((({context:e},t)=>{i.writeFileSync(e.path+o,Ee(t))}),[{name:"path",type:k.string}]),append:new M((({context:e},t)=>{i.appendFileSync(e.path+o,Ee(t))}),[{name:"path",type:k.string}])}):new $e(n.unknown,o)})))}(r,o))},new((h=void 0)||(h=Promise))((function(e,t){function n(e){try{r(p.next(e))}catch(e){t(e)}}function i(e){try{r(p.throw(e))}catch(e){t(e)}}function r(t){var r;t.done?e(t.value):(r=t.value,r instanceof h?r:new h((function(e){e(r)}))).then(n,i)}r((p=p.apply(u,[])).next())}))}function Ye(e,{env:t=l,measurePerformance:i=!1,fileName:r="(unknown)",currentDir:o=""}={}){o&&(t.path=o),ne.maxTime=0,ne.totalTime=0,ne.interprets=0;const s={total:0,lexerTotal:0,parserTotal:0,interpretTotal:0,nodeMax:0,nodeAvg:0,nodeTotal:0,interprets:0};let a=v();if(!t.root.initialisedAsGlobal){const e=new te;return e.error=new Re(n.unknown,"Uninitialised","Global context has not been initialised with global values"),e}const c=new We(e,r).generate();if(c instanceof Re){const e=new te;return e.error=c,e}s.lexerTotal=v()-a,a=v();const u=new qe(c).parse();if(u.error){const e=new te;return e.error=u.error,e}if(s.parserTotal=v()-a,a=v(),!u.node){const e=new te;return e.val=new U([]),e}const h=u.node.interpret(t);return s.interpretTotal=v()-a,s.total=v()-a,s.nodeMax=ne.maxTime,s.nodeTotal=ne.totalTime,s.nodeAvg=ne.totalTime/ne.interprets,s.interprets=ne.interprets,i&&console.log(s),Object.assign(Object.assign({},h),{timeData:s})}return t})()},842:function(e,t,n){var i;i=function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=21)}([function(e,t){var i={};e.exports=i,function(){i._nextId=0,i._seed=0,i._nowStartTime=+new Date,i._warnedOnce={},i._decomp=null,i.extend=function(e,t){var n,r;"boolean"==typeof t?(n=2,r=t):(n=1,r=!0);for(var o=n;o<arguments.length;o++){var s=arguments[o];if(s)for(var a in s)r&&s[a]&&s[a].constructor===Object?e[a]&&e[a].constructor!==Object?e[a]=s[a]:(e[a]=e[a]||{},i.extend(e[a],r,s[a])):e[a]=s[a]}return e},i.clone=function(e,t){return i.extend({},t,e)},i.keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var n in e)t.push(n);return t},i.values=function(e){var t=[];if(Object.keys){for(var n=Object.keys(e),i=0;i<n.length;i++)t.push(e[n[i]]);return t}for(var r in e)t.push(e[r]);return t},i.get=function(e,t,n,i){t=t.split(".").slice(n,i);for(var r=0;r<t.length;r+=1)e=e[t[r]];return e},i.set=function(e,t,n,r,o){var s=t.split(".").slice(r,o);return i.get(e,t,0,-1)[s[s.length-1]]=n,n},i.shuffle=function(e){for(var t=e.length-1;t>0;t--){var n=Math.floor(i.random()*(t+1)),r=e[t];e[t]=e[n],e[n]=r}return e},i.choose=function(e){return e[Math.floor(i.random()*e.length)]},i.isElement=function(e){return"undefined"!=typeof HTMLElement?e instanceof HTMLElement:!!(e&&e.nodeType&&e.nodeName)},i.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},i.isFunction=function(e){return"function"==typeof e},i.isPlainObject=function(e){return"object"==typeof e&&e.constructor===Object},i.isString=function(e){return"[object String]"===toString.call(e)},i.clamp=function(e,t,n){return e<t?t:e>n?n:e},i.sign=function(e){return e<0?-1:1},i.now=function(){if("undefined"!=typeof window&&window.performance){if(window.performance.now)return window.performance.now();if(window.performance.webkitNow)return window.performance.webkitNow()}return Date.now?Date.now():new Date-i._nowStartTime},i.random=function(t,n){return n=void 0!==n?n:1,(t=void 0!==t?t:0)+e()*(n-t)};var e=function(){return i._seed=(9301*i._seed+49297)%233280,i._seed/233280};i.colorToNumber=function(e){return 3==(e=e.replace("#","")).length&&(e=e.charAt(0)+e.charAt(0)+e.charAt(1)+e.charAt(1)+e.charAt(2)+e.charAt(2)),parseInt(e,16)},i.logLevel=1,i.log=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.log.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.info=function(){console&&i.logLevel>0&&i.logLevel<=2&&console.info.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warn=function(){console&&i.logLevel>0&&i.logLevel<=3&&console.warn.apply(console,["matter-js:"].concat(Array.prototype.slice.call(arguments)))},i.warnOnce=function(){var e=Array.prototype.slice.call(arguments).join(" ");i._warnedOnce[e]||(i.warn(e),i._warnedOnce[e]=!0)},i.deprecated=function(e,t,n){e[t]=i.chain((function(){i.warnOnce("🔅 deprecated 🔅",n)}),e[t])},i.nextId=function(){return i._nextId++},i.indexOf=function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},i.map=function(e,t){if(e.map)return e.map(t);for(var n=[],i=0;i<e.length;i+=1)n.push(t(e[i]));return n},i.topologicalSort=function(e){var t=[],n=[],r=[];for(var o in e)n[o]||r[o]||i._topologicalSort(o,n,r,e,t);return t},i._topologicalSort=function(e,t,n,r,o){var s=r[e]||[];n[e]=!0;for(var a=0;a<s.length;a+=1){var l=s[a];n[l]||t[l]||i._topologicalSort(l,t,n,r,o)}n[e]=!1,t[e]=!0,o.push(e)},i.chain=function(){for(var e=[],t=0;t<arguments.length;t+=1){var n=arguments[t];n._chained?e.push.apply(e,n._chained):e.push(n)}var i=function(){for(var t,n=new Array(arguments.length),i=0,r=arguments.length;i<r;i++)n[i]=arguments[i];for(i=0;i<e.length;i+=1){var o=e[i].apply(t,n);void 0!==o&&(t=o)}return t};return i._chained=e,i},i.chainPathBefore=function(e,t,n){return i.set(e,t,i.chain(n,i.get(e,t)))},i.chainPathAfter=function(e,t,n){return i.set(e,t,i.chain(i.get(e,t),n))},i.setDecomp=function(e){i._decomp=e},i.getDecomp=function(){var e=i._decomp;try{e||"undefined"==typeof window||(e=window.decomp),e||void 0===n.g||(e=n.g.decomp)}catch(t){e=null}return e}}()},function(e,t){var n={};e.exports=n,n.create=function(e){var t={min:{x:0,y:0},max:{x:0,y:0}};return e&&n.update(t,e),t},n.update=function(e,t,n){e.min.x=1/0,e.max.x=-1/0,e.min.y=1/0,e.max.y=-1/0;for(var i=0;i<t.length;i++){var r=t[i];r.x>e.max.x&&(e.max.x=r.x),r.x<e.min.x&&(e.min.x=r.x),r.y>e.max.y&&(e.max.y=r.y),r.y<e.min.y&&(e.min.y=r.y)}n&&(n.x>0?e.max.x+=n.x:e.min.x+=n.x,n.y>0?e.max.y+=n.y:e.min.y+=n.y)},n.contains=function(e,t){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y},n.overlaps=function(e,t){return e.min.x<=t.max.x&&e.max.x>=t.min.x&&e.max.y>=t.min.y&&e.min.y<=t.max.y},n.translate=function(e,t){e.min.x+=t.x,e.max.x+=t.x,e.min.y+=t.y,e.max.y+=t.y},n.shift=function(e,t){var n=e.max.x-e.min.x,i=e.max.y-e.min.y;e.min.x=t.x,e.max.x=t.x+n,e.min.y=t.y,e.max.y=t.y+i}},function(e,t){var n={};e.exports=n,n.create=function(e,t){return{x:e||0,y:t||0}},n.clone=function(e){return{x:e.x,y:e.y}},n.magnitude=function(e){return Math.sqrt(e.x*e.x+e.y*e.y)},n.magnitudeSquared=function(e){return e.x*e.x+e.y*e.y},n.rotate=function(e,t,n){var i=Math.cos(t),r=Math.sin(t);n||(n={});var o=e.x*i-e.y*r;return n.y=e.x*r+e.y*i,n.x=o,n},n.rotateAbout=function(e,t,n,i){var r=Math.cos(t),o=Math.sin(t);i||(i={});var s=n.x+((e.x-n.x)*r-(e.y-n.y)*o);return i.y=n.y+((e.x-n.x)*o+(e.y-n.y)*r),i.x=s,i},n.normalise=function(e){var t=n.magnitude(e);return 0===t?{x:0,y:0}:{x:e.x/t,y:e.y/t}},n.dot=function(e,t){return e.x*t.x+e.y*t.y},n.cross=function(e,t){return e.x*t.y-e.y*t.x},n.cross3=function(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)},n.add=function(e,t,n){return n||(n={}),n.x=e.x+t.x,n.y=e.y+t.y,n},n.sub=function(e,t,n){return n||(n={}),n.x=e.x-t.x,n.y=e.y-t.y,n},n.mult=function(e,t){return{x:e.x*t,y:e.y*t}},n.div=function(e,t){return{x:e.x/t,y:e.y/t}},n.perp=function(e,t){return{x:(t=!0===t?-1:1)*-e.y,y:t*e.x}},n.neg=function(e){return{x:-e.x,y:-e.y}},n.angle=function(e,t){return Math.atan2(t.y-e.y,t.x-e.x)},n._temp=[n.create(),n.create(),n.create(),n.create(),n.create(),n.create()]},function(e,t,n){var i={};e.exports=i;var r=n(2),o=n(0);i.create=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i],o={x:r.x,y:r.y,index:i,body:t,isInternal:!1};n.push(o)}return n},i.fromPath=function(e,t){var n=[];return e.replace(/L?\s*([-\d.e]+)[\s,]*([-\d.e]+)*/gi,(function(e,t,i){n.push({x:parseFloat(t),y:parseFloat(i)})})),i.create(n,t)},i.centre=function(e){for(var t,n,o,s=i.area(e,!0),a={x:0,y:0},l=0;l<e.length;l++)o=(l+1)%e.length,t=r.cross(e[l],e[o]),n=r.mult(r.add(e[l],e[o]),t),a=r.add(a,n);return r.div(a,6*s)},i.mean=function(e){for(var t={x:0,y:0},n=0;n<e.length;n++)t.x+=e[n].x,t.y+=e[n].y;return r.div(t,e.length)},i.area=function(e,t){for(var n=0,i=e.length-1,r=0;r<e.length;r++)n+=(e[i].x-e[r].x)*(e[i].y+e[r].y),i=r;return t?n/2:Math.abs(n)/2},i.inertia=function(e,t){for(var n,i,o=0,s=0,a=e,l=0;l<a.length;l++)i=(l+1)%a.length,o+=(n=Math.abs(r.cross(a[i],a[l])))*(r.dot(a[i],a[i])+r.dot(a[i],a[l])+r.dot(a[l],a[l])),s+=n;return t/6*(o/s)},i.translate=function(e,t,n){n=void 0!==n?n:1;var i,r=e.length,o=t.x*n,s=t.y*n;for(i=0;i<r;i++)e[i].x+=o,e[i].y+=s;return e},i.rotate=function(e,t,n){if(0!==t){var i,r,o,s,a=Math.cos(t),l=Math.sin(t),c=n.x,u=n.y,h=e.length;for(s=0;s<h;s++)r=(i=e[s]).x-c,o=i.y-u,i.x=c+(r*a-o*l),i.y=u+(r*l+o*a);return e}},i.contains=function(e,t){for(var n,i=t.x,r=t.y,o=e.length,s=e[o-1],a=0;a<o;a++){if(n=e[a],(i-s.x)*(n.y-s.y)+(r-s.y)*(s.x-n.x)>0)return!1;s=n}return!0},i.scale=function(e,t,n,o){if(1===t&&1===n)return e;var s,a;o=o||i.centre(e);for(var l=0;l<e.length;l++)s=e[l],a=r.sub(s,o),e[l].x=o.x+a.x*t,e[l].y=o.y+a.y*n;return e},i.chamfer=function(e,t,n,i,s){t="number"==typeof t?[t]:t||[8],n=void 0!==n?n:-1,i=i||2,s=s||14;for(var a=[],l=0;l<e.length;l++){var c=e[l-1>=0?l-1:e.length-1],u=e[l],h=e[(l+1)%e.length],f=t[l<t.length?l:t.length-1];if(0!==f){var d=r.normalise({x:u.y-c.y,y:c.x-u.x}),p=r.normalise({x:h.y-u.y,y:u.x-h.x}),v=Math.sqrt(2*Math.pow(f,2)),y=r.mult(o.clone(d),f),m=r.normalise(r.mult(r.add(d,p),.5)),g=r.sub(u,r.mult(m,v)),x=n;-1===n&&(x=1.75*Math.pow(f,.32)),(x=o.clamp(x,i,s))%2==1&&(x+=1);for(var b=Math.acos(r.dot(d,p))/x,w=0;w<x;w++)a.push(r.add(r.rotate(y,b*w),g))}else a.push(u)}return a},i.clockwiseSort=function(e){var t=i.mean(e);return e.sort((function(e,n){return r.angle(t,e)-r.angle(t,n)})),e},i.isConvex=function(e){var t,n,i,r,o=0,s=e.length;if(s<3)return null;for(t=0;t<s;t++)if(i=(t+2)%s,r=(e[n=(t+1)%s].x-e[t].x)*(e[i].y-e[n].y),(r-=(e[n].y-e[t].y)*(e[i].x-e[n].x))<0?o|=1:r>0&&(o|=2),3===o)return!1;return 0!==o||null},i.hull=function(e){var t,n,i=[],o=[];for((e=e.slice(0)).sort((function(e,t){var n=e.x-t.x;return 0!==n?n:e.y-t.y})),n=0;n<e.length;n+=1){for(t=e[n];o.length>=2&&r.cross3(o[o.length-2],o[o.length-1],t)<=0;)o.pop();o.push(t)}for(n=e.length-1;n>=0;n-=1){for(t=e[n];i.length>=2&&r.cross3(i[i.length-2],i[i.length-1],t)<=0;)i.pop();i.push(t)}return i.pop(),o.pop(),i.concat(o)}},function(e,t,n){var i={};e.exports=i;var r=n(0);i.on=function(e,t,n){for(var i,r=t.split(" "),o=0;o<r.length;o++)i=r[o],e.events=e.events||{},e.events[i]=e.events[i]||[],e.events[i].push(n);return n},i.off=function(e,t,n){if(t){"function"==typeof t&&(n=t,t=r.keys(e.events).join(" "));for(var i=t.split(" "),o=0;o<i.length;o++){var s=e.events[i[o]],a=[];if(n&&s)for(var l=0;l<s.length;l++)s[l]!==n&&a.push(s[l]);e.events[i[o]]=a}}else e.events={}},i.trigger=function(e,t,n){var i,o,s,a,l=e.events;if(l&&r.keys(l).length>0){n||(n={}),i=t.split(" ");for(var c=0;c<i.length;c++)if(s=l[o=i[c]]){(a=r.clone(n,!1)).name=o,a.source=e;for(var u=0;u<s.length;u++)s[u].apply(e,[a])}}}},function(e,t,n){var i={};e.exports=i;var r=n(4),o=n(0),s=n(1),a=n(6);i.create=function(e){return o.extend({id:o.nextId(),type:"composite",parent:null,isModified:!1,bodies:[],constraints:[],composites:[],label:"Composite",plugin:{},cache:{allBodies:null,allConstraints:null,allComposites:null}},e)},i.setModified=function(e,t,n,r){if(e.isModified=t,t&&e.cache&&(e.cache.allBodies=null,e.cache.allConstraints=null,e.cache.allComposites=null),n&&e.parent&&i.setModified(e.parent,t,n,r),r)for(var o=0;o<e.composites.length;o++){var s=e.composites[o];i.setModified(s,t,n,r)}},i.add=function(e,t){var n=[].concat(t);r.trigger(e,"beforeAdd",{object:t});for(var s=0;s<n.length;s++){var a=n[s];switch(a.type){case"body":if(a.parent!==a){o.warn("Composite.add: skipped adding a compound body part (you must add its parent instead)");break}i.addBody(e,a);break;case"constraint":i.addConstraint(e,a);break;case"composite":i.addComposite(e,a);break;case"mouseConstraint":i.addConstraint(e,a.constraint)}}return r.trigger(e,"afterAdd",{object:t}),e},i.remove=function(e,t,n){var o=[].concat(t);r.trigger(e,"beforeRemove",{object:t});for(var s=0;s<o.length;s++){var a=o[s];switch(a.type){case"body":i.removeBody(e,a,n);break;case"constraint":i.removeConstraint(e,a,n);break;case"composite":i.removeComposite(e,a,n);break;case"mouseConstraint":i.removeConstraint(e,a.constraint)}}return r.trigger(e,"afterRemove",{object:t}),e},i.addComposite=function(e,t){return e.composites.push(t),t.parent=e,i.setModified(e,!0,!0,!1),e},i.removeComposite=function(e,t,n){var r=o.indexOf(e.composites,t);if(-1!==r&&i.removeCompositeAt(e,r),n)for(var s=0;s<e.composites.length;s++)i.removeComposite(e.composites[s],t,!0);return e},i.removeCompositeAt=function(e,t){return e.composites.splice(t,1),i.setModified(e,!0,!0,!1),e},i.addBody=function(e,t){return e.bodies.push(t),i.setModified(e,!0,!0,!1),e},i.removeBody=function(e,t,n){var r=o.indexOf(e.bodies,t);if(-1!==r&&i.removeBodyAt(e,r),n)for(var s=0;s<e.composites.length;s++)i.removeBody(e.composites[s],t,!0);return e},i.removeBodyAt=function(e,t){return e.bodies.splice(t,1),i.setModified(e,!0,!0,!1),e},i.addConstraint=function(e,t){return e.constraints.push(t),i.setModified(e,!0,!0,!1),e},i.removeConstraint=function(e,t,n){var r=o.indexOf(e.constraints,t);if(-1!==r&&i.removeConstraintAt(e,r),n)for(var s=0;s<e.composites.length;s++)i.removeConstraint(e.composites[s],t,!0);return e},i.removeConstraintAt=function(e,t){return e.constraints.splice(t,1),i.setModified(e,!0,!0,!1),e},i.clear=function(e,t,n){if(n)for(var r=0;r<e.composites.length;r++)i.clear(e.composites[r],t,!0);return t?e.bodies=e.bodies.filter((function(e){return e.isStatic})):e.bodies.length=0,e.constraints.length=0,e.composites.length=0,i.setModified(e,!0,!0,!1),e},i.allBodies=function(e){if(e.cache&&e.cache.allBodies)return e.cache.allBodies;for(var t=[].concat(e.bodies),n=0;n<e.composites.length;n++)t=t.concat(i.allBodies(e.composites[n]));return e.cache&&(e.cache.allBodies=t),t},i.allConstraints=function(e){if(e.cache&&e.cache.allConstraints)return e.cache.allConstraints;for(var t=[].concat(e.constraints),n=0;n<e.composites.length;n++)t=t.concat(i.allConstraints(e.composites[n]));return e.cache&&(e.cache.allConstraints=t),t},i.allComposites=function(e){if(e.cache&&e.cache.allComposites)return e.cache.allComposites;for(var t=[].concat(e.composites),n=0;n<e.composites.length;n++)t=t.concat(i.allComposites(e.composites[n]));return e.cache&&(e.cache.allComposites=t),t},i.get=function(e,t,n){var r,o;switch(n){case"body":r=i.allBodies(e);break;case"constraint":r=i.allConstraints(e);break;case"composite":r=i.allComposites(e).concat(e)}return r?0===(o=r.filter((function(e){return e.id.toString()===t.toString()}))).length?null:o[0]:null},i.move=function(e,t,n){return i.remove(e,t),i.add(n,t),e},i.rebase=function(e){for(var t=i.allBodies(e).concat(i.allConstraints(e)).concat(i.allComposites(e)),n=0;n<t.length;n++)t[n].id=o.nextId();return e},i.translate=function(e,t,n){for(var r=n?i.allBodies(e):e.bodies,o=0;o<r.length;o++)a.translate(r[o],t);return e},i.rotate=function(e,t,n,r){for(var o=Math.cos(t),s=Math.sin(t),l=r?i.allBodies(e):e.bodies,c=0;c<l.length;c++){var u=l[c],h=u.position.x-n.x,f=u.position.y-n.y;a.setPosition(u,{x:n.x+(h*o-f*s),y:n.y+(h*s+f*o)}),a.rotate(u,t)}return e},i.scale=function(e,t,n,r,o){for(var s=o?i.allBodies(e):e.bodies,l=0;l<s.length;l++){var c=s[l],u=c.position.x-r.x,h=c.position.y-r.y;a.setPosition(c,{x:r.x+u*t,y:r.y+h*n}),a.scale(c,t,n)}return e},i.bounds=function(e){for(var t=i.allBodies(e),n=[],r=0;r<t.length;r+=1){var o=t[r];n.push(o.bounds.min,o.bounds.max)}return s.create(n)}},function(e,t,n){var i={};e.exports=i;var r=n(3),o=n(2),s=n(7),a=(n(16),n(0)),l=n(1),c=n(11);!function(){i._inertiaScale=4,i._nextCollidingGroupId=1,i._nextNonCollidingGroupId=-1,i._nextCategory=1,i.create=function(t){var n={id:a.nextId(),type:"body",label:"Body",parts:[],plugin:{},angle:0,vertices:r.fromPath("L 0 0 L 40 0 L 40 40 L 0 40"),position:{x:0,y:0},force:{x:0,y:0},torque:0,positionImpulse:{x:0,y:0},constraintImpulse:{x:0,y:0,angle:0},totalContacts:0,speed:0,angularSpeed:0,velocity:{x:0,y:0},angularVelocity:0,isSensor:!1,isStatic:!1,isSleeping:!1,motion:0,sleepThreshold:60,density:.001,restitution:0,friction:.1,frictionStatic:.5,frictionAir:.01,collisionFilter:{category:1,mask:4294967295,group:0},slop:.05,timeScale:1,render:{visible:!0,opacity:1,strokeStyle:null,fillStyle:null,lineWidth:null,sprite:{xScale:1,yScale:1,xOffset:0,yOffset:0}},events:null,bounds:null,chamfer:null,circleRadius:0,positionPrev:null,anglePrev:0,parent:null,axes:null,area:0,mass:0,inertia:0,_original:null},i=a.extend(n,t);return e(i,t),i},i.nextGroup=function(e){return e?i._nextNonCollidingGroupId--:i._nextCollidingGroupId++},i.nextCategory=function(){return i._nextCategory=i._nextCategory<<1,i._nextCategory};var e=function(e,t){t=t||{},i.set(e,{bounds:e.bounds||l.create(e.vertices),positionPrev:e.positionPrev||o.clone(e.position),anglePrev:e.anglePrev||e.angle,vertices:e.vertices,parts:e.parts||[e],isStatic:e.isStatic,isSleeping:e.isSleeping,parent:e.parent||e}),r.rotate(e.vertices,e.angle,e.position),c.rotate(e.axes,e.angle),l.update(e.bounds,e.vertices,e.velocity),i.set(e,{axes:t.axes||e.axes,area:t.area||e.area,mass:t.mass||e.mass,inertia:t.inertia||e.inertia});var n=e.isStatic?"#14151f":a.choose(["#f19648","#f5d259","#f55a3c","#063e7b","#ececd1"]),s=e.isStatic?"#555":"#ccc",u=e.isStatic&&null===e.render.fillStyle?1:0;e.render.fillStyle=e.render.fillStyle||n,e.render.strokeStyle=e.render.strokeStyle||s,e.render.lineWidth=e.render.lineWidth||u,e.render.sprite.xOffset+=-(e.bounds.min.x-e.position.x)/(e.bounds.max.x-e.bounds.min.x),e.render.sprite.yOffset+=-(e.bounds.min.y-e.position.y)/(e.bounds.max.y-e.bounds.min.y)};i.set=function(e,t,n){var r;for(r in"string"==typeof t&&(r=t,(t={})[r]=n),t)if(Object.prototype.hasOwnProperty.call(t,r))switch(n=t[r],r){case"isStatic":i.setStatic(e,n);break;case"isSleeping":s.set(e,n);break;case"mass":i.setMass(e,n);break;case"density":i.setDensity(e,n);break;case"inertia":i.setInertia(e,n);break;case"vertices":i.setVertices(e,n);break;case"position":i.setPosition(e,n);break;case"angle":i.setAngle(e,n);break;case"velocity":i.setVelocity(e,n);break;case"angularVelocity":i.setAngularVelocity(e,n);break;case"parts":i.setParts(e,n);break;case"centre":i.setCentre(e,n);break;default:e[r]=n}},i.setStatic=function(e,t){for(var n=0;n<e.parts.length;n++){var i=e.parts[n];i.isStatic=t,t?(i._original={restitution:i.restitution,friction:i.friction,mass:i.mass,inertia:i.inertia,density:i.density,inverseMass:i.inverseMass,inverseInertia:i.inverseInertia},i.restitution=0,i.friction=1,i.mass=i.inertia=i.density=1/0,i.inverseMass=i.inverseInertia=0,i.positionPrev.x=i.position.x,i.positionPrev.y=i.position.y,i.anglePrev=i.angle,i.angularVelocity=0,i.speed=0,i.angularSpeed=0,i.motion=0):i._original&&(i.restitution=i._original.restitution,i.friction=i._original.friction,i.mass=i._original.mass,i.inertia=i._original.inertia,i.density=i._original.density,i.inverseMass=i._original.inverseMass,i.inverseInertia=i._original.inverseInertia,i._original=null)}},i.setMass=function(e,t){var n=e.inertia/(e.mass/6);e.inertia=n*(t/6),e.inverseInertia=1/e.inertia,e.mass=t,e.inverseMass=1/e.mass,e.density=e.mass/e.area},i.setDensity=function(e,t){i.setMass(e,t*e.area),e.density=t},i.setInertia=function(e,t){e.inertia=t,e.inverseInertia=1/e.inertia},i.setVertices=function(e,t){t[0].body===e?e.vertices=t:e.vertices=r.create(t,e),e.axes=c.fromVertices(e.vertices),e.area=r.area(e.vertices),i.setMass(e,e.density*e.area);var n=r.centre(e.vertices);r.translate(e.vertices,n,-1),i.setInertia(e,i._inertiaScale*r.inertia(e.vertices,e.mass)),r.translate(e.vertices,e.position),l.update(e.bounds,e.vertices,e.velocity)},i.setParts=function(e,t,n){var o;for(t=t.slice(0),e.parts.length=0,e.parts.push(e),e.parent=e,o=0;o<t.length;o++){var s=t[o];s!==e&&(s.parent=e,e.parts.push(s))}if(1!==e.parts.length){if(n=void 0===n||n){var a=[];for(o=0;o<t.length;o++)a=a.concat(t[o].vertices);r.clockwiseSort(a);var l=r.hull(a),c=r.centre(l);i.setVertices(e,l),r.translate(e.vertices,c)}var u=i._totalProperties(e);e.area=u.area,e.parent=e,e.position.x=u.centre.x,e.position.y=u.centre.y,e.positionPrev.x=u.centre.x,e.positionPrev.y=u.centre.y,i.setMass(e,u.mass),i.setInertia(e,u.inertia),i.setPosition(e,u.centre)}},i.setCentre=function(e,t,n){n?(e.positionPrev.x+=t.x,e.positionPrev.y+=t.y,e.position.x+=t.x,e.position.y+=t.y):(e.positionPrev.x=t.x-(e.position.x-e.positionPrev.x),e.positionPrev.y=t.y-(e.position.y-e.positionPrev.y),e.position.x=t.x,e.position.y=t.y)},i.setPosition=function(e,t){var n=o.sub(t,e.position);e.positionPrev.x+=n.x,e.positionPrev.y+=n.y;for(var i=0;i<e.parts.length;i++){var s=e.parts[i];s.position.x+=n.x,s.position.y+=n.y,r.translate(s.vertices,n),l.update(s.bounds,s.vertices,e.velocity)}},i.setAngle=function(e,t){var n=t-e.angle;e.anglePrev+=n;for(var i=0;i<e.parts.length;i++){var s=e.parts[i];s.angle+=n,r.rotate(s.vertices,n,e.position),c.rotate(s.axes,n),l.update(s.bounds,s.vertices,e.velocity),i>0&&o.rotateAbout(s.position,n,e.position,s.position)}},i.setVelocity=function(e,t){e.positionPrev.x=e.position.x-t.x,e.positionPrev.y=e.position.y-t.y,e.velocity.x=t.x,e.velocity.y=t.y,e.speed=o.magnitude(e.velocity)},i.setAngularVelocity=function(e,t){e.anglePrev=e.angle-t,e.angularVelocity=t,e.angularSpeed=Math.abs(e.angularVelocity)},i.translate=function(e,t){i.setPosition(e,o.add(e.position,t))},i.rotate=function(e,t,n){if(n){var r=Math.cos(t),o=Math.sin(t),s=e.position.x-n.x,a=e.position.y-n.y;i.setPosition(e,{x:n.x+(s*r-a*o),y:n.y+(s*o+a*r)}),i.setAngle(e,e.angle+t)}else i.setAngle(e,e.angle+t)},i.scale=function(e,t,n,o){var s=0,a=0;o=o||e.position;for(var u=0;u<e.parts.length;u++){var h=e.parts[u];r.scale(h.vertices,t,n,o),h.axes=c.fromVertices(h.vertices),h.area=r.area(h.vertices),i.setMass(h,e.density*h.area),r.translate(h.vertices,{x:-h.position.x,y:-h.position.y}),i.setInertia(h,i._inertiaScale*r.inertia(h.vertices,h.mass)),r.translate(h.vertices,{x:h.position.x,y:h.position.y}),u>0&&(s+=h.area,a+=h.inertia),h.position.x=o.x+(h.position.x-o.x)*t,h.position.y=o.y+(h.position.y-o.y)*n,l.update(h.bounds,h.vertices,e.velocity)}e.parts.length>1&&(e.area=s,e.isStatic||(i.setMass(e,e.density*s),i.setInertia(e,a))),e.circleRadius&&(t===n?e.circleRadius*=t:e.circleRadius=null)},i.update=function(e,t,n,i){var s=Math.pow(t*n*e.timeScale,2),a=1-e.frictionAir*n*e.timeScale,u=e.position.x-e.positionPrev.x,h=e.position.y-e.positionPrev.y;e.velocity.x=u*a*i+e.force.x/e.mass*s,e.velocity.y=h*a*i+e.force.y/e.mass*s,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.position.x+=e.velocity.x,e.position.y+=e.velocity.y,e.angularVelocity=(e.angle-e.anglePrev)*a*i+e.torque/e.inertia*s,e.anglePrev=e.angle,e.angle+=e.angularVelocity,e.speed=o.magnitude(e.velocity),e.angularSpeed=Math.abs(e.angularVelocity);for(var f=0;f<e.parts.length;f++){var d=e.parts[f];r.translate(d.vertices,e.velocity),f>0&&(d.position.x+=e.velocity.x,d.position.y+=e.velocity.y),0!==e.angularVelocity&&(r.rotate(d.vertices,e.angularVelocity,e.position),c.rotate(d.axes,e.angularVelocity),f>0&&o.rotateAbout(d.position,e.angularVelocity,e.position,d.position)),l.update(d.bounds,d.vertices,e.velocity)}},i.applyForce=function(e,t,n){e.force.x+=n.x,e.force.y+=n.y;var i=t.x-e.position.x,r=t.y-e.position.y;e.torque+=i*n.y-r*n.x},i._totalProperties=function(e){for(var t={mass:0,area:0,inertia:0,centre:{x:0,y:0}},n=1===e.parts.length?0:1;n<e.parts.length;n++){var i=e.parts[n],r=i.mass!==1/0?i.mass:1;t.mass+=r,t.area+=i.area,t.inertia+=i.inertia,t.centre=o.add(t.centre,o.mult(i.position,r))}return t.centre=o.div(t.centre,t.mass),t}}()},function(e,t,n){var i={};e.exports=i;var r=n(4);i._motionWakeThreshold=.18,i._motionSleepThreshold=.08,i._minBias=.9,i.update=function(e,t){for(var n=t*t*t,r=0;r<e.length;r++){var o=e[r],s=o.speed*o.speed+o.angularSpeed*o.angularSpeed;if(0===o.force.x&&0===o.force.y){var a=Math.min(o.motion,s),l=Math.max(o.motion,s);o.motion=i._minBias*a+(1-i._minBias)*l,o.sleepThreshold>0&&o.motion<i._motionSleepThreshold*n?(o.sleepCounter+=1,o.sleepCounter>=o.sleepThreshold&&i.set(o,!0)):o.sleepCounter>0&&(o.sleepCounter-=1)}else i.set(o,!1)}},i.afterCollisions=function(e,t){for(var n=t*t*t,r=0;r<e.length;r++){var o=e[r];if(o.isActive){var s=o.collision,a=s.bodyA.parent,l=s.bodyB.parent;if(!(a.isSleeping&&l.isSleeping||a.isStatic||l.isStatic)&&(a.isSleeping||l.isSleeping)){var c=a.isSleeping&&!a.isStatic?a:l,u=c===a?l:a;!c.isStatic&&u.motion>i._motionWakeThreshold*n&&i.set(c,!1)}}}},i.set=function(e,t){var n=e.isSleeping;t?(e.isSleeping=!0,e.sleepCounter=e.sleepThreshold,e.positionImpulse.x=0,e.positionImpulse.y=0,e.positionPrev.x=e.position.x,e.positionPrev.y=e.position.y,e.anglePrev=e.angle,e.speed=0,e.angularSpeed=0,e.motion=0,n||r.trigger(e,"sleepStart")):(e.isSleeping=!1,e.sleepCounter=0,n&&r.trigger(e,"sleepEnd"))}},function(e,t,n){var i={};e.exports=i;var r,o,s,a=n(3),l=n(9);r=[],o={overlap:0,axis:null},s={overlap:0,axis:null},i.create=function(e,t){return{pair:null,collided:!1,bodyA:e,bodyB:t,parentA:e.parent,parentB:t.parent,depth:0,normal:{x:0,y:0},tangent:{x:0,y:0},penetration:{x:0,y:0},supports:[]}},i.collides=function(e,t,n){if(i._overlapAxes(o,e.vertices,t.vertices,e.axes),o.overlap<=0)return null;if(i._overlapAxes(s,t.vertices,e.vertices,t.axes),s.overlap<=0)return null;var r,c,u=n&&n.table[l.id(e,t)];u?r=u.collision:((r=i.create(e,t)).collided=!0,r.bodyA=e.id<t.id?e:t,r.bodyB=e.id<t.id?t:e,r.parentA=r.bodyA.parent,r.parentB=r.bodyB.parent),e=r.bodyA,t=r.bodyB,c=o.overlap<s.overlap?o:s;var h=r.normal,f=r.supports,d=c.axis,p=d.x,v=d.y;p*(t.position.x-e.position.x)+v*(t.position.y-e.position.y)<0?(h.x=p,h.y=v):(h.x=-p,h.y=-v),r.tangent.x=-h.y,r.tangent.y=h.x,r.depth=c.overlap,r.penetration.x=h.x*r.depth,r.penetration.y=h.y*r.depth;var y=i._findSupports(e,t,h,1),m=0;if(a.contains(e.vertices,y[0])&&(f[m++]=y[0]),a.contains(e.vertices,y[1])&&(f[m++]=y[1]),m<2){var g=i._findSupports(t,e,h,-1);a.contains(t.vertices,g[0])&&(f[m++]=g[0]),m<2&&a.contains(t.vertices,g[1])&&(f[m++]=g[1])}return 0===m&&(f[m++]=y[0]),f.length=m,r},i._overlapAxes=function(e,t,n,i){var r,o,s,a,l,c,u=t.length,h=n.length,f=t[0].x,d=t[0].y,p=n[0].x,v=n[0].y,y=i.length,m=Number.MAX_VALUE,g=0;for(l=0;l<y;l++){var x=i[l],b=x.x,w=x.y,_=f*b+d*w,S=p*b+v*w,T=_,k=S;for(c=1;c<u;c+=1)(a=t[c].x*b+t[c].y*w)>T?T=a:a<_&&(_=a);for(c=1;c<h;c+=1)(a=n[c].x*b+n[c].y*w)>k?k=a:a<S&&(S=a);if((r=(o=T-S)<(s=k-_)?o:s)<m&&(m=r,g=l,r<=0))break}e.axis=i[g],e.overlap=m},i._projectToAxis=function(e,t,n){for(var i=t[0].x*n.x+t[0].y*n.y,r=i,o=1;o<t.length;o+=1){var s=t[o].x*n.x+t[o].y*n.y;s>r?r=s:s<i&&(i=s)}e.min=i,e.max=r},i._findSupports=function(e,t,n,i){var o,s,a,l,c,u=t.vertices,h=u.length,f=e.position.x,d=e.position.y,p=n.x*i,v=n.y*i,y=Number.MAX_VALUE;for(c=0;c<h;c+=1)(l=p*(f-(s=u[c]).x)+v*(d-s.y))<y&&(y=l,o=s);return y=p*(f-(a=u[(h+o.index-1)%h]).x)+v*(d-a.y),p*(f-(s=u[(o.index+1)%h]).x)+v*(d-s.y)<y?(r[0]=o,r[1]=s,r):(r[0]=o,r[1]=a,r)}},function(e,t,n){var i={};e.exports=i;var r=n(17);i.create=function(e,t){var n=e.bodyA,r=e.bodyB,o={id:i.id(n,r),bodyA:n,bodyB:r,collision:e,contacts:[],activeContacts:[],separation:0,isActive:!0,confirmedActive:!0,isSensor:n.isSensor||r.isSensor,timeCreated:t,timeUpdated:t,inverseMass:0,friction:0,frictionStatic:0,restitution:0,slop:0};return i.update(o,e,t),o},i.update=function(e,t,n){var i=e.contacts,o=t.supports,s=e.activeContacts,a=t.parentA,l=t.parentB,c=a.vertices.length;e.isActive=!0,e.timeUpdated=n,e.collision=t,e.separation=t.depth,e.inverseMass=a.inverseMass+l.inverseMass,e.friction=a.friction<l.friction?a.friction:l.friction,e.frictionStatic=a.frictionStatic>l.frictionStatic?a.frictionStatic:l.frictionStatic,e.restitution=a.restitution>l.restitution?a.restitution:l.restitution,e.slop=a.slop>l.slop?a.slop:l.slop,t.pair=e,s.length=0;for(var u=0;u<o.length;u++){var h=o[u],f=h.body===a?h.index:c+h.index,d=i[f];d?s.push(d):s.push(i[f]=r.create(h))}},i.setActive=function(e,t,n){t?(e.isActive=!0,e.timeUpdated=n):(e.isActive=!1,e.activeContacts.length=0)},i.id=function(e,t){return e.id<t.id?"A"+e.id+"B"+t.id:"A"+t.id+"B"+e.id}},function(e,t,n){var i={};e.exports=i;var r=n(3),o=n(2),s=n(7),a=n(1),l=n(11),c=n(0);i._warming=.4,i._torqueDampen=1,i._minLength=1e-6,i.create=function(e){var t=e;t.bodyA&&!t.pointA&&(t.pointA={x:0,y:0}),t.bodyB&&!t.pointB&&(t.pointB={x:0,y:0});var n=t.bodyA?o.add(t.bodyA.position,t.pointA):t.pointA,i=t.bodyB?o.add(t.bodyB.position,t.pointB):t.pointB,r=o.magnitude(o.sub(n,i));t.length=void 0!==t.length?t.length:r,t.id=t.id||c.nextId(),t.label=t.label||"Constraint",t.type="constraint",t.stiffness=t.stiffness||(t.length>0?1:.7),t.damping=t.damping||0,t.angularStiffness=t.angularStiffness||0,t.angleA=t.bodyA?t.bodyA.angle:t.angleA,t.angleB=t.bodyB?t.bodyB.angle:t.angleB,t.plugin={};var s={visible:!0,lineWidth:2,strokeStyle:"#ffffff",type:"line",anchors:!0};return 0===t.length&&t.stiffness>.1?(s.type="pin",s.anchors=!1):t.stiffness<.9&&(s.type="spring"),t.render=c.extend(s,t.render),t},i.preSolveAll=function(e){for(var t=0;t<e.length;t+=1){var n=e[t],i=n.constraintImpulse;n.isStatic||0===i.x&&0===i.y&&0===i.angle||(n.position.x+=i.x,n.position.y+=i.y,n.angle+=i.angle)}},i.solveAll=function(e,t){for(var n=0;n<e.length;n+=1){var r=e[n],o=!r.bodyA||r.bodyA&&r.bodyA.isStatic,s=!r.bodyB||r.bodyB&&r.bodyB.isStatic;(o||s)&&i.solve(e[n],t)}for(n=0;n<e.length;n+=1)o=!(r=e[n]).bodyA||r.bodyA&&r.bodyA.isStatic,s=!r.bodyB||r.bodyB&&r.bodyB.isStatic,o||s||i.solve(e[n],t)},i.solve=function(e,t){var n=e.bodyA,r=e.bodyB,s=e.pointA,a=e.pointB;if(n||r){n&&!n.isStatic&&(o.rotate(s,n.angle-e.angleA,s),e.angleA=n.angle),r&&!r.isStatic&&(o.rotate(a,r.angle-e.angleB,a),e.angleB=r.angle);var l=s,c=a;if(n&&(l=o.add(n.position,s)),r&&(c=o.add(r.position,a)),l&&c){var u=o.sub(l,c),h=o.magnitude(u);h<i._minLength&&(h=i._minLength);var f,d,p,v,y,m=(h-e.length)/h,g=e.stiffness<1?e.stiffness*t:e.stiffness,x=o.mult(u,m*g),b=(n?n.inverseMass:0)+(r?r.inverseMass:0),w=b+((n?n.inverseInertia:0)+(r?r.inverseInertia:0));if(e.damping){var _=o.create();p=o.div(u,h),y=o.sub(r&&o.sub(r.position,r.positionPrev)||_,n&&o.sub(n.position,n.positionPrev)||_),v=o.dot(p,y)}n&&!n.isStatic&&(d=n.inverseMass/b,n.constraintImpulse.x-=x.x*d,n.constraintImpulse.y-=x.y*d,n.position.x-=x.x*d,n.position.y-=x.y*d,e.damping&&(n.positionPrev.x-=e.damping*p.x*v*d,n.positionPrev.y-=e.damping*p.y*v*d),f=o.cross(s,x)/w*i._torqueDampen*n.inverseInertia*(1-e.angularStiffness),n.constraintImpulse.angle-=f,n.angle-=f),r&&!r.isStatic&&(d=r.inverseMass/b,r.constraintImpulse.x+=x.x*d,r.constraintImpulse.y+=x.y*d,r.position.x+=x.x*d,r.position.y+=x.y*d,e.damping&&(r.positionPrev.x+=e.damping*p.x*v*d,r.positionPrev.y+=e.damping*p.y*v*d),f=o.cross(a,x)/w*i._torqueDampen*r.inverseInertia*(1-e.angularStiffness),r.constraintImpulse.angle+=f,r.angle+=f)}}},i.postSolveAll=function(e){for(var t=0;t<e.length;t++){var n=e[t],c=n.constraintImpulse;if(!(n.isStatic||0===c.x&&0===c.y&&0===c.angle)){s.set(n,!1);for(var u=0;u<n.parts.length;u++){var h=n.parts[u];r.translate(h.vertices,c),u>0&&(h.position.x+=c.x,h.position.y+=c.y),0!==c.angle&&(r.rotate(h.vertices,c.angle,n.position),l.rotate(h.axes,c.angle),u>0&&o.rotateAbout(h.position,c.angle,n.position,h.position)),a.update(h.bounds,h.vertices,n.velocity)}c.angle*=i._warming,c.x*=i._warming,c.y*=i._warming}}},i.pointAWorld=function(e){return{x:(e.bodyA?e.bodyA.position.x:0)+e.pointA.x,y:(e.bodyA?e.bodyA.position.y:0)+e.pointA.y}},i.pointBWorld=function(e){return{x:(e.bodyB?e.bodyB.position.x:0)+e.pointB.x,y:(e.bodyB?e.bodyB.position.y:0)+e.pointB.y}}},function(e,t,n){var i={};e.exports=i;var r=n(2),o=n(0);i.fromVertices=function(e){for(var t={},n=0;n<e.length;n++){var i=(n+1)%e.length,s=r.normalise({x:e[i].y-e[n].y,y:e[n].x-e[i].x}),a=0===s.y?1/0:s.x/s.y;t[a=a.toFixed(3).toString()]=s}return o.values(t)},i.rotate=function(e,t){if(0!==t)for(var n=Math.cos(t),i=Math.sin(t),r=0;r<e.length;r++){var o,s=e[r];o=s.x*n-s.y*i,s.y=s.x*i+s.y*n,s.x=o}}},function(e,t,n){var i={};e.exports=i;var r=n(3),o=n(0),s=n(6),a=n(1),l=n(2);i.rectangle=function(e,t,n,i,a){a=a||{};var l={label:"Rectangle Body",position:{x:e,y:t},vertices:r.fromPath("L 0 0 L "+n+" 0 L "+n+" "+i+" L 0 "+i)};if(a.chamfer){var c=a.chamfer;l.vertices=r.chamfer(l.vertices,c.radius,c.quality,c.qualityMin,c.qualityMax),delete a.chamfer}return s.create(o.extend({},l,a))},i.trapezoid=function(e,t,n,i,a,l){l=l||{};var c,u=n*(a*=.5),h=u+(1-2*a)*n,f=h+u;c=a<.5?"L 0 0 L "+u+" "+-i+" L "+h+" "+-i+" L "+f+" 0":"L 0 0 L "+h+" "+-i+" L "+f+" 0";var d={label:"Trapezoid Body",position:{x:e,y:t},vertices:r.fromPath(c)};if(l.chamfer){var p=l.chamfer;d.vertices=r.chamfer(d.vertices,p.radius,p.quality,p.qualityMin,p.qualityMax),delete l.chamfer}return s.create(o.extend({},d,l))},i.circle=function(e,t,n,r,s){r=r||{};var a={label:"Circle Body",circleRadius:n};s=s||25;var l=Math.ceil(Math.max(10,Math.min(s,n)));return l%2==1&&(l+=1),i.polygon(e,t,l,n,o.extend({},a,r))},i.polygon=function(e,t,n,a,l){if(l=l||{},n<3)return i.circle(e,t,a,l);for(var c=2*Math.PI/n,u="",h=.5*c,f=0;f<n;f+=1){var d=h+f*c,p=Math.cos(d)*a,v=Math.sin(d)*a;u+="L "+p.toFixed(3)+" "+v.toFixed(3)+" "}var y={label:"Polygon Body",position:{x:e,y:t},vertices:r.fromPath(u)};if(l.chamfer){var m=l.chamfer;y.vertices=r.chamfer(y.vertices,m.radius,m.quality,m.qualityMin,m.qualityMax),delete l.chamfer}return s.create(o.extend({},y,l))},i.fromVertices=function(e,t,n,i,c,u,h,f){var d,p,v,y,m,g,x,b,w,_,S=o.getDecomp();for(d=Boolean(S&&S.quickDecomp),i=i||{},v=[],c=void 0!==c&&c,u=void 0!==u?u:.01,h=void 0!==h?h:10,f=void 0!==f?f:.01,o.isArray(n[0])||(n=[n]),w=0;w<n.length;w+=1)if(m=n[w],!(y=r.isConvex(m))&&!d&&o.warnOnce("Bodies.fromVertices: Install the 'poly-decomp' library and use Common.setDecomp or provide 'decomp' as a global to decompose concave vertices."),y||!d)m=y?r.clockwiseSort(m):r.hull(m),v.push({position:{x:e,y:t},vertices:m});else{var T=m.map((function(e){return[e.x,e.y]}));S.makeCCW(T),!1!==u&&S.removeCollinearPoints(T,u),!1!==f&&S.removeDuplicatePoints&&S.removeDuplicatePoints(T,f);var k=S.quickDecomp(T);for(g=0;g<k.length;g++){var C=k[g].map((function(e){return{x:e[0],y:e[1]}}));h>0&&r.area(C)<h||v.push({position:r.centre(C),vertices:C})}}for(g=0;g<v.length;g++)v[g]=s.create(o.extend(v[g],i));if(c)for(g=0;g<v.length;g++){var O=v[g];for(x=g+1;x<v.length;x++){var E=v[x];if(a.overlaps(O.bounds,E.bounds)){var P=O.vertices,A=E.vertices;for(b=0;b<O.vertices.length;b++)for(_=0;_<E.vertices.length;_++){var I=l.magnitudeSquared(l.sub(P[(b+1)%P.length],A[_])),R=l.magnitudeSquared(l.sub(P[b],A[(_+1)%A.length]));I<5&&R<5&&(P[b].isInternal=!0,A[_].isInternal=!0)}}}}return v.length>1?(p=s.create(o.extend({parts:v.slice(0)},i)),s.setPosition(p,{x:e,y:t}),p):v[0]}},function(e,t,n){var i={};e.exports=i;var r=n(0);i.create=function(e){var t={};return e||r.log("Mouse.create: element was undefined, defaulting to document.body","warn"),t.element=e||document.body,t.absolute={x:0,y:0},t.position={x:0,y:0},t.mousedownPosition={x:0,y:0},t.mouseupPosition={x:0,y:0},t.offset={x:0,y:0},t.scale={x:1,y:1},t.wheelDelta=0,t.button=-1,t.pixelRatio=parseInt(t.element.getAttribute("data-pixel-ratio"),10)||1,t.sourceEvents={mousemove:null,mousedown:null,mouseup:null,mousewheel:null},t.mousemove=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&(t.button=0,e.preventDefault()),t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.sourceEvents.mousemove=e},t.mousedown=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches?(t.button=0,e.preventDefault()):t.button=e.button,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mousedownPosition.x=t.position.x,t.mousedownPosition.y=t.position.y,t.sourceEvents.mousedown=e},t.mouseup=function(e){var n=i._getRelativeMousePosition(e,t.element,t.pixelRatio);e.changedTouches&&e.preventDefault(),t.button=-1,t.absolute.x=n.x,t.absolute.y=n.y,t.position.x=t.absolute.x*t.scale.x+t.offset.x,t.position.y=t.absolute.y*t.scale.y+t.offset.y,t.mouseupPosition.x=t.position.x,t.mouseupPosition.y=t.position.y,t.sourceEvents.mouseup=e},t.mousewheel=function(e){t.wheelDelta=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail)),e.preventDefault()},i.setElement(t,t.element),t},i.setElement=function(e,t){e.element=t,t.addEventListener("mousemove",e.mousemove),t.addEventListener("mousedown",e.mousedown),t.addEventListener("mouseup",e.mouseup),t.addEventListener("mousewheel",e.mousewheel),t.addEventListener("DOMMouseScroll",e.mousewheel),t.addEventListener("touchmove",e.mousemove),t.addEventListener("touchstart",e.mousedown),t.addEventListener("touchend",e.mouseup)},i.clearSourceEvents=function(e){e.sourceEvents.mousemove=null,e.sourceEvents.mousedown=null,e.sourceEvents.mouseup=null,e.sourceEvents.mousewheel=null,e.wheelDelta=0},i.setOffset=function(e,t){e.offset.x=t.x,e.offset.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},i.setScale=function(e,t){e.scale.x=t.x,e.scale.y=t.y,e.position.x=e.absolute.x*e.scale.x+e.offset.x,e.position.y=e.absolute.y*e.scale.y+e.offset.y},i._getRelativeMousePosition=function(e,t,n){var i,r,o=t.getBoundingClientRect(),s=document.documentElement||document.body.parentNode||document.body,a=void 0!==window.pageXOffset?window.pageXOffset:s.scrollLeft,l=void 0!==window.pageYOffset?window.pageYOffset:s.scrollTop,c=e.changedTouches;return c?(i=c[0].pageX-o.left-a,r=c[0].pageY-o.top-l):(i=e.pageX-o.left-a,r=e.pageY-o.top-l),{x:i/(t.clientWidth/(t.width||t.clientWidth)*n),y:r/(t.clientHeight/(t.height||t.clientHeight)*n)}}},function(e,t,n){var i={};e.exports=i;var r=n(0),o=n(8);i.create=function(e){return r.extend({bodies:[],pairs:null},e)},i.setBodies=function(e,t){e.bodies=t.slice(0)},i.clear=function(e){e.bodies=[]},i.collisions=function(e){var t,n,r=[],s=e.pairs,a=e.bodies,l=a.length,c=i.canCollide,u=o.collides;for(a.sort(i._compareBoundsX),t=0;t<l;t++){var h=a[t],f=h.bounds,d=h.bounds.max.x,p=h.bounds.max.y,v=h.bounds.min.y,y=h.isStatic||h.isSleeping,m=h.parts.length,g=1===m;for(n=t+1;n<l;n++){var x=a[n];if((O=x.bounds).min.x>d)break;if(!(p<O.min.y||v>O.max.y)&&(!y||!x.isStatic&&!x.isSleeping)&&c(h.collisionFilter,x.collisionFilter)){var b=x.parts.length;if(g&&1===b)(k=u(h,x,s))&&r.push(k);else for(var w=b>1?1:0,_=m>1?1:0;_<m;_++)for(var S=h.parts[_],T=(f=S.bounds,w);T<b;T++){var k,C=x.parts[T],O=C.bounds;f.min.x>O.max.x||f.max.x<O.min.x||f.max.y<O.min.y||f.min.y>O.max.y||(k=u(S,C,s))&&r.push(k)}}}}return r},i.canCollide=function(e,t){return e.group===t.group&&0!==e.group?e.group>0:0!=(e.mask&t.category)&&0!=(t.mask&e.category)},i._compareBoundsX=function(e,t){return e.bounds.min.x-t.bounds.min.x}},function(e,t,n){var i={};e.exports=i;var r=n(0);i._registry={},i.register=function(e){if(i.isPlugin(e)||r.warn("Plugin.register:",i.toString(e),"does not implement all required fields."),e.name in i._registry){var t=i._registry[e.name],n=i.versionParse(e.version).number,o=i.versionParse(t.version).number;n>o?(r.warn("Plugin.register:",i.toString(t),"was upgraded to",i.toString(e)),i._registry[e.name]=e):n<o?r.warn("Plugin.register:",i.toString(t),"can not be downgraded to",i.toString(e)):e!==t&&r.warn("Plugin.register:",i.toString(e),"is already registered to different plugin object")}else i._registry[e.name]=e;return e},i.resolve=function(e){return i._registry[i.dependencyParse(e).name]},i.toString=function(e){return"string"==typeof e?e:(e.name||"anonymous")+"@"+(e.version||e.range||"0.0.0")},i.isPlugin=function(e){return e&&e.name&&e.version&&e.install},i.isUsed=function(e,t){return e.used.indexOf(t)>-1},i.isFor=function(e,t){var n=e.for&&i.dependencyParse(e.for);return!e.for||t.name===n.name&&i.versionSatisfies(t.version,n.range)},i.use=function(e,t){if(e.uses=(e.uses||[]).concat(t||[]),0!==e.uses.length){for(var n=i.dependencies(e),o=r.topologicalSort(n),s=[],a=0;a<o.length;a+=1)if(o[a]!==e.name){var l=i.resolve(o[a]);l?i.isUsed(e,l.name)||(i.isFor(l,e)||(r.warn("Plugin.use:",i.toString(l),"is for",l.for,"but installed on",i.toString(e)+"."),l._warned=!0),l.install?l.install(e):(r.warn("Plugin.use:",i.toString(l),"does not specify an install function."),l._warned=!0),l._warned?(s.push("🔶 "+i.toString(l)),delete l._warned):s.push("✅ "+i.toString(l)),e.used.push(l.name)):s.push("❌ "+o[a])}s.length>0&&r.info(s.join("  "))}else r.warn("Plugin.use:",i.toString(e),"does not specify any dependencies to install.")},i.dependencies=function(e,t){var n=i.dependencyParse(e),o=n.name;if(!(o in(t=t||{}))){e=i.resolve(e)||e,t[o]=r.map(e.uses||[],(function(t){i.isPlugin(t)&&i.register(t);var o=i.dependencyParse(t),s=i.resolve(t);return s&&!i.versionSatisfies(s.version,o.range)?(r.warn("Plugin.dependencies:",i.toString(s),"does not satisfy",i.toString(o),"used by",i.toString(n)+"."),s._warned=!0,e._warned=!0):s||(r.warn("Plugin.dependencies:",i.toString(t),"used by",i.toString(n),"could not be resolved."),e._warned=!0),o.name}));for(var s=0;s<t[o].length;s+=1)i.dependencies(t[o][s],t);return t}},i.dependencyParse=function(e){return r.isString(e)?(/^[\w-]+(@(\*|[\^~]?\d+\.\d+\.\d+(-[0-9A-Za-z-+]+)?))?$/.test(e)||r.warn("Plugin.dependencyParse:",e,"is not a valid dependency string."),{name:e.split("@")[0],range:e.split("@")[1]||"*"}):{name:e.name,range:e.range||e.version}},i.versionParse=function(e){var t=/^(\*)|(\^|~|>=|>)?\s*((\d+)\.(\d+)\.(\d+))(-[0-9A-Za-z-+]+)?$/;t.test(e)||r.warn("Plugin.versionParse:",e,"is not a valid version or range.");var n=t.exec(e),i=Number(n[4]),o=Number(n[5]),s=Number(n[6]);return{isRange:Boolean(n[1]||n[2]),version:n[3],range:e,operator:n[1]||n[2]||"",major:i,minor:o,patch:s,parts:[i,o,s],prerelease:n[7],number:1e8*i+1e4*o+s}},i.versionSatisfies=function(e,t){t=t||"*";var n=i.versionParse(t),r=i.versionParse(e);if(n.isRange){if("*"===n.operator||"*"===e)return!0;if(">"===n.operator)return r.number>n.number;if(">="===n.operator)return r.number>=n.number;if("~"===n.operator)return r.major===n.major&&r.minor===n.minor&&r.patch>=n.patch;if("^"===n.operator)return n.major>0?r.major===n.major&&r.number>=n.number:n.minor>0?r.minor===n.minor&&r.patch>=n.patch:r.patch===n.patch}return e===t||"*"===e}},function(e,t,n){var i={};e.exports=i;var r=n(0),o=n(5),s=n(1),a=n(4),l=n(2),c=n(13);!function(){var e,t;"undefined"!=typeof window&&(e=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout((function(){e(r.now())}),1e3/60)},t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),i._goodFps=30,i._goodDelta=1e3/60,i.create=function(e){var t={controller:i,engine:null,element:null,canvas:null,mouse:null,frameRequestId:null,timing:{historySize:60,delta:0,deltaHistory:[],lastTime:0,lastTimestamp:0,lastElapsed:0,timestampElapsed:0,timestampElapsedHistory:[],engineDeltaHistory:[],engineElapsedHistory:[],elapsedHistory:[]},options:{width:800,height:600,pixelRatio:1,background:"#14151f",wireframeBackground:"#14151f",hasBounds:!!e.bounds,enabled:!0,wireframes:!0,showSleeping:!0,showDebug:!1,showStats:!1,showPerformance:!1,showBounds:!1,showVelocity:!1,showCollisions:!1,showSeparations:!1,showAxes:!1,showPositions:!1,showAngleIndicator:!1,showIds:!1,showVertexNumbers:!1,showConvexHulls:!1,showInternalEdges:!1,showMousePosition:!1}},n=r.extend(t,e);return n.canvas&&(n.canvas.width=n.options.width||n.canvas.width,n.canvas.height=n.options.height||n.canvas.height),n.mouse=e.mouse,n.engine=e.engine,n.canvas=n.canvas||h(n.options.width,n.options.height),n.context=n.canvas.getContext("2d"),n.textures={},n.bounds=n.bounds||{min:{x:0,y:0},max:{x:n.canvas.width,y:n.canvas.height}},n.options.showBroadphase=!1,1!==n.options.pixelRatio&&i.setPixelRatio(n,n.options.pixelRatio),r.isElement(n.element)?n.element.appendChild(n.canvas):n.canvas.parentNode||r.log("Render.create: options.element was undefined, render.canvas was created but not appended","warn"),n},i.run=function(t){!function r(o){t.frameRequestId=e(r),n(t,o),i.world(t,o),(t.options.showStats||t.options.showDebug)&&i.stats(t,t.context,o),(t.options.showPerformance||t.options.showDebug)&&i.performance(t,t.context,o)}()},i.stop=function(e){t(e.frameRequestId)},i.setPixelRatio=function(e,t){var n=e.options,i=e.canvas;"auto"===t&&(t=f(i)),n.pixelRatio=t,i.setAttribute("data-pixel-ratio",t),i.width=n.width*t,i.height=n.height*t,i.style.width=n.width+"px",i.style.height=n.height+"px"},i.lookAt=function(e,t,n,i){i=void 0===i||i,t=r.isArray(t)?t:[t],n=n||{x:0,y:0};for(var o={min:{x:1/0,y:1/0},max:{x:-1/0,y:-1/0}},s=0;s<t.length;s+=1){var a=t[s],l=a.bounds?a.bounds.min:a.min||a.position||a,u=a.bounds?a.bounds.max:a.max||a.position||a;l&&u&&(l.x<o.min.x&&(o.min.x=l.x),u.x>o.max.x&&(o.max.x=u.x),l.y<o.min.y&&(o.min.y=l.y),u.y>o.max.y&&(o.max.y=u.y))}var h=o.max.x-o.min.x+2*n.x,f=o.max.y-o.min.y+2*n.y,d=e.canvas.height,p=e.canvas.width/d,v=h/f,y=1,m=1;v>p?m=v/p:y=p/v,e.options.hasBounds=!0,e.bounds.min.x=o.min.x,e.bounds.max.x=o.min.x+h*y,e.bounds.min.y=o.min.y,e.bounds.max.y=o.min.y+f*m,i&&(e.bounds.min.x+=.5*h-h*y*.5,e.bounds.max.x+=.5*h-h*y*.5,e.bounds.min.y+=.5*f-f*m*.5,e.bounds.max.y+=.5*f-f*m*.5),e.bounds.min.x-=n.x,e.bounds.max.x-=n.x,e.bounds.min.y-=n.y,e.bounds.max.y-=n.y,e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.canvas.width,y:(e.bounds.max.y-e.bounds.min.y)/e.canvas.height}),c.setOffset(e.mouse,e.bounds.min))},i.startViewTransform=function(e){var t=e.bounds.max.x-e.bounds.min.x,n=e.bounds.max.y-e.bounds.min.y,i=t/e.options.width,r=n/e.options.height;e.context.setTransform(e.options.pixelRatio/i,0,0,e.options.pixelRatio/r,0,0),e.context.translate(-e.bounds.min.x,-e.bounds.min.y)},i.endViewTransform=function(e){e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0)},i.world=function(e,t){var n,u=r.now(),h=e.engine,f=h.world,d=e.canvas,v=e.context,y=e.options,m=e.timing,g=o.allBodies(f),x=o.allConstraints(f),b=y.wireframes?y.wireframeBackground:y.background,w=[],_=[],S={timestamp:h.timing.timestamp};if(a.trigger(e,"beforeRender",S),e.currentBackground!==b&&p(e,b),v.globalCompositeOperation="source-in",v.fillStyle="transparent",v.fillRect(0,0,d.width,d.height),v.globalCompositeOperation="source-over",y.hasBounds){for(n=0;n<g.length;n++){var T=g[n];s.overlaps(T.bounds,e.bounds)&&w.push(T)}for(n=0;n<x.length;n++){var k=x[n],C=k.bodyA,O=k.bodyB,E=k.pointA,P=k.pointB;C&&(E=l.add(C.position,k.pointA)),O&&(P=l.add(O.position,k.pointB)),E&&P&&(s.contains(e.bounds,E)||s.contains(e.bounds,P))&&_.push(k)}i.startViewTransform(e),e.mouse&&(c.setScale(e.mouse,{x:(e.bounds.max.x-e.bounds.min.x)/e.options.width,y:(e.bounds.max.y-e.bounds.min.y)/e.options.height}),c.setOffset(e.mouse,e.bounds.min))}else _=x,w=g,1!==e.options.pixelRatio&&e.context.setTransform(e.options.pixelRatio,0,0,e.options.pixelRatio,0,0);!y.wireframes||h.enableSleeping&&y.showSleeping?i.bodies(e,w,v):(y.showConvexHulls&&i.bodyConvexHulls(e,w,v),i.bodyWireframes(e,w,v)),y.showBounds&&i.bodyBounds(e,w,v),(y.showAxes||y.showAngleIndicator)&&i.bodyAxes(e,w,v),y.showPositions&&i.bodyPositions(e,w,v),y.showVelocity&&i.bodyVelocity(e,w,v),y.showIds&&i.bodyIds(e,w,v),y.showSeparations&&i.separations(e,h.pairs.list,v),y.showCollisions&&i.collisions(e,h.pairs.list,v),y.showVertexNumbers&&i.vertexNumbers(e,w,v),y.showMousePosition&&i.mousePosition(e,e.mouse,v),i.constraints(_,v),y.hasBounds&&i.endViewTransform(e),a.trigger(e,"afterRender",S),m.lastElapsed=r.now()-u},i.stats=function(e,t,n){for(var i=e.engine,r=i.world,s=o.allBodies(r),a=0,l=0,c=0;c<s.length;c+=1)a+=s[c].parts.length;var u={Part:a,Body:s.length,Cons:o.allConstraints(r).length,Comp:o.allComposites(r).length,Pair:i.pairs.list.length};for(var h in t.fillStyle="#0e0f19",t.fillRect(l,0,302.5,44),t.font="12px Arial",t.textBaseline="top",t.textAlign="right",u){var f=u[h];t.fillStyle="#aaa",t.fillText(h,l+55,8),t.fillStyle="#eee",t.fillText(f,l+55,26),l+=55}},i.performance=function(e,t){var n=e.engine,r=e.timing,o=r.deltaHistory,s=r.elapsedHistory,a=r.timestampElapsedHistory,l=r.engineDeltaHistory,c=r.engineElapsedHistory,h=n.timing.lastDelta,f=u(o),d=u(s),p=u(l),v=u(c),y=u(a)/f||0,m=1e3/f||0;t.fillStyle="#0e0f19",t.fillRect(0,50,370,34),i.status(t,10,69,60,4,o.length,Math.round(m)+" fps",m/i._goodFps,(function(e){return o[e]/f-1})),i.status(t,82,69,60,4,l.length,h.toFixed(2)+" dt",i._goodDelta/h,(function(e){return l[e]/p-1})),i.status(t,154,69,60,4,c.length,v.toFixed(2)+" ut",1-v/i._goodFps,(function(e){return c[e]/v-1})),i.status(t,226,69,60,4,s.length,d.toFixed(2)+" rt",1-d/i._goodFps,(function(e){return s[e]/d-1})),i.status(t,298,69,60,4,a.length,y.toFixed(2)+" x",y*y*y,(function(e){return(a[e]/o[e]/y||0)-1}))},i.status=function(e,t,n,i,o,s,a,l,c){e.strokeStyle="#888",e.fillStyle="#444",e.lineWidth=1,e.fillRect(t,n+7,i,1),e.beginPath(),e.moveTo(t,n+7-o*r.clamp(.4*c(0),-2,2));for(var u=0;u<i;u+=1)e.lineTo(t+u,n+7-(u<s?o*r.clamp(.4*c(u),-2,2):0));e.stroke(),e.fillStyle="hsl("+r.clamp(25+95*l,0,120)+",100%,60%)",e.fillRect(t,n-7,4,4),e.font="12px Arial",e.textBaseline="middle",e.textAlign="right",e.fillStyle="#eee",e.fillText(a,t+i,n-5)},i.constraints=function(e,t){for(var n=t,i=0;i<e.length;i++){var o=e[i];if(o.render.visible&&o.pointA&&o.pointB){var s,a,c=o.bodyA,u=o.bodyB;if(s=c?l.add(c.position,o.pointA):o.pointA,"pin"===o.render.type)n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.closePath();else{if(a=u?l.add(u.position,o.pointB):o.pointB,n.beginPath(),n.moveTo(s.x,s.y),"spring"===o.render.type)for(var h,f=l.sub(a,s),d=l.perp(l.normalise(f)),p=Math.ceil(r.clamp(o.length/5,12,20)),v=1;v<p;v+=1)h=v%2==0?1:-1,n.lineTo(s.x+f.x*(v/p)+d.x*h*4,s.y+f.y*(v/p)+d.y*h*4);n.lineTo(a.x,a.y)}o.render.lineWidth&&(n.lineWidth=o.render.lineWidth,n.strokeStyle=o.render.strokeStyle,n.stroke()),o.render.anchors&&(n.fillStyle=o.render.strokeStyle,n.beginPath(),n.arc(s.x,s.y,3,0,2*Math.PI),n.arc(a.x,a.y,3,0,2*Math.PI),n.closePath(),n.fill())}}},i.bodies=function(e,t,n){var i,r,o,s,a=n,l=(e.engine,e.options),c=l.showInternalEdges||!l.wireframes;for(o=0;o<t.length;o++)if((i=t[o]).render.visible)for(s=i.parts.length>1?1:0;s<i.parts.length;s++)if((r=i.parts[s]).render.visible){if(l.showSleeping&&i.isSleeping?a.globalAlpha=.5*r.render.opacity:1!==r.render.opacity&&(a.globalAlpha=r.render.opacity),r.render.sprite&&r.render.sprite.texture&&!l.wireframes){var u=r.render.sprite,h=d(e,u.texture);a.translate(r.position.x,r.position.y),a.rotate(r.angle),a.drawImage(h,h.width*-u.xOffset*u.xScale,h.height*-u.yOffset*u.yScale,h.width*u.xScale,h.height*u.yScale),a.rotate(-r.angle),a.translate(-r.position.x,-r.position.y)}else{if(r.circleRadius)a.beginPath(),a.arc(r.position.x,r.position.y,r.circleRadius,0,2*Math.PI);else{a.beginPath(),a.moveTo(r.vertices[0].x,r.vertices[0].y);for(var f=1;f<r.vertices.length;f++)!r.vertices[f-1].isInternal||c?a.lineTo(r.vertices[f].x,r.vertices[f].y):a.moveTo(r.vertices[f].x,r.vertices[f].y),r.vertices[f].isInternal&&!c&&a.moveTo(r.vertices[(f+1)%r.vertices.length].x,r.vertices[(f+1)%r.vertices.length].y);a.lineTo(r.vertices[0].x,r.vertices[0].y),a.closePath()}l.wireframes?(a.lineWidth=1,a.strokeStyle="#bbb",a.stroke()):(a.fillStyle=r.render.fillStyle,r.render.lineWidth&&(a.lineWidth=r.render.lineWidth,a.strokeStyle=r.render.strokeStyle,a.stroke()),a.fill())}a.globalAlpha=1}},i.bodyWireframes=function(e,t,n){var i,r,o,s,a,l=n,c=e.options.showInternalEdges;for(l.beginPath(),o=0;o<t.length;o++)if((i=t[o]).render.visible)for(a=i.parts.length>1?1:0;a<i.parts.length;a++){for(r=i.parts[a],l.moveTo(r.vertices[0].x,r.vertices[0].y),s=1;s<r.vertices.length;s++)!r.vertices[s-1].isInternal||c?l.lineTo(r.vertices[s].x,r.vertices[s].y):l.moveTo(r.vertices[s].x,r.vertices[s].y),r.vertices[s].isInternal&&!c&&l.moveTo(r.vertices[(s+1)%r.vertices.length].x,r.vertices[(s+1)%r.vertices.length].y);l.lineTo(r.vertices[0].x,r.vertices[0].y)}l.lineWidth=1,l.strokeStyle="#bbb",l.stroke()},i.bodyConvexHulls=function(e,t,n){var i,r,o,s=n;for(s.beginPath(),r=0;r<t.length;r++)if((i=t[r]).render.visible&&1!==i.parts.length){for(s.moveTo(i.vertices[0].x,i.vertices[0].y),o=1;o<i.vertices.length;o++)s.lineTo(i.vertices[o].x,i.vertices[o].y);s.lineTo(i.vertices[0].x,i.vertices[0].y)}s.lineWidth=1,s.strokeStyle="rgba(255,255,255,0.2)",s.stroke()},i.vertexNumbers=function(e,t,n){var i,r,o,s=n;for(i=0;i<t.length;i++){var a=t[i].parts;for(o=a.length>1?1:0;o<a.length;o++){var l=a[o];for(r=0;r<l.vertices.length;r++)s.fillStyle="rgba(255,255,255,0.2)",s.fillText(i+"_"+r,l.position.x+.8*(l.vertices[r].x-l.position.x),l.position.y+.8*(l.vertices[r].y-l.position.y))}}},i.mousePosition=function(e,t,n){var i=n;i.fillStyle="rgba(255,255,255,0.8)",i.fillText(t.position.x+"  "+t.position.y,t.position.x+5,t.position.y-5)},i.bodyBounds=function(e,t,n){var i=n,r=(e.engine,e.options);i.beginPath();for(var o=0;o<t.length;o++)if(t[o].render.visible)for(var s=t[o].parts,a=s.length>1?1:0;a<s.length;a++){var l=s[a];i.rect(l.bounds.min.x,l.bounds.min.y,l.bounds.max.x-l.bounds.min.x,l.bounds.max.y-l.bounds.min.y)}r.wireframes?i.strokeStyle="rgba(255,255,255,0.08)":i.strokeStyle="rgba(0,0,0,0.1)",i.lineWidth=1,i.stroke()},i.bodyAxes=function(e,t,n){var i,r,o,s,a=n,l=(e.engine,e.options);for(a.beginPath(),r=0;r<t.length;r++){var c=t[r],u=c.parts;if(c.render.visible)if(l.showAxes)for(o=u.length>1?1:0;o<u.length;o++)for(i=u[o],s=0;s<i.axes.length;s++){var h=i.axes[s];a.moveTo(i.position.x,i.position.y),a.lineTo(i.position.x+20*h.x,i.position.y+20*h.y)}else for(o=u.length>1?1:0;o<u.length;o++)for(i=u[o],s=0;s<i.axes.length;s++)a.moveTo(i.position.x,i.position.y),a.lineTo((i.vertices[0].x+i.vertices[i.vertices.length-1].x)/2,(i.vertices[0].y+i.vertices[i.vertices.length-1].y)/2)}l.wireframes?(a.strokeStyle="indianred",a.lineWidth=1):(a.strokeStyle="rgba(255, 255, 255, 0.4)",a.globalCompositeOperation="overlay",a.lineWidth=2),a.stroke(),a.globalCompositeOperation="source-over"},i.bodyPositions=function(e,t,n){var i,r,o,s,a=n,l=(e.engine,e.options);for(a.beginPath(),o=0;o<t.length;o++)if((i=t[o]).render.visible)for(s=0;s<i.parts.length;s++)r=i.parts[s],a.arc(r.position.x,r.position.y,3,0,2*Math.PI,!1),a.closePath();for(l.wireframes?a.fillStyle="indianred":a.fillStyle="rgba(0,0,0,0.5)",a.fill(),a.beginPath(),o=0;o<t.length;o++)(i=t[o]).render.visible&&(a.arc(i.positionPrev.x,i.positionPrev.y,2,0,2*Math.PI,!1),a.closePath());a.fillStyle="rgba(255,165,0,0.8)",a.fill()},i.bodyVelocity=function(e,t,n){var i=n;i.beginPath();for(var r=0;r<t.length;r++){var o=t[r];o.render.visible&&(i.moveTo(o.position.x,o.position.y),i.lineTo(o.position.x+2*(o.position.x-o.positionPrev.x),o.position.y+2*(o.position.y-o.positionPrev.y)))}i.lineWidth=3,i.strokeStyle="cornflowerblue",i.stroke()},i.bodyIds=function(e,t,n){var i,r,o=n;for(i=0;i<t.length;i++)if(t[i].render.visible){var s=t[i].parts;for(r=s.length>1?1:0;r<s.length;r++){var a=s[r];o.font="12px Arial",o.fillStyle="rgba(255,255,255,0.5)",o.fillText(a.id,a.position.x+10,a.position.y-10)}}},i.collisions=function(e,t,n){var i,r,o,s,a=n,l=e.options;for(a.beginPath(),o=0;o<t.length;o++)if((i=t[o]).isActive)for(r=i.collision,s=0;s<i.activeContacts.length;s++){var c=i.activeContacts[s].vertex;a.rect(c.x-1.5,c.y-1.5,3.5,3.5)}for(l.wireframes?a.fillStyle="rgba(255,255,255,0.7)":a.fillStyle="orange",a.fill(),a.beginPath(),o=0;o<t.length;o++)if((i=t[o]).isActive&&(r=i.collision,i.activeContacts.length>0)){var u=i.activeContacts[0].vertex.x,h=i.activeContacts[0].vertex.y;2===i.activeContacts.length&&(u=(i.activeContacts[0].vertex.x+i.activeContacts[1].vertex.x)/2,h=(i.activeContacts[0].vertex.y+i.activeContacts[1].vertex.y)/2),r.bodyB===r.supports[0].body||!0===r.bodyA.isStatic?a.moveTo(u-8*r.normal.x,h-8*r.normal.y):a.moveTo(u+8*r.normal.x,h+8*r.normal.y),a.lineTo(u,h)}l.wireframes?a.strokeStyle="rgba(255,165,0,0.7)":a.strokeStyle="orange",a.lineWidth=1,a.stroke()},i.separations=function(e,t,n){var i,r,o,s,a,l=n,c=e.options;for(l.beginPath(),a=0;a<t.length;a++)if((i=t[a]).isActive){o=(r=i.collision).bodyA;var u=1;(s=r.bodyB).isStatic||o.isStatic||(u=.5),s.isStatic&&(u=0),l.moveTo(s.position.x,s.position.y),l.lineTo(s.position.x-r.penetration.x*u,s.position.y-r.penetration.y*u),u=1,s.isStatic||o.isStatic||(u=.5),o.isStatic&&(u=0),l.moveTo(o.position.x,o.position.y),l.lineTo(o.position.x+r.penetration.x*u,o.position.y+r.penetration.y*u)}c.wireframes?l.strokeStyle="rgba(255,165,0,0.5)":l.strokeStyle="orange",l.stroke()},i.inspector=function(e,t){e.engine;var n,i=e.selected,r=e.render,o=r.options;if(o.hasBounds){var s=r.bounds.max.x-r.bounds.min.x,a=r.bounds.max.y-r.bounds.min.y,l=s/r.options.width,c=a/r.options.height;t.scale(1/l,1/c),t.translate(-r.bounds.min.x,-r.bounds.min.y)}for(var u=0;u<i.length;u++){var h=i[u].data;switch(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.9)",t.setLineDash([1,2]),h.type){case"body":n=h.bounds,t.beginPath(),t.rect(Math.floor(n.min.x-3),Math.floor(n.min.y-3),Math.floor(n.max.x-n.min.x+6),Math.floor(n.max.y-n.min.y+6)),t.closePath(),t.stroke();break;case"constraint":var f=h.pointA;h.bodyA&&(f=h.pointB),t.beginPath(),t.arc(f.x,f.y,10,0,2*Math.PI),t.closePath(),t.stroke()}t.setLineDash([]),t.translate(-.5,-.5)}null!==e.selectStart&&(t.translate(.5,.5),t.lineWidth=1,t.strokeStyle="rgba(255,165,0,0.6)",t.fillStyle="rgba(255,165,0,0.1)",n=e.selectBounds,t.beginPath(),t.rect(Math.floor(n.min.x),Math.floor(n.min.y),Math.floor(n.max.x-n.min.x),Math.floor(n.max.y-n.min.y)),t.closePath(),t.stroke(),t.fill(),t.translate(-.5,-.5)),o.hasBounds&&t.setTransform(1,0,0,1,0,0)};var n=function(e,t){var n=e.engine,r=e.timing,o=r.historySize,s=n.timing.timestamp;r.delta=t-r.lastTime||i._goodDelta,r.lastTime=t,r.timestampElapsed=s-r.lastTimestamp||0,r.lastTimestamp=s,r.deltaHistory.unshift(r.delta),r.deltaHistory.length=Math.min(r.deltaHistory.length,o),r.engineDeltaHistory.unshift(n.timing.lastDelta),r.engineDeltaHistory.length=Math.min(r.engineDeltaHistory.length,o),r.timestampElapsedHistory.unshift(r.timestampElapsed),r.timestampElapsedHistory.length=Math.min(r.timestampElapsedHistory.length,o),r.engineElapsedHistory.unshift(n.timing.lastElapsed),r.engineElapsedHistory.length=Math.min(r.engineElapsedHistory.length,o),r.elapsedHistory.unshift(r.lastElapsed),r.elapsedHistory.length=Math.min(r.elapsedHistory.length,o)},u=function(e){for(var t=0,n=0;n<e.length;n+=1)t+=e[n];return t/e.length||0},h=function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n.oncontextmenu=function(){return!1},n.onselectstart=function(){return!1},n},f=function(e){var t=e.getContext("2d");return(window.devicePixelRatio||1)/(t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)},d=function(e,t){var n=e.textures[t];return n||((n=e.textures[t]=new Image).src=t,n)},p=function(e,t){var n=t;/(jpg|gif|png)$/.test(t)&&(n="url("+t+")"),e.canvas.style.background=n,e.canvas.style.backgroundSize="contain",e.currentBackground=t}}()},function(e,t){var n={};e.exports=n,n.create=function(e){return{vertex:e,normalImpulse:0,tangentImpulse:0}}},function(e,t,n){var i={};e.exports=i;var r=n(7),o=n(19),s=n(14),a=n(20),l=n(4),c=n(5),u=n(10),h=n(0),f=n(6);i.create=function(e){e=e||{};var t=h.extend({positionIterations:6,velocityIterations:4,constraintIterations:2,enableSleeping:!1,events:[],plugin:{},gravity:{x:0,y:1,scale:.001},timing:{timestamp:0,timeScale:1,lastDelta:0,lastElapsed:0}},e);return t.world=e.world||c.create({label:"World"}),t.pairs=e.pairs||a.create(),t.detector=e.detector||s.create(),t.grid={buckets:[]},t.world.gravity=t.gravity,t.broadphase=t.grid,t.metrics={},t},i.update=function(e,t,n){var f=h.now();t=t||1e3/60,n=n||1;var d,p=e.world,v=e.detector,y=e.pairs,m=e.timing,g=m.timestamp;m.timestamp+=t*m.timeScale,m.lastDelta=t*m.timeScale;var x={timestamp:m.timestamp};l.trigger(e,"beforeUpdate",x);var b=c.allBodies(p),w=c.allConstraints(p);for(p.isModified&&s.setBodies(v,b),p.isModified&&c.setModified(p,!1,!1,!0),e.enableSleeping&&r.update(b,m.timeScale),i._bodiesApplyGravity(b,e.gravity),i._bodiesUpdate(b,t,m.timeScale,n,p.bounds),u.preSolveAll(b),d=0;d<e.constraintIterations;d++)u.solveAll(w,m.timeScale);u.postSolveAll(b),v.pairs=e.pairs;var _=s.collisions(v);for(a.update(y,_,g),e.enableSleeping&&r.afterCollisions(y.list,m.timeScale),y.collisionStart.length>0&&l.trigger(e,"collisionStart",{pairs:y.collisionStart}),o.preSolvePosition(y.list),d=0;d<e.positionIterations;d++)o.solvePosition(y.list,m.timeScale);for(o.postSolvePosition(b),u.preSolveAll(b),d=0;d<e.constraintIterations;d++)u.solveAll(w,m.timeScale);for(u.postSolveAll(b),o.preSolveVelocity(y.list),d=0;d<e.velocityIterations;d++)o.solveVelocity(y.list,m.timeScale);return y.collisionActive.length>0&&l.trigger(e,"collisionActive",{pairs:y.collisionActive}),y.collisionEnd.length>0&&l.trigger(e,"collisionEnd",{pairs:y.collisionEnd}),i._bodiesClearForces(b),l.trigger(e,"afterUpdate",x),e.timing.lastElapsed=h.now()-f,e},i.merge=function(e,t){if(h.extend(e,t),t.world){e.world=t.world,i.clear(e);for(var n=c.allBodies(e.world),o=0;o<n.length;o++){var s=n[o];r.set(s,!1),s.id=h.nextId()}}},i.clear=function(e){a.clear(e.pairs),s.clear(e.detector)},i._bodiesClearForces=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.force.x=0,n.force.y=0,n.torque=0}},i._bodiesApplyGravity=function(e,t){var n=void 0!==t.scale?t.scale:.001;if((0!==t.x||0!==t.y)&&0!==n)for(var i=0;i<e.length;i++){var r=e[i];r.isStatic||r.isSleeping||(r.force.y+=r.mass*t.y*n,r.force.x+=r.mass*t.x*n)}},i._bodiesUpdate=function(e,t,n,i,r){for(var o=0;o<e.length;o++){var s=e[o];s.isStatic||s.isSleeping||f.update(s,t,n,i)}}},function(e,t,n){var i={};e.exports=i;var r=n(3),o=n(1);i._restingThresh=4,i._restingThreshTangent=6,i._positionDampen=.9,i._positionWarming=.8,i._frictionNormalMultiplier=5,i.preSolvePosition=function(e){var t,n,i,r=e.length;for(t=0;t<r;t++)(n=e[t]).isActive&&(i=n.activeContacts.length,n.collision.parentA.totalContacts+=i,n.collision.parentB.totalContacts+=i)},i.solvePosition=function(e,t){var n,r,o,s,a,l,c,u,h=i._positionDampen,f=e.length;for(n=0;n<f;n++)(r=e[n]).isActive&&!r.isSensor&&(s=(o=r.collision).parentA,a=o.parentB,l=o.normal,r.separation=l.x*(a.positionImpulse.x+o.penetration.x-s.positionImpulse.x)+l.y*(a.positionImpulse.y+o.penetration.y-s.positionImpulse.y));for(n=0;n<f;n++)(r=e[n]).isActive&&!r.isSensor&&(s=(o=r.collision).parentA,a=o.parentB,l=o.normal,u=(r.separation-r.slop)*t,(s.isStatic||a.isStatic)&&(u*=2),s.isStatic||s.isSleeping||(c=h/s.totalContacts,s.positionImpulse.x+=l.x*u*c,s.positionImpulse.y+=l.y*u*c),a.isStatic||a.isSleeping||(c=h/a.totalContacts,a.positionImpulse.x-=l.x*u*c,a.positionImpulse.y-=l.y*u*c))},i.postSolvePosition=function(e){for(var t=i._positionWarming,n=e.length,s=r.translate,a=o.update,l=0;l<n;l++){var c=e[l],u=c.positionImpulse,h=u.x,f=u.y,d=c.velocity;if(c.totalContacts=0,0!==h||0!==f){for(var p=0;p<c.parts.length;p++){var v=c.parts[p];s(v.vertices,u),a(v.bounds,v.vertices,d),v.position.x+=h,v.position.y+=f}c.positionPrev.x+=h,c.positionPrev.y+=f,h*d.x+f*d.y<0?(u.x=0,u.y=0):(u.x*=t,u.y*=t)}}},i.preSolveVelocity=function(e){var t,n,i=e.length;for(t=0;t<i;t++){var r=e[t];if(r.isActive&&!r.isSensor){var o=r.activeContacts,s=o.length,a=r.collision,l=a.parentA,c=a.parentB,u=a.normal,h=a.tangent;for(n=0;n<s;n++){var f=o[n],d=f.vertex,p=f.normalImpulse,v=f.tangentImpulse;if(0!==p||0!==v){var y=u.x*p+h.x*v,m=u.y*p+h.y*v;l.isStatic||l.isSleeping||(l.positionPrev.x+=y*l.inverseMass,l.positionPrev.y+=m*l.inverseMass,l.anglePrev+=l.inverseInertia*((d.x-l.position.x)*m-(d.y-l.position.y)*y)),c.isStatic||c.isSleeping||(c.positionPrev.x-=y*c.inverseMass,c.positionPrev.y-=m*c.inverseMass,c.anglePrev-=c.inverseInertia*((d.x-c.position.x)*m-(d.y-c.position.y)*y))}}}}},i.solveVelocity=function(e,t){var n,r,o,s,a=t*t,l=i._restingThresh*a,c=i._frictionNormalMultiplier,u=i._restingThreshTangent*a,h=Number.MAX_VALUE,f=e.length;for(o=0;o<f;o++){var d=e[o];if(d.isActive&&!d.isSensor){var p=d.collision,v=p.parentA,y=p.parentB,m=v.velocity,g=y.velocity,x=p.normal.x,b=p.normal.y,w=p.tangent.x,_=p.tangent.y,S=d.activeContacts,T=S.length,k=1/T,C=v.inverseMass+y.inverseMass,O=d.friction*d.frictionStatic*c*a;for(m.x=v.position.x-v.positionPrev.x,m.y=v.position.y-v.positionPrev.y,g.x=y.position.x-y.positionPrev.x,g.y=y.position.y-y.positionPrev.y,v.angularVelocity=v.angle-v.anglePrev,y.angularVelocity=y.angle-y.anglePrev,s=0;s<T;s++){var E=S[s],P=E.vertex,A=P.x-v.position.x,I=P.y-v.position.y,R=P.x-y.position.x,B=P.y-y.position.y,N=m.x-I*v.angularVelocity,M=m.y+A*v.angularVelocity,D=N-(g.x-B*y.angularVelocity),$=M-(g.y+R*y.angularVelocity),U=x*D+b*$,j=w*D+_*$,L=d.separation+U,z=Math.min(L,1),G=(z=L<0?0:z)*O;j>G||-j>G?(r=j>0?j:-j,(n=d.friction*(j>0?1:-1)*a)<-r?n=-r:n>r&&(n=r)):(n=j,r=h);var F=A*b-I*x,W=R*b-B*x,V=k/(C+v.inverseInertia*F*F+y.inverseInertia*W*W),q=(1+d.restitution)*U*V;if(n*=V,U*U>l&&U<0)E.normalImpulse=0;else{var H=E.normalImpulse;E.normalImpulse+=q,E.normalImpulse=Math.min(E.normalImpulse,0),q=E.normalImpulse-H}if(j*j>u)E.tangentImpulse=0;else{var Y=E.tangentImpulse;E.tangentImpulse+=n,E.tangentImpulse<-r&&(E.tangentImpulse=-r),E.tangentImpulse>r&&(E.tangentImpulse=r),n=E.tangentImpulse-Y}var Q=x*q+w*n,K=b*q+_*n;v.isStatic||v.isSleeping||(v.positionPrev.x+=Q*v.inverseMass,v.positionPrev.y+=K*v.inverseMass,v.anglePrev+=(A*K-I*Q)*v.inverseInertia),y.isStatic||y.isSleeping||(y.positionPrev.x-=Q*y.inverseMass,y.positionPrev.y-=K*y.inverseMass,y.anglePrev-=(R*K-B*Q)*y.inverseInertia)}}}}},function(e,t,n){var i={};e.exports=i;var r=n(9),o=n(0);i.create=function(e){return o.extend({table:{},list:[],collisionStart:[],collisionActive:[],collisionEnd:[]},e)},i.update=function(e,t,n){var i,o,s,a,l=e.list,c=l.length,u=e.table,h=t.length,f=e.collisionStart,d=e.collisionEnd,p=e.collisionActive;for(f.length=0,d.length=0,p.length=0,a=0;a<c;a++)l[a].confirmedActive=!1;for(a=0;a<h;a++)(s=(i=t[a]).pair)?(s.isActive?p.push(s):f.push(s),r.update(s,i,n),s.confirmedActive=!0):(u[(s=r.create(i,n)).id]=s,f.push(s),l.push(s));var v=[];for(c=l.length,a=0;a<c;a++)(s=l[a]).confirmedActive||(r.setActive(s,!1,n),d.push(s),s.collision.bodyA.isSleeping||s.collision.bodyB.isSleeping||v.push(a));for(a=0;a<v.length;a++)s=l[o=v[a]-a],l.splice(o,1),delete u[s.id]},i.clear=function(e){return e.table={},e.list.length=0,e.collisionStart.length=0,e.collisionActive.length=0,e.collisionEnd.length=0,e}},function(e,t,n){var i=e.exports=n(22);i.Axes=n(11),i.Bodies=n(12),i.Body=n(6),i.Bounds=n(1),i.Collision=n(8),i.Common=n(0),i.Composite=n(5),i.Composites=n(23),i.Constraint=n(10),i.Contact=n(17),i.Detector=n(14),i.Engine=n(18),i.Events=n(4),i.Grid=n(24),i.Mouse=n(13),i.MouseConstraint=n(25),i.Pair=n(9),i.Pairs=n(20),i.Plugin=n(15),i.Query=n(26),i.Render=n(16),i.Resolver=n(19),i.Runner=n(27),i.SAT=n(28),i.Sleeping=n(7),i.Svg=n(29),i.Vector=n(2),i.Vertices=n(3),i.World=n(30),i.Engine.run=i.Runner.run,i.Common.deprecated(i.Engine,"run","Engine.run ➤ use Matter.Runner.run(engine) instead")},function(e,t,n){var i={};e.exports=i;var r=n(15),o=n(0);i.name="matter-js",i.version="0.18.0",i.uses=[],i.used=[],i.use=function(){r.use(i,Array.prototype.slice.call(arguments))},i.before=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathBefore(i,e,t)},i.after=function(e,t){return e=e.replace(/^Matter./,""),o.chainPathAfter(i,e,t)}},function(e,t,n){var i={};e.exports=i;var r=n(5),o=n(10),s=n(0),a=n(6),l=n(12),c=s.deprecated;i.stack=function(e,t,n,i,o,s,l){for(var c,u=r.create({label:"Stack"}),h=e,f=t,d=0,p=0;p<i;p++){for(var v=0,y=0;y<n;y++){var m=l(h,f,y,p,c,d);if(m){var g=m.bounds.max.y-m.bounds.min.y,x=m.bounds.max.x-m.bounds.min.x;g>v&&(v=g),a.translate(m,{x:.5*x,y:.5*g}),h=m.bounds.max.x+o,r.addBody(u,m),c=m,d+=1}else h+=o}f+=v+s,h=e}return u},i.chain=function(e,t,n,i,a,l){for(var c=e.bodies,u=1;u<c.length;u++){var h=c[u-1],f=c[u],d=h.bounds.max.y-h.bounds.min.y,p=h.bounds.max.x-h.bounds.min.x,v=f.bounds.max.y-f.bounds.min.y,y={bodyA:h,pointA:{x:p*t,y:d*n},bodyB:f,pointB:{x:(f.bounds.max.x-f.bounds.min.x)*i,y:v*a}},m=s.extend(y,l);r.addConstraint(e,o.create(m))}return e.label+=" Chain",e},i.mesh=function(e,t,n,i,a){var l,c,u,h,f,d=e.bodies;for(l=0;l<n;l++){for(c=1;c<t;c++)u=d[c-1+l*t],h=d[c+l*t],r.addConstraint(e,o.create(s.extend({bodyA:u,bodyB:h},a)));if(l>0)for(c=0;c<t;c++)u=d[c+(l-1)*t],h=d[c+l*t],r.addConstraint(e,o.create(s.extend({bodyA:u,bodyB:h},a))),i&&c>0&&(f=d[c-1+(l-1)*t],r.addConstraint(e,o.create(s.extend({bodyA:f,bodyB:h},a)))),i&&c<t-1&&(f=d[c+1+(l-1)*t],r.addConstraint(e,o.create(s.extend({bodyA:f,bodyB:h},a))))}return e.label+=" Mesh",e},i.pyramid=function(e,t,n,r,o,s,l){return i.stack(e,t,n,r,o,s,(function(t,i,s,c,u,h){var f=Math.min(r,Math.ceil(n/2)),d=u?u.bounds.max.x-u.bounds.min.x:0;if(!(c>f||s<(c=f-c)||s>n-1-c))return 1===h&&a.translate(u,{x:(s+(n%2==1?1:-1))*d,y:0}),l(e+(u?s*d:0)+s*o,i,s,c,u,h)}))},i.newtonsCradle=function(e,t,n,i,s){for(var a=r.create({label:"Newtons Cradle"}),c=0;c<n;c++){var u=l.circle(e+c*(1.9*i),t+s,i,{inertia:1/0,restitution:1,friction:0,frictionAir:1e-4,slop:1}),h=o.create({pointA:{x:e+c*(1.9*i),y:t},bodyB:u});r.addBody(a,u),r.addConstraint(a,h)}return a},c(i,"newtonsCradle","Composites.newtonsCradle ➤ moved to newtonsCradle example"),i.car=function(e,t,n,i,s){var c=a.nextGroup(!0),u=.5*-n+20,h=.5*n-20,f=r.create({label:"Car"}),d=l.rectangle(e,t,n,i,{collisionFilter:{group:c},chamfer:{radius:.5*i},density:2e-4}),p=l.circle(e+u,t+0,s,{collisionFilter:{group:c},friction:.8}),v=l.circle(e+h,t+0,s,{collisionFilter:{group:c},friction:.8}),y=o.create({bodyB:d,pointB:{x:u,y:0},bodyA:p,stiffness:1,length:0}),m=o.create({bodyB:d,pointB:{x:h,y:0},bodyA:v,stiffness:1,length:0});return r.addBody(f,d),r.addBody(f,p),r.addBody(f,v),r.addConstraint(f,y),r.addConstraint(f,m),f},c(i,"car","Composites.car ➤ moved to car example"),i.softBody=function(e,t,n,r,o,a,c,u,h,f){h=s.extend({inertia:1/0},h),f=s.extend({stiffness:.2,render:{type:"line",anchors:!1}},f);var d=i.stack(e,t,n,r,o,a,(function(e,t){return l.circle(e,t,u,h)}));return i.mesh(d,n,r,c,f),d.label="Soft Body",d},c(i,"softBody","Composites.softBody ➤ moved to softBody and cloth examples")},function(e,t,n){var i={};e.exports=i;var r=n(9),o=n(0),s=o.deprecated;i.create=function(e){return o.extend({buckets:{},pairs:{},pairsList:[],bucketWidth:48,bucketHeight:48},e)},i.update=function(e,t,n,r){var o,s,a,l,c,u=n.world,h=e.buckets,f=!1;for(o=0;o<t.length;o++){var d=t[o];if((!d.isSleeping||r)&&(!u.bounds||!(d.bounds.max.x<u.bounds.min.x||d.bounds.min.x>u.bounds.max.x||d.bounds.max.y<u.bounds.min.y||d.bounds.min.y>u.bounds.max.y))){var p=i._getRegion(e,d);if(!d.region||p.id!==d.region.id||r){d.region&&!r||(d.region=p);var v=i._regionUnion(p,d.region);for(s=v.startCol;s<=v.endCol;s++)for(a=v.startRow;a<=v.endRow;a++){l=h[c=i._getBucketId(s,a)];var y=s>=p.startCol&&s<=p.endCol&&a>=p.startRow&&a<=p.endRow,m=s>=d.region.startCol&&s<=d.region.endCol&&a>=d.region.startRow&&a<=d.region.endRow;!y&&m&&m&&l&&i._bucketRemoveBody(e,l,d),(d.region===p||y&&!m||r)&&(l||(l=i._createBucket(h,c)),i._bucketAddBody(e,l,d))}d.region=p,f=!0}}}f&&(e.pairsList=i._createActivePairsList(e))},s(i,"update","Grid.update ➤ replaced by Matter.Detector"),i.clear=function(e){e.buckets={},e.pairs={},e.pairsList=[]},s(i,"clear","Grid.clear ➤ replaced by Matter.Detector"),i._regionUnion=function(e,t){var n=Math.min(e.startCol,t.startCol),r=Math.max(e.endCol,t.endCol),o=Math.min(e.startRow,t.startRow),s=Math.max(e.endRow,t.endRow);return i._createRegion(n,r,o,s)},i._getRegion=function(e,t){var n=t.bounds,r=Math.floor(n.min.x/e.bucketWidth),o=Math.floor(n.max.x/e.bucketWidth),s=Math.floor(n.min.y/e.bucketHeight),a=Math.floor(n.max.y/e.bucketHeight);return i._createRegion(r,o,s,a)},i._createRegion=function(e,t,n,i){return{id:e+","+t+","+n+","+i,startCol:e,endCol:t,startRow:n,endRow:i}},i._getBucketId=function(e,t){return"C"+e+"R"+t},i._createBucket=function(e,t){return e[t]=[]},i._bucketAddBody=function(e,t,n){var i,o=e.pairs,s=r.id,a=t.length;for(i=0;i<a;i++){var l=t[i];if(!(n.id===l.id||n.isStatic&&l.isStatic)){var c=s(n,l),u=o[c];u?u[2]+=1:o[c]=[n,l,1]}}t.push(n)},i._bucketRemoveBody=function(e,t,n){var i,s=e.pairs,a=r.id;t.splice(o.indexOf(t,n),1);var l=t.length;for(i=0;i<l;i++){var c=s[a(n,t[i])];c&&(c[2]-=1)}},i._createActivePairsList=function(e){var t,n,i=e.pairs,r=o.keys(i),s=r.length,a=[];for(n=0;n<s;n++)(t=i[r[n]])[2]>0?a.push(t):delete i[r[n]];return a}},function(e,t,n){var i={};e.exports=i;var r=n(3),o=n(7),s=n(13),a=n(4),l=n(14),c=n(10),u=n(5),h=n(0),f=n(1);i.create=function(e,t){var n=(e?e.mouse:null)||(t?t.mouse:null);n||(e&&e.render&&e.render.canvas?n=s.create(e.render.canvas):t&&t.element?n=s.create(t.element):(n=s.create(),h.warn("MouseConstraint.create: options.mouse was undefined, options.element was undefined, may not function as expected")));var r={type:"mouseConstraint",mouse:n,element:null,body:null,constraint:c.create({label:"Mouse Constraint",pointA:n.position,pointB:{x:0,y:0},length:.01,stiffness:.1,angularStiffness:1,render:{strokeStyle:"#90EE90",lineWidth:3}}),collisionFilter:{category:1,mask:4294967295,group:0}},o=h.extend(r,t);return a.on(e,"beforeUpdate",(function(){var t=u.allBodies(e.world);i.update(o,t),i._triggerEvents(o)})),o},i.update=function(e,t){var n=e.mouse,i=e.constraint,s=e.body;if(0===n.button){if(i.bodyB)o.set(i.bodyB,!1),i.pointA=n.position;else for(var c=0;c<t.length;c++)if(s=t[c],f.contains(s.bounds,n.position)&&l.canCollide(s.collisionFilter,e.collisionFilter))for(var u=s.parts.length>1?1:0;u<s.parts.length;u++){var h=s.parts[u];if(r.contains(h.vertices,n.position)){i.pointA=n.position,i.bodyB=e.body=s,i.pointB={x:n.position.x-s.position.x,y:n.position.y-s.position.y},i.angleB=s.angle,o.set(s,!1),a.trigger(e,"startdrag",{mouse:n,body:s});break}}}else i.bodyB=e.body=null,i.pointB=null,s&&a.trigger(e,"enddrag",{mouse:n,body:s})},i._triggerEvents=function(e){var t=e.mouse,n=t.sourceEvents;n.mousemove&&a.trigger(e,"mousemove",{mouse:t}),n.mousedown&&a.trigger(e,"mousedown",{mouse:t}),n.mouseup&&a.trigger(e,"mouseup",{mouse:t}),s.clearSourceEvents(t)}},function(e,t,n){var i={};e.exports=i;var r=n(2),o=n(8),s=n(1),a=n(12),l=n(3);i.collides=function(e,t){for(var n=[],i=t.length,r=e.bounds,a=o.collides,l=s.overlaps,c=0;c<i;c++){var u=t[c],h=u.parts.length,f=1===h?0:1;if(l(u.bounds,r))for(var d=f;d<h;d++){var p=u.parts[d];if(l(p.bounds,r)){var v=a(p,e);if(v){n.push(v);break}}}}return n},i.ray=function(e,t,n,o){o=o||1e-100;for(var s=r.angle(t,n),l=r.magnitude(r.sub(t,n)),c=.5*(n.x+t.x),u=.5*(n.y+t.y),h=a.rectangle(c,u,l,o,{angle:s}),f=i.collides(h,e),d=0;d<f.length;d+=1){var p=f[d];p.body=p.bodyB=p.bodyA}return f},i.region=function(e,t,n){for(var i=[],r=0;r<e.length;r++){var o=e[r],a=s.overlaps(o.bounds,t);(a&&!n||!a&&n)&&i.push(o)}return i},i.point=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i];if(s.contains(r.bounds,t))for(var o=1===r.parts.length?0:1;o<r.parts.length;o++){var a=r.parts[o];if(s.contains(a.bounds,t)&&l.contains(a.vertices,t)){n.push(r);break}}}return n}},function(e,t,n){var i={};e.exports=i;var r,o,s,a=n(4),l=n(18),c=n(0);"undefined"!=typeof window&&(r=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame,o=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.msCancelAnimationFrame),r||(r=function(e){s=setTimeout((function(){e(c.now())}),1e3/60)},o=function(){clearTimeout(s)}),i.create=function(e){var t=c.extend({fps:60,correction:1,deltaSampleSize:60,counterTimestamp:0,frameCounter:0,deltaHistory:[],timePrev:null,timeScalePrev:1,frameRequestId:null,isFixed:!1,enabled:!0},e);return t.delta=t.delta||1e3/t.fps,t.deltaMin=t.deltaMin||1e3/t.fps,t.deltaMax=t.deltaMax||1e3/(.5*t.fps),t.fps=1e3/t.delta,t},i.run=function(e,t){return void 0!==e.positionIterations&&(t=e,e=i.create()),function n(o){e.frameRequestId=r(n),o&&e.enabled&&i.tick(e,t,o)}(),e},i.tick=function(e,t,n){var i,r=t.timing,o=1,s={timestamp:r.timestamp};a.trigger(e,"beforeTick",s),e.isFixed?i=e.delta:(i=n-e.timePrev||e.delta,e.timePrev=n,e.deltaHistory.push(i),e.deltaHistory=e.deltaHistory.slice(-e.deltaSampleSize),o=(i=(i=(i=Math.min.apply(null,e.deltaHistory))<e.deltaMin?e.deltaMin:i)>e.deltaMax?e.deltaMax:i)/e.delta,e.delta=i),0!==e.timeScalePrev&&(o*=r.timeScale/e.timeScalePrev),0===r.timeScale&&(o=0),e.timeScalePrev=r.timeScale,e.correction=o,e.frameCounter+=1,n-e.counterTimestamp>=1e3&&(e.fps=e.frameCounter*((n-e.counterTimestamp)/1e3),e.counterTimestamp=n,e.frameCounter=0),a.trigger(e,"tick",s),a.trigger(e,"beforeUpdate",s),l.update(t,i,o),a.trigger(e,"afterUpdate",s),a.trigger(e,"afterTick",s)},i.stop=function(e){o(e.frameRequestId)},i.start=function(e,t){i.run(e,t)}},function(e,t,n){var i={};e.exports=i;var r=n(8),o=n(0).deprecated;i.collides=function(e,t){return r.collides(e,t)},o(i,"collides","SAT.collides ➤ replaced by Collision.collides")},function(e,t,n){var i={};e.exports=i,n(1);var r=n(0);i.pathToVertices=function(e,t){"undefined"==typeof window||"SVGPathSeg"in window||r.warn("Svg.pathToVertices: SVGPathSeg not defined, a polyfill is required.");var n,o,s,a,l,c,u,h,f,d,p,v=[],y=0,m=0,g=0;t=t||15;var x=function(e,t,n){var i=n%2==1&&n>1;if(!f||e!=f.x||t!=f.y){f&&i?(d=f.x,p=f.y):(d=0,p=0);var r={x:d+e,y:p+t};!i&&f||(f=r),v.push(r),m=d+e,g=p+t}},b=function(e){var t=e.pathSegTypeAsLetter.toUpperCase();if("Z"!==t){switch(t){case"M":case"L":case"T":case"C":case"S":case"Q":m=e.x,g=e.y;break;case"H":m=e.x;break;case"V":g=e.y}x(m,g,e.pathSegType)}};for(i._svgPathToAbsolute(e),s=e.getTotalLength(),c=[],n=0;n<e.pathSegList.numberOfItems;n+=1)c.push(e.pathSegList.getItem(n));for(u=c.concat();y<s;){if((l=c[e.getPathSegAtLength(y)])!=h){for(;u.length&&u[0]!=l;)b(u.shift());h=l}switch(l.pathSegTypeAsLetter.toUpperCase()){case"C":case"T":case"S":case"Q":case"A":a=e.getPointAtLength(y),x(a.x,a.y,0)}y+=t}for(n=0,o=u.length;n<o;++n)b(u[n]);return v},i._svgPathToAbsolute=function(e){for(var t,n,i,r,o,s,a=e.pathSegList,l=0,c=0,u=a.numberOfItems,h=0;h<u;++h){var f=a.getItem(h),d=f.pathSegTypeAsLetter;if(/[MLHVCSQTA]/.test(d))"x"in f&&(l=f.x),"y"in f&&(c=f.y);else switch("x1"in f&&(i=l+f.x1),"x2"in f&&(o=l+f.x2),"y1"in f&&(r=c+f.y1),"y2"in f&&(s=c+f.y2),"x"in f&&(l+=f.x),"y"in f&&(c+=f.y),d){case"m":a.replaceItem(e.createSVGPathSegMovetoAbs(l,c),h);break;case"l":a.replaceItem(e.createSVGPathSegLinetoAbs(l,c),h);break;case"h":a.replaceItem(e.createSVGPathSegLinetoHorizontalAbs(l),h);break;case"v":a.replaceItem(e.createSVGPathSegLinetoVerticalAbs(c),h);break;case"c":a.replaceItem(e.createSVGPathSegCurvetoCubicAbs(l,c,i,r,o,s),h);break;case"s":a.replaceItem(e.createSVGPathSegCurvetoCubicSmoothAbs(l,c,o,s),h);break;case"q":a.replaceItem(e.createSVGPathSegCurvetoQuadraticAbs(l,c,i,r),h);break;case"t":a.replaceItem(e.createSVGPathSegCurvetoQuadraticSmoothAbs(l,c),h);break;case"a":a.replaceItem(e.createSVGPathSegArcAbs(l,c,f.r1,f.r2,f.angle,f.largeArcFlag,f.sweepFlag),h);break;case"z":case"Z":l=t,c=n}"M"!=d&&"m"!=d||(t=l,n=c)}}},function(e,t,n){var i={};e.exports=i;var r=n(5);n(0),i.create=r.create,i.add=r.add,i.remove=r.remove,i.clear=r.clear,i.addComposite=r.addComposite,i.addBody=r.addBody,i.addConstraint=r.addConstraint}])},e.exports=i()}},t={};function n(i){var r=t[i];if(void 0!==r)return r.exports;var o=t[i]={exports:{}};return e[i].call(o.exports,o,o.exports,n),o.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var i={};(()=>{"use strict";n.r(i),n.d(i,{Body:()=>k,Camera:()=>Z,CircleCollider:()=>v,CircleRenderer:()=>G,Collider:()=>p,Entity:()=>fe,EntropyEngine:()=>Be,GUIBox:()=>q,GUICircle:()=>H,GUIElement:()=>V,GUIImage:()=>Y,GUIPolygon:()=>Q,GUIRect:()=>K,GUIText:()=>J,GUITextBox:()=>X,ImageRenderer2D:()=>W,JSONifyComponent:()=>g,MeshV2:()=>xe,MeshV3:()=>we,RectCollider:()=>y,RectRenderer:()=>F,Scene:()=>te,Script:()=>f,Systems:()=>me,Transform:()=>ne,TriangleV2:()=>ge,TriangleV3:()=>be,circle:()=>P,clearCanvas:()=>Te,colour:()=>r,cullString:()=>b,defaultSceneSettings:()=>ee,drawCameraViewArea:()=>Pe,drawCameras:()=>Ee,entitiesFromJSON:()=>ue,genCacheBust:()=>_,getMousePos:()=>pe,image:()=>B,initialiseEntropyScript:()=>Se,initialiseScenes:()=>he,input:()=>ve,nameFromScriptURL:()=>w,polygon:()=>I,rect:()=>A,renderAll:()=>Ce,renderBackground:()=>ke,renderDebug:()=>Ae,renderSelectedOutline:()=>Ie,reset:()=>C,rgb:()=>o,rgbValToHex:()=>l,rgba:()=>a,rotateAroundPointWrapper:()=>O,roundedRect:()=>E,runFromJSON:()=>Ne,scaleMeshV2:()=>x,scriptFetchHeaders:()=>S,scriptFetchInit:()=>T,sleep:()=>m,startAnimation:()=>de,text:()=>R,v2:()=>t,v3:()=>e});class e{constructor(n,i=n,r=n,o=1){this.add=e=>(this.x+=(null==e?void 0:e.x)||0,this.y+=(null==e?void 0:e.y)||0,this.z+=(null==e?void 0:e.z)||0,this),this.sub=e=>(this.x-=e.x||0,this.y-=e.y||0,this.z-=e.z||0,this),this.mul=e=>(this.x*=e.x,this.y*=e.y,this.z*=e.z,this),this.scale=e=>(this.x*=e,this.y*=e,this.z*=e,this),this.div=e=>(0!==e.x&&(this.x/=e.x),0!==e.y&&(this.y/=e.y),0!==e.z&&(this.z/=e.z),this),this.distTo=e=>this.clone.sub(e).magnitude,this.diff=t=>new e(Math.abs(this.x-t.x),Math.abs(this.y-t.y),Math.abs(this.z-t.z)),this.normalise=()=>{const e=this.magnitude;return 0!==e?this.scale(1/e):console.error("Cannot normalise vector with magnitude 0"),this},this.equals=e=>e.x===this.x&&e.y===this.y&&e.z===this.z,this.isInCuboid=(e,n)=>new t(this.x,this.y).isInRect(new t(e.x,e.y),new t(n.x,n.y))&&new t(this.y,this.z).isInRect(new t(e.y,e.z),new t(n.y,n.z))&&new t(this.x,this.z).isInRect(new t(e.x,e.z),new t(n.x,n.z)),this.set=e=>(this.x=e.x,this.y=e.y,this.z=e.z,this),this.apply=e=>{this.x=e(this.x),this.y=e(this.y),this.z=e(this.z)},this.dot=e=>this.x*e.x+this.y*e.y+this.z*e.z,this.cross=e=>this.x*e.y-this.y*e.x-this.z*e.z,this.toInt=()=>(this.apply(Math.round),this),this.x=n,this.y=i,this.z=r,this.w=o}get magnitude(){let e=Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2);return 0===e?0:Math.sqrt(e)}get clone(){return new e(this.x,this.y,this.z)}get str(){return`x: ${this.x} \ny: ${this.y} \nz: ${this.z}`}get negative(){return this.clone.scale(-1)}get v2(){return new t(this.x,this.y)}get array(){return[this.x,this.y,this.z]}static get up(){return new e(0,1,0)}static get down(){return new e(0,-1,0)}static get right(){return new e(1,0,0)}static get left(){return new e(-1,0,0)}static get forward(){return new e(0,0,1)}static get back(){return new e(0,0,-1)}static get zero(){return new e(0,0,0)}static avPoint(t){let n=e.zero;for(let e of t)n.add(e);return n.scale(1/t.length)}static fromArray(t){return new e(t[0],t[1],t[2])}}class t{constructor(e,t=e){this.x=e,this.y=t}add(e){return this.x+=e.x,this.y+=e.y,this}sub(e){return this.x-=e.x,this.y-=e.y,this}mul(e){return this.x*=e.x,this.y*=e.y,this}scale(e){return this.x*=e,this.y*=e,this}div(e){return 0!==e.x&&(this.x/=e.x),0!==e.y&&(this.y/=e.y),this}distTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}diff(e){return new t(Math.abs(this.x-e.x),Math.abs(this.y-e.y))}get magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}normalise(){const e=this.magnitude;return 0!==e?this.scale(1/e):console.error("Cannot normalise vector with magnitude 0"),this}get clone(){return new t(this.x,this.y)}get angle(){return-Math.atan2(-this.y,this.x)}get str(){return`x: ${this.x} \ny: ${this.y}`}equals(e){return e.x===this.x&&e.y===this.y}isInRect(e,t){return this.x>e.x&&this.x<e.x+t.x&&this.y>e.y&&this.y<e.y+t.y}set(e){return this.x=Number(e.x),this.y=Number(e.y),this}apply(e){this.x=Number(e(this.x)),this.y=Number(e(this.y))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}get negative(){return this.clone.scale(-1)}toInt(){return this.apply(Math.round),this}get v3(){return new e(this.x,this.y,0)}get array(){return[this.x,this.y]}static fromAngleMagnitude(e,n){for(;e<0;)e+=360;return e%=360,new t(Math.sin(e),Math.cos(e)).normalise().scale(n)}static fromArray(e){return new t(e[0],e[1])}static get up(){return new t(0,1)}static get down(){return new t(0,-1)}static get right(){return new t(1,0)}static get left(){return new t(-1,0)}static get zero(){return new t(0,0)}static avPoint(e){let n=t.zero;for(let t of e)n.add(t);return n.scale(1/e.length)}}class r{constructor(e=0,t=e,n=e,i=1){this.red=e,this.green=t,this.blue=n,this.alpha=i,this.isColour=!0}get hex(){return`#${l(this.red)}${l(this.green)}${l(this.blue)}`}get rgb(){return`rgb(${this.red}, ${this.green}, ${this.blue})`}get rgba(){return`rgba(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`}get clone(){return new r(this.red,this.green,this.blue,this.alpha)}get json(){return{r:this.red,g:this.green,b:this.blue,a:this.alpha}}static parse(e){let t;return t=e.match(/^#([0-9a-f]{3})$/i),t&&t[1]?o(17*parseInt(t[1].charAt(0),16),17*parseInt(t[1].charAt(1),16),17*parseInt(t[1].charAt(2),16)):(t=e.match(/^#([0-9a-f]{6})$/i),t?o(parseInt(t[1].substr(0,2),16),parseInt(t[1].substr(2,2),16),parseInt(t[1].substr(4,2),16)):(t=e.match(/^rgb\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i),t?o(parseInt(t[1]),parseInt(t[2]),parseInt(t[3])):s[e]||o(0,0,0)))}fromJSON({r:e,g:t,b:n}){return o(e,t,n)}}function o(e=0,t=e,n=e){return new r(e,t,n)}const s={red:o(255,0,0),green:o(0,255,0),blue:o(0,0,255),white:o(255,255,255)};function a(e,t,n,i){return new r(e,t,n,i)}function l(e){let t=Number(e).toString(16);return t.length<2&&(t="0"+t),t}o.parse=r.parse;class c{constructor(e){this.array=e.array||!1,this.type=e.type||typeof e.value||"string",this.value=e.value,this.name=e.name,this.description=e.description||"",this.default=e.default,this.assetType=e.assetType,this.array&&(this.value?Array.isArray(this.value)||(this.value=[this.value]):this.value=[])}}class u{constructor(e,t=""){this.type=e,this.subtype=t,this.public=[]}addPublic(e){if(!e.name)return void console.error("Public fields must have 'name' property");if(this.hasPublic(e.name))return void console.error("Cannot add property with existing name: "+e.name);if(void 0===e.value&&void 0===e.default)return void console.error("Public fields must have 'value' property");void 0===e.value&&(e.value=e.default);const t=new c(e);return this.public.push(t),Object.defineProperty(this,e.name,{enumerable:!0,get(){return void 0===e.overrideGet?this.getPublic(e.name):e.overrideGet()},set(t){void 0!==e.overrideSet?e.overrideSet(t):this.setPublicTypeCheck(e.name,t)}}),t}getPublic(e){for(let t of this.public)if(t.name===e)return t.value}getPublicField(e){for(let t of this.public)if(t.name===e)return t}hasPublic(e){for(let t of this.public)if(t.name===e)return!0;return!1}setPublic(e,t){for(let n of this.public)n.name===e&&(n.value=t)}setPublicTypeCheck(n,i){if(!this.hasPublic(n))return void console.log(`No public variable found  with name ${n}`);const r=typeof i,s=this.getPublicField(n);if(void 0!==s)switch(s.type){case"rgb":if("string"==typeof i){this.setPublic(n,o.parse(i));break}if(i&&(null==i?void 0:i.isColour)){this.setPublic(n,i);break}console.error(`Cannot set property '${n}' of type '${r}' to:`,i);break;case"Transform":this.setPublic(n,i);break;case"v2":if(i instanceof t){this.setPublic(n,i);break}if(Array.isArray(i)&&2===i.length){this.setPublic(n,t.fromArray(i));break}if("number"==typeof i.x&&"number"==typeof i.y){this.setPublic(n,new t(i.x,i.y));break}console.error(`Cannot set public property '${n}' of type v2 to value '${i}' of type '${r}'`);break;case"v3":if(i instanceof e){this.setPublic(n,i);break}if(Array.isArray(i)&&(3===i.length||4===i.length)){this.setPublic(n,e.fromArray(i));break}if("number"==typeof i.x&&"number"==typeof i.y&&"number"==typeof i.z){this.setPublic(n,new e(i.x,i.y,i.z,i.w));break}console.error(`Cannot set public property '${n}' of type v3 to value '${i}' of type '${r}'`);break;default:if(r!==s.type)return void console.error(`Tried to set public variable '${n}' of type '${s.type}' to '${i}' of type '${r}'`);this.setPublic(n,i)}else console.log(`No public variable found  with name ${n}`)}}var h=n(768);class f extends u{constructor({path:e,script:t,name:n}={}){super("Script",n||(e||"").split("/").pop()||"noscript"),this.name="",this.path="",this.runMethod=(e,t,n=[])=>{var i;if(this.script instanceof h.ESNamespace){n=[new h.ESJSBinding(t),...n];const r=null===(i=this.script)||void 0===i?void 0:i.__getProperty__({context:h.global},new h.ESString(e));if(!(r instanceof h.ESFunction))return;r.__call__({context:h.global},...n)}else if(this.script){const i=this.script[e];if("function"!=typeof i)return;i(t,...n)}else console.error(`Cannot run method '${e}' - script not defined`)},e&&(this.path=e),this.name=n||this.path.split("/").pop()||"noscript",this.script=t}jsonPublic(){let n=[];for(let i of this.public){const r={};let o=i;for(const n in i)"value"===n&&(o[n]instanceof t||o[n]instanceof e)?r[n]=o[n].array:r[n]=o[n];n.push(r)}return n}json(){return{type:"Script",path:"scripts.js",name:this.name,public:this.jsonPublic()}}Update(){}}var d=n(842);class p extends u{constructor(e,n,i,r){super("Collider",e),this.offset=t.zero,this.solid=!0,this.addPublic({name:"solid",value:n,description:"If the collider should interact with other colliders or not",default:!0,type:"boolean"}),this.addPublic({name:"offset",value:i,type:"v2",description:"Offsets the renderer from the transform of the entity",default:t.zero}),this.MatterBody=r}}class v extends p{constructor({radius:e=1,solid:n=!0,offset:i=new t(0,0)}={}){super("CircleCollider",n,i,d.Bodies.circle(0,0,e,{})),this.radius=0,this.addPublic({name:"radius",value:e,default:1})}overlapsPoint(e,t){const n=d.Bodies.circle(e.position.x,e.position.y,this.radius*e.scale.x,{angle:e.rotation.z});return d.Query.point([n],d.Vector.create(t.x,t.y)).length>0}json(){return{type:"CircleCollider",radius:this.radius,solid:this.solid,offset:this.offset.array}}}class y extends p{constructor({width:e=1,height:n=1,solid:i=!0,offset:r=new t(0,0)}={}){super("RectCollider",i,r,d.Bodies.rectangle(0,0,e,n,{})),this.width=0,this.height=0,this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:e})}overlapsPoint(e,t){const n=d.Bodies.rectangle(e.position.x,e.position.y,this.width*e.scale.x,this.height*e.scale.y,{angle:e.rotation.z});return d.Query.point([n],d.Vector.create(t.x,t.y)).length>0}json(){return{type:"RectCollider",height:this.height,width:this.width,solid:this.solid,offset:this.offset.array}}}function m(e){return new Promise((t=>setTimeout(t,e)))}function g(n,i){let r={};for(const i in n){if(-1!==["type","subtype","hasSubType","public"].indexOf(i))continue;let o=n[i];o instanceof t||o instanceof e?o=o.array:o.isColour&&(o=o.json),r[i]=o}return r.type=i||n.subtype,r}function x(e,n){const i=e.map((e=>e.clone));let r=t.avPoint(i);for(let e of i){const t=e.clone.sub(r);t.mul(n);const i=r.clone.add(t);e.set(i)}return i}function b(e,t){if(t>=e.length)return e;let n="";for(let i=0;i<t;i++)n+=e[i]||"";return n.length<e.length&&(n+="..."),n}function w(e){let t=e.substring(e.lastIndexOf("/")+1);return t.substring(0,t.length-3)}function _(){return Math.ceil(1e4*Math.random())}const S=new Headers;S.append("pragma","no-cache"),S.append("cache-control","no-cache");const T={method:"GET",headers:S};class k extends u{constructor({velocity:t=e.zero,mass:n=1,friction:i=.1,airResistance:r=.1,bounciness:o=.2}={}){super("Body"),this.velocity=e.zero,this.mass=0,this.friction=0,this.airResistance=0,this.bounciness=0,this.addPublic({name:"velocity",value:t,description:"The speed and direction of the object at the first frame",type:"v3"}),this.addPublic({name:"mass",value:n,description:"The mass of the object affects collisions, forces and more."}),this.addPublic({name:"friction",value:i,description:"When colliding, this is applied to the velocity. Higher values slow it down more."}),this.addPublic({name:"airResistance",value:r,description:"Velocity is scaled by this every Update. Larger values give higher resistance and more slowing"}),this.addPublic({name:"bounciness",value:o,description:"When dynamically colliding, the velocity is reversed and multiplied by this. Higher values give a higher bounce."})}json(){return g(this,"Body")}applyForce(e){return this.velocity.add(e.clone.scale(1/this.mass)),this.velocity}}function C(e){e.transform(1,0,0,-1,0,e.canvas.height)}function O(e,t,n,i){e.translate(t.x,t.y),e.rotate(n*Math.PI/180),e.translate(-t.x,-t.y),i(),e.translate(t.x,t.y),e.rotate(-n*Math.PI/180),e.translate(-t.x,-t.y)}function E(e,n,i,r,o,s,a=0){O(e,r.clone.add(new t(n/2,i/2)),a,(()=>{e.beginPath(),e.moveTo(r.x+s,r.y),e.lineTo(r.x+n-s,r.y),e.quadraticCurveTo(r.x+n,r.y,r.x+n,r.y+s),e.lineTo(r.x+n,r.y+i-s),e.quadraticCurveTo(r.x+n,r.y+i,r.x+n-s,r.y+i),e.lineTo(r.x+s,r.y+i),e.quadraticCurveTo(r.x,r.y+i,r.x,r.y+i-s),e.lineTo(r.x,r.y+s),e.quadraticCurveTo(r.x,r.y,r.x+s,r.y),e.closePath(),e.fillStyle=o,e.fill(),e.closePath()}))}function P(e,t,n,i,r=2*Math.PI,o=0){O(e,t.clone,o,(()=>{e.beginPath(),e.arc(t.x,t.y,n,0,r),e.fillStyle=i,e.fill(),e.closePath()}))}function A(e,n,i,r,o,s=0){O(e,n.clone.add(new t(i/2,r/2)),s,(()=>{e.beginPath(),e.rect(n.x,n.y,i,r),e.fillStyle=o,e.fill(),e.closePath()}))}function I(e,n,i,r=!0,o=0){O(e,t.avPoint(n),o,(()=>{e.beginPath(),e.moveTo(n[0].x,n[0].y),e.strokeStyle=i;for(let t of n.slice(1,n.length))e.lineTo(t.x,t.y);r?(e.fillStyle=i,e.fill(),e.closePath()):e.stroke()}))}function R(e,n,i,r,o,s,a="center",l=0){const c=new t(e.measureText(n).width,i),u=s.clone.add(c.clone.scale(.5));O(e,u,l,(()=>{e.beginPath(),e.font=`${i}px ${r}`,e.fillStyle=o,e.textBaseline="middle",e.textAlign=a,e.fillText(n,s.x,s.y),e.closePath()}))}function B(e,t,n,i,r=0){O(e,t.clone.add(n.clone.scale(.5)),r,(()=>{t=t.clone,e.beginPath();let r=new Image;r.src=i;const o=t.clone.add(n.clone.scale(.5));e.translate(o.x,o.y),e.scale(-1,1),e.translate(-o.x,-o.y),e.drawImage(r,t.x,t.y,n.x,n.y),e.translate(o.x,o.y),e.scale(-1,1),e.translate(-o.x,-o.y),e.closePath()}))}function N(e){return new t(e.width,e.height)}function M(e,t,n){return e.sub(n).scale(t).add(n)}function D(e){const t=j(e);t.transform(1,0,0,-1,0,e.height),t.save()}function $(e,t,n,i){e.style.position="absolute",e.style.left="0",e.style.top="0",e.style.zIndex=t,e.style.height=`${i.y}px`,e.style.width=`${i.x}px`,e.width=i.x,e.height=i.y}function U(e){var n,i;const r=e.background.parentElement;if(!r)throw"no parent element of canvases";const o=new t((null===(n=r.parentElement)||void 0===n?void 0:n.clientWidth)||0,null===(i=r.parentElement)||void 0===i?void 0:i.clientHeight);$(e.input,"4",0,o),$(e.GUI,"3",0,o),$(e.render,"2",0,o),$(e.background,"1",0,o),D(e.input),D(e.GUI),D(e.render),D(e.background)}function j(e){const t=e.getContext("2d");if(!t)throw"no ctx on canvas";return t}class L extends u{constructor(e){super("Renderer",e)}Update(){}json(){return g(this)}}class z extends L{constructor(e,n){super(e),this.offset=t.zero,this.addPublic({name:"offset",value:n,type:"v2",description:"offset from entity's transforms position"})}Update(){}json(){return g(this)}}class G extends z{constructor({radius:e=1,offset:n=new t(0,0),colour:i=o()}={}){super("CircleRenderer",n),this.radius=1,this.colour=o(),this.addPublic({name:"radius",value:e,type:"number",array:!1}),this.addPublic({name:"colour",value:i,type:"rgb",overrideSet:e=>{"string"!=typeof e?this.setPublic("colour",e):this.setPublic("colour",o.parse(e))}})}draw({zoom:e,transform:t,ctx:n,position:i,center:r}){const o=this.radius*e*t.scale.x;o<=0||P(n,M(i.clone.add(this.offset),e,r),o,this.colour.rgb)}}class F extends z{constructor({height:e=1,offset:n=new t(0,0),width:i=1,colour:r=o(0,0,0)}={}){super("RectRenderer",n),this.height=1,this.width=1,this.colour=o(),this.addPublic({name:"height",value:e}),this.addPublic({name:"width",value:i}),this.addPublic({name:"colour",value:r,type:"rgb",overrideSet:e=>{"string"!=typeof e?"number"!=typeof e.r?this.setPublic("colour",e):this.setPublic("colour",a(e.r,e.g,e.b,e.a)):this.setPublic("colour",o.parse(e))}})}Start(){}draw(e){const n=this.width*e.transform.scale.x*e.zoom,i=this.height*e.transform.scale.y*e.zoom;if(i<=0||n<=0)return;let r=this.offset.clone.add(e.position);r.sub(new t(n/(2*e.zoom),i/(2*e.zoom))),A(e.ctx,M(r,e.zoom,e.center),n,i,this.colour.rgb,e.transform.rotation.z)}}class W extends z{constructor({height:e=1,offset:n=new t(0,0),width:i=1,url:r=""}={}){super("ImageRenderer2D",n),this.height=1,this.width=1,this.url="",this.addPublic({name:"height",value:e}),this.addPublic({name:"width",value:i}),this.addPublic({name:"url",value:r,type:"string",description:"The path to the image to be rendered - always start with ../projects/{yourProjectID}/assets/"})}Start(){}draw(e){if(!this.url)return;const n=this.width*e.transform.scale.x*e.zoom,i=this.height*e.transform.scale.y*e.zoom;if(i<=0||n<=0)return;let r=this.offset.clone.add(e.position);r.sub(new t(n/(2*e.zoom),i/(2*e.zoom))),B(e.ctx,M(r,e.zoom,e.center),new t(n,i),this.url,e.transform.rotation.z)}}class V extends u{constructor(e,t){super("GUIElement",e),this.hovered=!1,this.zLayer=0,this.hovered=!1,this.addPublic({name:"zLayer",value:t,description:"Determines what appears on top of what in the GUI"})}json(){return g(this)}}class q extends V{constructor({height:e=30,width:t=60,radius:n=0,innerColour:i=o(230,230,230),outerColour:r=o(90,90,90),borderThickness:s=1,zLayer:a=1}){super("GUIBox",a),this.height=0,this.width=0,this.radius=0,this.innerColour=o(),this.outerColour=o(),this.borderThickness=0,this.addPublic({name:"height",value:e,default:30}),this.addPublic({name:"width",value:t,default:60}),this.addPublic({name:"radius",value:Math.min(n,t/2,e/2),description:"Radius of the bod - maxed at (size of smaller dimension)/2",default:0,overrideSet:e=>{const t=Math.min(e,this.width/2,this.height/2);this.setPublic("radius",t)}}),this.addPublic({name:"innerColour",value:i,description:"Colour of background of box",type:"rgb"}),this.addPublic({name:"outerColour",value:r,description:"Colour of border of box",type:"rgb"}),this.addPublic({name:"borderThickness",value:s,default:1})}Start(){}draw(e,n){if(0===this.width||0===this.height)return;this.borderThickness>0&&E(e,this.width*n.scale.x,this.height*n.scale.y,n.position.v2,this.outerColour.rgba,this.radius);const i=this.borderThickness;E(e,this.width*n.scale.x-2*i,this.height*n.scale.y-2*i,n.position.v2.add(new t(i,i)),this.innerColour.rgba,this.radius-i)}touchingPoint(e,n,i){return e.isInRect(i.position.v2,new t(this.width*i.scale.x,this.height*i.scale.y))}}class H extends V{constructor({zLayer:e=1,colour:t=o(150,150,150),radius:n=1}){super("GUIRect",e),this.colour=o(),this.radius=0,this.addPublic({name:"colour",value:t,type:"rgb"}),this.addPublic({name:"radius",value:n})}draw(e,t){const n=this.radius*t.scale.x;n<=0||P(e,t.position.v2,n,this.colour.rgba)}touchingPoint(e,t,n){return e.clone.distTo(n.position.v2)<=this.radius*n.scale.x}}class Y extends V{constructor({zLayer:e=1,width:t=100,height:n=100,url:i=""}){super("GUIImage",e),this.width=0,this.height=0,this.url="",this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:t}),this.addPublic({name:"url",value:i})}draw(e,n){if(!this.url)return;const i=this.width*n.scale.x,r=this.height*n.scale.y;r<=0||i<=0||B(e,n.position.v2,new t(i,r),this.url,n.rotation.z)}touchingPoint(e,n,i){const r=this.width*i.scale.x,o=this.height*i.scale.y;return e.isInRect(i.position.v2,new t(r,o))}}class Q extends V{constructor({zLayer:e=1,colour:n=o(150,150,150),points:i=[t.zero]}){super("GUIPolygon",e),this.colour=o(),this.points=[],this.addPublic({name:"colour",value:n,type:"rgb"}),this.addPublic({name:"points",value:i,type:"v2",array:!0})}draw(e,t){this.points.length<=1||I(e,x(this.points,t.scale.v2),this.colour.hex,!0,t.rotation.z)}touchingPoint(e,t,n){return function(e,t){if(e.length<=1)return!1;let n=[[e[0],e[e.length-1]],[e[0],e[1]]];for(let t=1;t<e.length-1;t++)n.push([e[t],e[t+1]]);let i=0;for(let e of n){if(e[0].y>t.y&&e[1].y>t.y)continue;if(e[0].y<t.y&&e[1].y<t.y)continue;let n=e[0].y<t.y?e[0]:e[1],r=e[0].y>t.y?e[0]:e[1];Object.is(n,r)||n.x+(t.y-n.y)*(r.x-n.x)/(r.y-n.y)<t.x||i++}return i%2==1}(this.points,e)}}class K extends V{constructor({zLayer:e=1,width:t=10,height:n=10,colour:i=o(150,150,150),radius:r=1}){super("GUIRect",e),this.width=0,this.height=0,this.colour=o(),this.radius=0,this.addPublic({name:"height",value:n}),this.addPublic({name:"width",value:t}),this.addPublic({name:"radius",value:Math.min(r,t/2,n/2),description:"Radius of the bod - maxed at (size of smaller dimension)/2",default:0,overrideSet:e=>{const t=Math.min(e,this.width/2,this.height/2);this.setPublic("radius",t)}}),this.addPublic({name:"colour",value:i,type:"rgb"})}draw(e,t){const n=this.width*t.scale.x,i=this.height*t.scale.y;i<=0||n<=0||E(e,n,i,t.position.v2,this.colour.hex,this.radius)}touchingPoint(e,n,i){const r=this.width*i.scale.x,o=this.height*i.scale.y;return e.isInRect(i.position.v2,new t(r,o))}}class J extends V{constructor({text:e="",fontSize:t=12,font:n="Arial",colour:i=o(0,0,0),alignment:r="center",fill:s=!0,zLayer:a=1}){super("GUIText",a),this.text="",this.fontSize=0,this.font="",this.colour=o(),this.alignment="",this.fill=!1,this.addPublic({name:"text",value:e,default:""}),this.addPublic({name:"fontSize",value:t,description:"In px",default:12}),this.addPublic({name:"font",value:n,default:"Arial"}),this.addPublic({name:"colour",value:i,type:"rgb"}),this.addPublic({name:"alignment",value:r,description:"Center, left or right. Default center",type:"string",default:"center"}),this.addPublic({name:"fill",value:s,description:"Should the text be filled or hollow",type:"boolean",default:!0})}draw(e,t){R(e,this.text,this.fontSize*t.scale.x,this.font,this.colour.rgba,t.position.v2)}touchingPoint(e,n,i){n.font=`${this.fontSize}px ${this.font}`;const r=n.measureText(this.text);return e.isInRect(i.position.v2,new t(r.width,this.fontSize*i.scale.x))}}class X extends V{constructor({zLayer:e=1,initialText:t="text",fontSize:n=12,font:i="Arial",textColour:r=o(0,0,0),textAlignment:s="center",fillText:a=!0,limiter:l=(e=>e),maxLength:c=100}){super("GUITextBox",e),this.maxLength=0,this.text=new J({text:t,fontSize:n,colour:r,font:i,alignment:s,fill:a}),this.selected=!1,this.limiter=l,this.addPublic({name:"maxLength",value:c,default:100})}draw(e,t){this.text.draw(e,t)}touchingPoint(e,t,n){return this.text.touchingPoint(e,t,n)}limit(){this.text.text=this.limiter(this.text.text)}keyPress(e){const t=this.text.text;13!==e.keyCode?t.length>=this.maxLength||(this.text.text=`${t}${String.fromCharCode(e.keyCode)}`,this.limit()):this.selected=!1}backspace(){this.text.text=this.text.text.slice(0,-1),this.limit()}get innerText(){return this.text.text}set innerText(e){this.text.text=e}}class Z extends u{constructor({zoom:e=1,far:t=1e3,near:n=.1,fov:i=90}={}){super("Camera"),this.zoom=1,this.far=1e3,this.near=.1,this.fov=90,this.addPublic({name:"zoom",value:e,description:"2D only camera zoom - does not affect 3D rendering"}),this.addPublic({name:"far",value:t,description:"The far clipping plane. Does not affect 2D rendering."}),this.addPublic({name:"near",value:n,description:"The near clipping plane. Does not affect 2D rendering."}),this.addPublic({name:"fov",value:i,description:"Field of view - like zoom for 3D"})}json(){return g(this,"Camera")}screenSpaceToWorldSpace(e,t,n){e=e.clone;const i=N(t).scale(.5);return e.set(M(e,1/this.zoom,i)),e.add(n.v2),e.sub(i),e}worldSpaceToScreenSpace(e,t,n){const i=N(t).clone.scale(.5);return n=n.clone.sub(i.v3),M(e.clone.sub(n.v2),this.zoom,i)}}const ee=()=>({license:"0000",version:"0.0.0",gameName:"Entropy Engine Game",maxFrameRate:60,timeScale:1,backgroundTint:o.parse("white"),globalGravity:new e(0,0,0),collisionIterations:5,globalVolume:1});class te{constructor(e,t){this.id=te.scenes.length,this.name=e,this.settings=t}json(){var e;return{name:this.name,settings:{license:this.settings.license,version:this.settings.version,gameName:this.settings.gameName,maxFrameRate:this.settings.maxFrameRate,timeScale:this.settings.timeScale,backgroundTint:(null===(e=this.settings.backgroundTint)||void 0===e?void 0:e.json)||o.parse("white").json,backgroundImage:this.settings.backgroundImage,globalGravity:this.settings.globalGravity.array,collisionIterations:this.settings.collisionIterations,globalVolume:this.settings.globalVolume}}}get entities(){const e=[],t=[];for(const t of fe.entities)t.transform.isChild()||t.transform.parent===this.id&&e.push(t);for(;e.length>0;){for(let t of e[0].transform.children)e.push(t);t.push(e.shift())}return t}findMainCamera(){for(const e of this.entities)if(e.hasComponent("Camera"))return void(Z.main=e);console.error(`\n            No sprites with component of type 'camera' can be found.\n            Make sure that there is at least one sprite in the scene '${te.activeScene.name}' with a 'Camera' component attached\n        `)}loopThroughScripts(e){for(const t of this.entities)for(const n of t.getComponents("Script"))e(n,t)}broadcast(e,t=[]){this.loopThroughScripts(((n,i)=>{n.runMethod(e,i,t)}))}static loopThroughAllScripts(e){fe.loop((t=>{for(const n of t.getComponents("Script"))e(n,t)}))}static get activeScene(){if(this.scenes.length<1)throw"No scenes found";return te.sceneByID(te.active)}static set activeScene(e){te.active=e.id}static sceneByName(e){const t=te.scenes.filter((t=>t.name===e));if(!(void 0!==t&&t[0]&&t[0]instanceof te))throw`Cannot find scene name: ${e}`;return t[0]}static sceneExistsWithID(e){return void 0!==te.scenes.filter((t=>t.id===e))[0]}static sceneByID(e){const t=te.scenes.filter((t=>t.id===e))[0];if(void 0===t)throw`Cannot find scene ID: ${e} of type ${typeof e}. Scenes: ${te.scenes}`;return t}static create(e){const t=new te(e.name||"Scene",Object.assign(Object.assign({},ee()),e.settings));return te.scenes.push(t),t}static next(e){te.active++,te.active>te.scenes.length-1&&(te.active=0);for(let t of e)"number"==typeof t.transform.parent&&(t.transform.parent=te.active);te.activeScene.findMainCamera()}static previous(e){te.active--,te.active<0&&(te.active=te.scenes.length-1);for(let t of e)"number"==typeof t.transform.parent&&(t.transform.parent=te.active);te.activeScene.findMainCamera()}static get sceneCount(){return te.scenes.length}}te.scenes=[],te.active=0;class ne extends u{constructor({position:t=e.zero,scale:n=new e(1,1,1),rotation:i=e.zero,parent:r=te.active}={}){super("Transform"),this.position=e.zero,this.scale=new e(1),this.rotation=e.zero,this.parent=0,this.addPublic({name:"position",value:t,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("position")||e.zero;const t=this.getPublic("position");return t?t.add(this.parent.position):e.zero},overrideSet:t=>{var n,i;const r=t||e.zero;null!==(n=r.x)&&void 0!==n||(r.x=0),null!==(i=r.y)&&void 0!==i||(r.y=0),this.setPublic("position",r)}}),this.addPublic({name:"rotation",value:i,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("rotation")||e.zero;const t=this.getPublic("rotation");return t?t.clone.add(this.parent.rotation):e.zero},overrideSet:t=>{var n,i;const r=t||e.zero;null!==(n=r.x)&&void 0!==n||(r.x=0),null!==(i=r.y)&&void 0!==i||(r.y=0),this.setPublic("rotation",r)}}),this.addPublic({name:"scale",value:n,type:"v3",overrideGet:()=>{if("number"==typeof this.parent)return this.getPublic("scale")||new e(1);const t=this.getPublic("scale");return t?t.add(this.parent.scale):e.zero},overrideSet:t=>{var n,i;const r=t||e.zero;null!==(n=r.x)&&void 0!==n||(r.x=1),null!==(i=r.y)&&void 0!==i||(r.y=1),this.setPublic("scale",r)}}),this.addPublic({name:"parent",value:r,type:"Transform"})}setParentDirty(e){var t;if(e instanceof ne||"number"==typeof e)if("number"!=typeof e){if(this.recursiveChildren.includes(e.sprite))for(const e of this.children)e.transform.parent=this.parent;this.parent=e}else this.parent=e;else null!==(t=this.parent)&&void 0!==t||(this.parent=te.active)}json(){let e={type:"",name:""};return this.parent instanceof ne?(e.type="Transform",e.name=this.parent.sprite.name):(e.type="Scene",e.name=this.parent.toString()),{type:"Transform",position:this.position.array,scale:this.scale.array,rotation:this.rotation.array,parent:e}}Update(){}get localRotation(){return this.getPublic("rotation")||new e(1)}set localRotation(e){this.setPublic("rotation",e)}get localPosition(){return this.getPublic("position")||e.zero}set localPosition(e){this.setPublic("position",e)}get localScale(){return this.getPublic("scale")||e.zero}set localScale(e){this.setPublic("position",e)}detachFromParent(){this.parent=te.active}get children(){let e=[];for(let t of fe.entities)Object.is(t.transform.parent,this)&&e.push(t);return e}get recursiveChildren(){const e=this.children,t=[];for(;e.length>0;){for(let t of e[0].transform.children)e.push(t);t.push(e.shift())}return t}get childCount(){let e=0;for(let t of fe.entities)Object.is(t.transform.parent,this)&&e++;return e}makeChildOf(e){this.parent=e}makeParentOf(e){for(const t of e)t.parent=this}isRoot(){return"number"==typeof this.parent}isChild(){return this.parent instanceof ne}get sprite(){return fe.entities.find((e=>Object.is(e.transform,this)))}get root(){return function e(t){return"number"==typeof t.parent?t:e(t.parent)}(this)}get scene(){const e=this.root.parent;if("number"!=typeof e)throw"root is not scene";return te.sceneByID(e)}get forwards(){return this.rotation}get right(){let e=this.forwards;return new t(e.y,-e.x)}getChild(e){return this.children.find((t=>t.name===e))}}var ie=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};const re={CircleCollider:v,RectCollider:y,Body:k,CircleRenderer:G,RectRenderer:F,ImageRenderer2D:W,GUIBox:q,GUIText:J,GUITextBox:X,GUIRect:K,GUICircle:H,GUIPolygon:Q,GUIImage:Y,Camera:Z},oe=Math.floor(200001*Math.random());function se(n,i,r){if("object"!=typeof(o=i[n])||"number"!=typeof o.r||"number"!=typeof o.g||"number"!=typeof o.b){var o;Array.isArray(i[n])?function(e){return"object"==typeof e&&!!Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}(i[n])?r[n]=t.fromArray(i[n]):function(e){return"object"==typeof e&&!!Array.isArray(e)&&3===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&"number"==typeof e[2]}(i[n])?r[n]=e.fromArray(i[n]):r[n]=i[n]:r[n]=i[n]}else{const e=i[n];r[n]=a(e.r,e.g,e.b,e.a)}}function ae(n){return ie(this,void 0,void 0,(function*(){let i;if("Script"===n.type)return function(n){return ie(this,void 0,void 0,(function*(){const i=n.path;let r;const o=i.split("/").pop();let s=yield fetch(`${i}?${oe}`),a=yield s.text();const l=new h.Context;l.parent=h.global,l.path=i;const c=new h.ESNamespace(new h.ESString(o),{}),u=(0,h.run)(a,{env:l,measurePerformance:!1,fileName:o,currentDir:i});if(c.__value__=l.getSymbolTableAsDict(),u.error)console.log(u.error.str);else{r=c;try{const o=new f({script:r,path:i});if(Array.isArray(n.public))for(let i of n.public){if(!o.hasPublic(i.name))continue;let n=i.value;"v2"===i.type?n=t.fromArray(i.value):"v3"===i.type&&(n=e.fromArray(i.value)),o.setPublic(i.name,n)}return o}catch(e){throw`Error initialising script '${o}': ${e}`}}}))}(n);const r=re[n.type];if(!r)throw`No component of type '${n.type}' found`;i=new r({});for(let e in n)n.hasOwnProperty(e)&&"type"!==e&&"subType"!==e&&se(e,n,i);return i}))}function le(t){var n,i,r,o;return ie(this,void 0,void 0,(function*(){const s=null!==(n=t.name)&&void 0!==n?n:`entity ${fe.entities.length}`,a=null!==(i=t.tag)&&void 0!==i?i:"entity",l=null!==(r=t.Static)&&void 0!==r&&r,c=null!==(o=t.components)&&void 0!==o?o:[];let u=[];const h=t.transform,{parentInfo:f,transform:d}=function(t){let n=t.parent;const i=new ne({});return t.position&&(i.position=e.fromArray(t.position)),t.scale&&(i.scale=e.fromArray(t.scale)),t.rotation&&(i.rotation=e.fromArray(t.rotation)),{parentInfo:n,transform:i}}(h||{});for(let e of c){const t=yield ae(e);t&&u.push(t)}return{entity:new fe({name:s,components:u,transform:d,tag:a,Static:l}),parentInfo:f}}))}function ce(e,t){var n;let i;"Transform"===e.type?i=null===(n=fe.find(e.name))||void 0===n?void 0:n.transform:"Scene"===e.type&&(i=te.sceneByID(parseInt(e.name)).id),null==i&&(i=te.active),null==t||t.makeChildOf(i)}function ue(e){var t;return ie(this,void 0,void 0,(function*(){let n={};if(Array.isArray(e)){for(let t of e){let e=yield le(t);n[e.entity.name]=e.parentInfo,fe.entities.push(e.entity)}for(let e in n)n[e]&&ce(n[e],null===(t=fe.find(e))||void 0===t?void 0:t.transform)}else console.error("Cannot initialise entities from JSON ",e)}))}function he(e){var t;for(let n of e){const e=ee(),i=null!==(t=n.settings)&&void 0!==t?t:{};for(let t of Object.keys(i))se(t,n.settings||{},e);te.create({name:n.name,settings:e})}}class fe{constructor(e){var t,n,i,r,o;this.getComponent=(e,t="")=>{if(!(this instanceof fe))throw`Running getComponent method in invalid context. this: ${this}`;if("transform"===e.toLowerCase())return this.transform;let n=this.components.find((n=>n.type===e&&(n.subtype===t||""===t)||n.subtype===e));if(void 0===n&&(n=this.getComponents("Script").find((n=>n.subtype===t||n.subtype===e))),void 0===n)throw`Cannot find component of type ${e} on entity ${this.name}`;return n},this.getSceneID=()=>this.sceneID,this.getClone=()=>{return e=this,t=void 0,i=function*(){const{entity:e,parentInfo:t}=yield le(this.json());return ce(t,e.transform),e},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i},this.addComponent=e=>{if("transform"===e.type)return!1;for(const t of this.components){if("GUIElement"===t.type){if("Renderer"!==e.type)continue;if(!["Renderer","Body","Camera"].includes(e.type))continue}if("GUIElement"===e.type&&["Renderer","Body","Camera","Collider"].includes(t.type))return!1;t.type===e.type&&t.subtype===e.subtype&&this.components.splice(this.components.indexOf(t),1)}return this.components.push(e),!0},this.add=this.addComponent,this.hasComponent=(e,t="")=>{if("transform"===e.toLowerCase())return!0;for(let n of this.components){if(n.type===e&&(n.subtype===t||""===t))return!0;if(n.subtype===e)return!0}return!1},this.getComponents=(e,t="")=>{let n=[];for(const i of this.components)i.type!==e||i.subtype!==t&&""!==t||n.push(i);return n},this.generateID=()=>{let e=0,t=fe.entities.map((e=>e.id));for(;t.indexOf(e)>-1;)e=Math.floor(Math.random()*Math.pow(10,5));return e},this.delete=()=>{for(let e=0;e<fe.entities.length;e++){const t=fe.entities[e];Object.is(t,this)&&delete fe.entities.splice(e,1)[0]}},this.json=()=>({name:this.name,tag:this.tag,Static:this.Static,transform:this.transform.json(),components:this.components.map((e=>e.json()))}),this.tag=null!==(t=e.tag)&&void 0!==t?t:"entity",this.name=null!==(n=e.name)&&void 0!==n?n:"new entity",this.components=null!==(i=e.components)&&void 0!==i?i:[],this.transform=null!==(r=e.transform)&&void 0!==r?r:new ne({}),this.Static=null!==(o=e.Static)&&void 0!==o&&o,this.id=this.generateID()}get sceneID(){let e=this.transform;for(;"number"!=typeof e;)e=e.parent;return e}static newEntity(e){const t=new fe(e);return fe.entities.push(t),t}static add(e){fe.entities.push(e)}static find(e=""){const t=fe.entities.find((t=>t.name===e));if(t)return t}static findWithTag(e){let t=[];return fe.loop((n=>{n.tag===e&&t.push(n)})),t}static loop(e){for(const t of fe.entities)e(t)}}fe.entities=[],fe.new=fe.newEntity;function de(e){return n=this,i=void 0,o=function*(){const n=j(e),i=.1*e.width,r=N(e);function o(){A(n,t.zero,r.x,r.y,"#EEEEEE",0),R(n,"made with",i/2.5,"Nunito","rgb(60, 60, 60)",new t(e.width/2-i/1.6,e.height/2-i/2)),R(n,"Entropy Engine",i,"Nunito","rgb(0, 0, 0)",new t(e.width/2,e.height/2))}A(n,t.zero,r.x,r.y,"#EEEEEE",0),o(),yield m(500);const s=performance.now();for(;performance.now()-s<1e3&&n.globalAlpha>0;)n.globalAlpha-=.005,o(),yield m(1);n.globalAlpha=1},new((r=void 0)||(r=Promise))((function(e,t){function s(e){try{l(o.next(e))}catch(e){t(e)}}function a(e){try{l(o.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,a)}l((o=o.apply(n,i||[])).next())}));var n,i,r,o}function pe(e,n){let i=e.getBoundingClientRect();const r=new t(n.pageX-i.left-scrollX,i.height-(n.pageY-i.top-scrollY)),o=new t(e.width/i.width,e.height/i.height);return r.mul(o),r}const ve={listen:(e,t)=>{document.addEventListener(e,t)},mouseDown:!1,cursorPosition:t.zero,cursorPosWorldSpace:t.zero};function ye(e,t){ve.cursorPosition=pe(t,e),ve.cursorPosWorldSpace=function(e,t){const n=pe(e,t);return Z.main.getComponent("Camera").screenSpaceToWorldSpace(n,e,Z.main.transform.position)}(t,e)}document.addEventListener("keydown",(e=>{ve[e.key]=!0})),document.addEventListener("keyup",(e=>{ve[e.key]=!1})),document.addEventListener("keypress",(e=>{fe.loop((t=>{if(!t.hasComponent("GUIElement","GUITextBox"))return;const n=t.getComponent("GUIElement","GUITextBox");n.selected&&n.keyPress(e)}))})),document.addEventListener("keydown",(e=>{8===e.keyCode&&fe.loop((e=>{if(!e.hasComponent("GUIElement","GUITextBox"))return;const t=e.getComponent("GUIElement","GUITextBox");t.selected&&t.backspace()}))}));const me=new class{constructor(){this.systems=[]}sortByOrder(){me.systems=me.systems.sort(((e,t)=>e.order-t.order))}getByName(e){for(let t of me.systems)if(t.name===e)return t}Start(e,t){me.sortByOrder();for(let n of me.systems)n.Start(e,t)}Update(e,t){for(let n of me.systems)n.Update(e,t)}};class ge{constructor(e){this.points=e}move(e){for(const t of this.points)t.add(e)}}class xe{constructor(e){this.triangles=e}move(e){for(const t of this.triangles)t.move(e)}}class be{constructor(e,t,n){this.points=[e,t,n]}move(e){for(const t of this.points)t.add(e)}apply(e){for(let t=0;t<3;t++)this.points[t]=e(this.points[t].clone)}get clone(){return new be(...this.points.map((e=>e.clone)))}get triangleV2(){return new ge([this.points[0].v2,this.points[1].v2,this.points[2].v2])}get json(){let e=[];for(const t of this.points)e.push(t.array);return e}}class we{constructor(e){this.triangles=e}move(e){for(const t of this.triangles)t.move(e)}get json(){let e=[];for(const t of this.triangles)e.push(t.json);return e}get clone(){return new we(this.triangles.map((e=>e.clone)))}static fromArray(t){let n=new we([]);for(let i of t){const t=[];for(let n of i)t.push(e.fromArray(n));n.triangles.push(new be(...t))}return n}static get cube(){return new we([new be(new e(0,0,0),new e(0,1,0),new e(1,1,0)),new be(new e(0,0,0),new e(1,1,0),new e(1,0,0)),new be(new e(1,0,0),new e(1,1,0),new e(1,1,1)),new be(new e(1,0,0),new e(1,1,1),new e(1,0,1)),new be(new e(1,0,1),new e(1,1,1),new e(0,1,1)),new be(new e(1,0,1),new e(0,1,1),new e(0,0,1)),new be(new e(0,0,1),new e(0,1,1),new e(0,1,0)),new be(new e(0,0,1),new e(0,1,0),new e(0,0,0)),new be(new e(0,1,0),new e(0,1,1),new e(1,1,1)),new be(new e(0,1,0),new e(1,1,1),new e(1,1,0)),new be(new e(1,0,1),new e(0,0,1),new e(0,0,0)),new be(new e(1,0,1),new e(0,0,0),new e(1,0,0))])}}let _e=!1;function Se(){return e=this,t=void 0,i=function*(){_e||(_e=!0,yield h.init(console.log,(()=>{}),!1,{print:console.log,ee:{CircleCollider:v,RectCollider:y,Script:f,TriangleV2:ge,TriangleV3:be,MeshV2:xe,MeshV3:we,Body:k,CircleRenderer:G,ImageRenderer2D:W,RectRenderer:F,GUIBox:q,GUIText:J,GUITextBox:X,GUIRect:K,GUICircle:H,GUIPolygon:Q,GUIImage:Y,Camera:Z,Transform:ne}},h.global))},new((n=void 0)||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}));var e,t,n,i}function Te(e){const t=j(e);t.beginPath(),t.clearRect(0,0,e.width,e.height),t.fill()}function ke(e,n,i){function r(i){let r=n||o.parse("white");r=r.clone,r.alpha=i,A(e,t.zero,e.canvas.width,e.canvas.height,r.rgba)}if(i)try{B(e,t.zero,N(e.canvas),i)}catch(e){r(.1)}else r(1)}function Ce(e,t,n,i,r=Z.main){const o=N(t.render),s=o.clone.scale(.5);if(Te(t.background),Te(t.render),Te(t.GUI),Te(t.render),ke(j(t.background),n,i),!e)return;if(!r)return void console.error(`Camera was not passed to renderAll. Main camera is '${Z.main.name}'`);const a=r.getComponent("Camera");if(!a)return;const l=r.transform.position.clone.sub(o.clone.scale(.5).v3);if(l){e=e.filter((e=>e.hasComponent("Renderer")||e.hasComponent("GUIElement")));for(let n of function(e){const t=e.sort(((e,t)=>e.transform.position.z-t.transform.position.z));let n=[],i=[];for(let e of t)e.hasComponent("GUIElement")?i.push(e):n.push(e);return[...n,...i]}(e)){if(n.hasComponent("GUIElement")){n.getComponent("GUIElement").draw(j(t.GUI),n.transform);continue}const e=n.transform.position.clone.sub(l);n.getComponent("Renderer").draw({position:e,transform:n.transform,ctx:j(t.render),zoom:a.zoom,center:s,camera:a,cameraSprite:r})}}}function Oe(e,n,i,r,o,s){const a=i.getComponent("Camera"),l=i.getComponent("Camera").zoom;e.beginPath(),e.strokeStyle=r;let c=a.worldSpaceToScreenSpace(s.position.clone.v2.add(o.offset),n,i.transform.position);if(o instanceof y){const n=new t(o.width,o.height),i=s.scale.v2.mul(n);i.scale(l);const r=c.clone;c=c.clone.sub(i.clone.scale(.5)),O(e,r,s.rotation.z,(()=>{e.rect(c.x,c.y,i.x,i.y),e.stroke()}))}else o instanceof v&&(e.arc(c.x,c.y,o.radius*s.scale.x*l,0,2*Math.PI),e.stroke())}function Ee(e,n,i,r){const o=i.getComponent("Camera");for(const s of r){if(!s.hasComponent("Camera"))continue;let r=o.worldSpaceToScreenSpace(s.transform.position.v2,n,i.transform.position);r.sub(new t(2)),B(e,r,new t(80,40),"https://entropyengine.dev/svg/camera.png",0)}}function Pe(e,n,i,r,o){const s=N(n),a=i.getComponent("Camera"),l=r.getComponent("Camera"),c=l.screenSpaceToWorldSpace(new t(0,0),n,r.transform.position),u=l.screenSpaceToWorldSpace(s,n,r.transform.position),h=a.worldSpaceToScreenSpace(c,n,i.transform.position),f=a.worldSpaceToScreenSpace(u,n,i.transform.position),d=Math.abs(h.y-f.y),p=Math.abs(h.x-f.x);A(e,h,1,d,o,0),A(e,new t(f.x,h.y),1,d,o,0),A(e,h,p,1,o,0),A(e,new t(h.x,f.y),p,1,o,0)}function Ae(e,n,i,r){!function(e,n,i,r){const{step:o,min:s,max:a}=function(e,n,i){const r=i.getComponent("Camera"),o=r.zoom,s=N(n);let a=Math.floor(Math.log(o)/Math.LN10+1e-9),l=1/Math.pow(10,a)*50;const c=r.screenSpaceToWorldSpace(new t(0,0),n,i.transform.position),u=r.screenSpaceToWorldSpace(s,n,i.transform.position);(u.x-c.x)/l<5&&(l/=2);const h=e=>Math.ceil(e/l)*l;return c.apply(h),u.apply(h),{step:l,min:c,max:u,zoom:o}}(0,n,i),l=N(n),c=i.getComponent("Camera");for(let u=s.y;u<a.y;u+=o){const o=c.worldSpaceToScreenSpace(new t(0,u),n,i.transform.position);o.x=-1,A(e,o,l.x+2,1,r,0)}for(let u=s.x;u<a.x;u+=o){const o=c.worldSpaceToScreenSpace(new t(u,0),n,i.transform.position);o.y=-1,A(e,o,1,l.y+2,r,0)}}(n,e,i,"rgba(150, 150, 150, 0.3)"),function(e,n,i,r,o){P(e,i.getComponent("Camera").worldSpaceToScreenSpace(t.zero,n,i.transform.position),2,"rgba(150, 150, 150, 0.6)")}(n,e,i),function(e,t,n,i,r){for(const i of r)i.hasComponent("Collider")&&Oe(e,t,n,"rgba(255, 230, 0, 0.6)",i.getComponent("Collider"),i.transform)}(n,e,i,0,r),Ee(n,e,i,r)}function Ie(e,t,n,i){i.hasComponent("Collider")&&Oe(t,e,n,"rgba(21,229,21,0.76)",i.getComponent("Collider"),i.transform)}me.systems.push({name:"Physics",order:0,engine:d.Engine.create(),runner:d.Runner.create(),Start:function(e,t){for(let t of e.entities){if(!t.hasComponent("Body"))continue;if(!t.hasComponent("Collider"))continue;let e=t.getComponent("Collider"),n=t.getComponent("Body");this.updateMBodyOptions(e,t,n,!0),d.World.addBody(this.engine.world,e.MatterBody)}},updateMBodyOptions:(e,t,n,i=!1)=>{const r=e.MatterBody,o=t.transform;r.position=d.Vector.create(o.position.x,o.position.y),r.angle=o.rotation.z,r.isStatic=t.Static,r.isSensor=!e.solid,r.friction=n.friction,r.velocity=d.Vector.create(n.velocity.x,n.velocity.y),r.frictionAir=n.airResistance,r.mass=n.mass,r.restitution=Math.max(Math.min(n.bounciness,1),0);let s=[];if(e instanceof y){const t=e.width*o.scale.x,n=e.height*o.scale.y;s=d.Bodies.rectangle(o.position.x,o.position.y,t,n).vertices}else{if(!(e instanceof v))throw Error("Unkown Collider type");{const t=e.radius*o.scale.x;s=d.Bodies.circle(o.position.x,o.position.y,t).vertices}}for(let e of s)e.body=r;r.vertices=s,r.bounds=d.Bounds.create(r.vertices),t.Static&&(r.velocity=d.Vector.create(0,0),r.force=d.Vector.create(0,0),r.positionPrev=r.position),i&&(r.positionPrev=r.position)},callCollides:function(e,t){for(const n of e.getComponents("script"))n.runMethod("onCollision",e,[new h.ESJSBinding(t)])},updateScripts:function(e){const t=[];for(let[n]of e)t.push(n);for(let[n,i]of e){const r=[...t];let o=r.indexOf(n);if(-1===o)throw Error();r.splice(o,1);let s=d.Query.collides(n,r);if(s.length>0)for(let t of s){let r=t.bodyB;Object.is(r,n)&&(r=t.bodyA);const o=e.find((([e])=>Object.is(e,r)));if(void 0===o)throw Error();this.callCollides(i,o[1])}}},Update:function(t,n){const i=[];this.time||(this.time=performance.now());for(let e of t.entities){if(!e.hasComponent("Collider"))continue;let t=e.getComponent("Collider");if(e.hasComponent("Body")){let n=e.getComponent("Body");this.updateMBodyOptions(t,e,n)}i.push([t.MatterBody,e])}this.engine.gravity.x=t.settings.globalGravity.x,this.engine.gravity.y=t.settings.globalGravity.y,d.Runner.tick(this.runner,this.engine,performance.now());for(let n of t.entities){if(!n.hasComponent("Body")||!n.hasComponent("Collider"))continue;let t=n.getComponent("Collider").MatterBody,i=n.getComponent("Body");n?(n.transform.rotation.z=t.angle,n.transform.position.set(new e(t.position.x,t.position.y,0)),i.velocity.set(new e(t.velocity.x,t.velocity.y,0))):console.error("EEInstance not attached to Matter.Body instance")}this.updateScripts(i)}}),me.systems.push({name:"Renderer",Start:(e,t)=>{D(t.render),D(t.input),D(t.GUI),Te(t.GUI),Te(t.input),Te(t.render)},Update:(e,t)=>{Ce(e.entities,t,e.settings.backgroundTint,e.settings.backgroundImage)},order:10}),me.systems.push({name:"Scripts",Start:(e,t)=>{e.broadcast("Start",[])},Update:(e,t)=>{e.broadcast("Update",[])},order:0});var Re=function(e,t,n,i){return new(n||(n=Promise))((function(r,o){function s(e){try{l(i.next(e))}catch(e){o(e)}}function a(e){try{l(i.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}l((i=i.apply(e,t||[])).next())}))};function Be({canvasContainerID:e="entropy-engine",performanceDebug:n=0}={}){let i=!1;const r="EE-"!==(o="").substr(0,3)||12!==o.length?0:1;var o;const s=function(e){var n,i;let r=document.getElementById(e);r||(r=document.body.appendChild(document.createElement("div"))),new t((null===(n=r.parentElement)||void 0===n?void 0:n.clientWidth)||0,null===(i=r.parentElement)||void 0===i?void 0:i.clientHeight),r.innerHTML=" ",r.style.width="100%",r.style.height="100%";const o=r.appendChild(document.createElement("canvas")),s=r.appendChild(document.createElement("canvas")),a=r.appendChild(document.createElement("canvas")),l=r.appendChild(document.createElement("canvas"));o.id="EntropyEngine-GUI-Layer",s.id="EntropyEngine-render-Layer",l.id="EntropyEngine-background-Layer",a.id="EntropyEngine-input-Layer";const c={GUI:o,input:a,render:s,background:l};return U(c),c}(e),{GUI:a}=s;function l(){return Re(this,void 0,void 0,(function*(){me.Update(te.activeScene,s),window.requestAnimationFrame(l)}))}return function(e,t){const n=e.input,i=n.parentElement;if(!i)throw"no parent to canvas";new ResizeObserver((()=>{U(e)})).observe(i),n.addEventListener("mousemove",(e=>{t()&&(ye(e,n),fe.loop((e=>{if(e.sceneID===te.active)for(const t of e.components){if("GUIElement"!==t.type)return;const i=t;i.hovered=i.touchingPoint(ve.cursorPosition,j(n),e.transform)}})))}),!1),n.addEventListener("mousedown",(e=>{t()&&(ve.mouseDown=!0,ye(e,n),te.activeScene.loopThroughScripts(((t,i)=>{if(i.sceneID!==te.active)return;if(!i.hasComponent("Collider"))return;let r=i.getComponent("Collider");const o=pe(n,e);r.overlapsPoint(i.transform,o)})))}),!1),n.addEventListener("keydown",(e=>{ye(e,n)})),n.addEventListener("keyup",(e=>{ye(e,n)})),n.addEventListener("mouseup",(e=>{t()&&(ve.mouseDown=!1,ye(e,n),te.activeScene.loopThroughScripts(((t,i)=>{if(i.sceneID===te.active)if(i.hasComponent("Collider")){let r=i.getComponent("Collider");const o=pe(n,e);if(!r.overlapsPoint(i.transform,o))return;t.runMethod("onMouseUp",i,[])}else if(i.hasComponent("GUIElement")){const e=i.getComponent("GUIElement");if(e.hovered&&t.runMethod("onClick",i,[]),"GUITextBox"!==e.subtype)return;let n=e;n.selected=n.hovered}})))}),!1)}(s,(()=>i)),{run:function(){return Re(this,void 0,void 0,(function*(){U(s),yield function(){return Re(this,void 0,void 0,(function*(){r<2&&(yield de(a)),yield Se(),te.activeScene.findMainCamera(),me.Start(te.activeScene,s),i=!0}))}(),U(s),window.requestAnimationFrame(l)}))}}}function Ne(e,t={}){return Re(this,void 0,void 0,(function*(){yield Se();const n=yield fetch(e,T),i=yield n.json();for(let e of Object.keys(i))["entities","scenes"].includes(e)||(t[e]=i[e]);t.shouldInitEES=!1,he(i.scenes);const r=Be(t);return yield ue(i.entities),yield r.run(),r}))}})(),ee=i})();
//# sourceMappingURL=latest.js.map